<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Ops on Lucas's Article</title><link>https://www.lcsk42.com/categories/ops/</link><description>Recent content in Ops on Lucas's Article</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 29 Apr 2025 15:07:31 +0800</lastBuildDate><atom:link href="https://www.lcsk42.com/categories/ops/index.xml" rel="self" type="application/rss+xml"/><item><title>Macos Setup</title><link>https://www.lcsk42.com/post/macos-setup/</link><pubDate>Tue, 29 Apr 2025 15:07:31 +0800</pubDate><guid>https://www.lcsk42.com/post/macos-setup/</guid><description>&lt;h2 id="初始化配置">初始化配置
&lt;/h2>&lt;h3 id="鼠标触控板">鼠标触控板
&lt;/h3>&lt;ul>
&lt;li>鼠标速度最大：Setting -&amp;gt; Mouse -&amp;gt; Tracking speed 调整到 Fast&lt;/li>
&lt;li>轻点来点按：Setting -&amp;gt; Trackpad -&amp;gt; Tap to click 打开&lt;/li>
&lt;li>三指拖移：Setting -&amp;gt; Accessibility -&amp;gt; Pointer Control -&amp;gt; Trackpad Options -&amp;gt;
&lt;ul>
&lt;li>Use trackpad for dragging: true&lt;/li>
&lt;li>Dragging style: Three Finger Drag&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>关闭触发角：Setting -&amp;gt; Desktop &amp;amp; Dock -&amp;gt; 最下方右下角 Hot Corners,点开后设置所有为空&lt;/li>
&lt;/ul>
&lt;h3 id="homebrew-包管理">Homebrew (包管理)
&lt;/h3>&lt;p>确实无愧于自己的 slogan - The Missing Package Manager for macOS。&lt;/p>
&lt;p>软件管理必备了已经是。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">/bin/bash -c &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上命令在国内环境下因为不可抗因素会执行失败，可以尝试使用手机热点进行下载（无需代理），或者也可以直接使用 Gitee 用户提供的代理来安装：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">/bin/zsh -c &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="科学上网">科学上网
&lt;/h3>&lt;p>网络是个拦路虎，首先需要先安装代理软件，否则只能在百度中看满屏的广告了。&lt;/p>
&lt;p>从 &lt;a class="link" href="https://github.com/clash-verge-rev/clash-verge-rev/releases" target="_blank" rel="noopener"
>Clash Verge Rev&lt;/a> 中下载最新版本，进行安装。&lt;/p>
&lt;p>获取最新版本下载地址之后，如果下载过慢，可以使用资源访问加速服务进行下载：&lt;a class="link" href="https:gh.lcsk42.com" target="_blank" rel="noopener"
>gh.lcsk42.com&lt;/a>&lt;/p>
&lt;p>该项目来自 &lt;a class="link" href="https://github.com/hunshcn/gh-proxy" target="_blank" rel="noopener"
>hunshcn/gh-proxy&lt;/a>&lt;/p>
&lt;p>对其前端页面进行修改之后，部署在了 &lt;a class="link" href="https://workers.cloudflare.com/" target="_blank" rel="noopener"
>Cloudflare Workers&lt;/a> 上。&lt;/p>
&lt;p>无限感恩赛博佛祖 Cloudflare。&lt;/p>
&lt;h3 id="按键映射">按键映射
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install --cask karabiner-elements
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>自定义按键转换，我一般常用的有两个：&lt;/p>
&lt;p>F1: CapsLock 转换为 Ctrl, CapsLock 占用了那么大的位置，但是用处不多（自带的键盘作用还比较多，外接键盘好像确实没有什么用处）。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;description&amp;#34;: &amp;#34;Press caps_lock to activate as CTRL&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;manipulators&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;from&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;key_code&amp;#34;: &amp;#34;caps_lock&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;modifiers&amp;#34;: { &amp;#34;optional&amp;#34;: [&amp;#34;any&amp;#34;] }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;to&amp;#34;: [{ &amp;#34;key_code&amp;#34;: &amp;#34;left_control&amp;#34; }],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;basic&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>F2: 将右 command 键转换为 F19, 主要是方便启动器，一般会把这个键位绑定到 Raycast 上替换 自带的 spotlight。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;description&amp;#34;: &amp;#34;Change right_command key to command+control+option+shift. (Post f19 key when pressed alone)&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;manipulators&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;from&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;key_code&amp;#34;: &amp;#34;right_command&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;modifiers&amp;#34;: { &amp;#34;optional&amp;#34;: [&amp;#34;any&amp;#34;] }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;to&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;key_code&amp;#34;: &amp;#34;left_shift&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;modifiers&amp;#34;: [&amp;#34;left_command&amp;#34;, &amp;#34;left_control&amp;#34;, &amp;#34;left_option&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;to_if_alone&amp;#34;: [{ &amp;#34;key_code&amp;#34;: &amp;#34;f19&amp;#34; }],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;basic&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="鼠标反转">鼠标反转
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install --cask mos
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将鼠标滚动方向反转，并保留触控板方向不变。&lt;/p>
&lt;p>Mac 的滚轮逻辑挺反人类的，刚开始尝试适应了一段时间，结果发现并不能适应，感谢 &lt;a class="link" href="https://mos.caldis.me/" target="_blank" rel="noopener"
>Mos&lt;/a> 救我。&lt;/p>
&lt;h2 id="bash-配置">Bash 配置
&lt;/h2>&lt;h3 id="iterm2">iTerm2
&lt;/h3>&lt;p>仿真终端，替换自带的 Terminal，增加更多的主题和功能。&lt;/p>
&lt;p>&lt;a class="link" href="https://font.subf.dev/en/" target="_blank" rel="noopener"
>Maple Mono&lt;/a> 是最近非常喜欢的一个字体，在代码中大量的看会显得有点乱，但是在终端中使用很完美（可能是因为终端中的数据都比较规整，排排站的原因？）。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install --cask iterm2 font-maple-mono-nf-cn
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完成后设置字体：&lt;/p>
&lt;p>Setting -&amp;gt; Profiles -&amp;gt; Text -&amp;gt; Font: Maple Mono NF CN Regular 16 100 100&lt;/p>
&lt;h3 id="oh-my-zsh">oh-my-zsh
&lt;/h3>&lt;p>很慢，但是目前暂时没有时间去寻找更好的替代品，所以咬咬牙，先继续使用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sh -c &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果上述命令执行失败，依旧可以尝试国内 Gitee 的代理：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 进入此页面复制脚本内容，创建文件 install.sh，粘贴进文件：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://gitee.com/mirrors/oh-my-zsh/blob/master/tools/install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 替换地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- &lt;span class="nv">REMOTE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">REMOTE&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="nv">https&lt;/span>&lt;span class="p">://github.com/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">REPO&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="p">.git&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+ &lt;span class="nv">REMOTE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">REMOTE&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="nv">https&lt;/span>&lt;span class="p">://gitee.com/mirrors/oh-my-zsh.git&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 增加脚本权限，然后执行脚本即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x ./install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./install.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置文件(.zshrc)：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl"># Alias
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias vi=vim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias v=vim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># alias cat=bat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias n=neofetch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias lg=lazygit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias ,o=&amp;#34;open .&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias ,c=&amp;#34;code .&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias sz=&amp;#34;source ~/.zshrc&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias cdtmp=&amp;#39;cd `mktemp -d /tmp/lucas-XXXXXXXX`&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias hosts=&amp;#34;sudo vim /etc/hosts&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias tail=tailspin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alias weather=&amp;#34;clear &amp;amp; curl https://v2d.wttr.in/zhengzhou&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function mcd {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir $1 &amp;amp;&amp;amp; cd $1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function ppgrep() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if [[ $1 == &amp;#34;&amp;#34; ]]; then
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FZF=fzf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FZF=&amp;#34;fzf -q $1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ps aux | eval $FZF | awk &amp;#39;{ print $2 }&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function ppkill() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if [[ $1 =~ &amp;#34;^-&amp;#34; ]]; then
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> QUERY=&amp;#34;&amp;#34; # options only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> QUERY=$1 # with a query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [[ $# &amp;gt; 0 ]] &amp;amp;&amp;amp; shift
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppgrep $QUERY | xargs kill $*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="p10k">p10k
&lt;/h3>&lt;p>也是一个用的比较习惯的主题了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone --depth&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> https://github.com/romkatv/powerlevel10k.git &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">ZSH_CUSTOM&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="nv">$HOME&lt;/span>&lt;span class="p">/.oh-my-zsh/custom&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/themes/powerlevel10k&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>国内可以使用以下命令替换&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone --depth&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> https://gitee.com/romkatv/powerlevel10k.git &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">ZSH_CUSTOM&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="nv">$HOME&lt;/span>&lt;span class="p">/.oh-my-zsh/custom&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/themes/powerlevel10k&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>打开 &lt;code>~/.zshrc&lt;/code>,找到 &lt;code>ZSH_THEME&lt;/code>, 替换为 &lt;code>powerlevel10k/powerlevel10k&lt;/code> 即可。&lt;/p>
&lt;h3 id="dotfile">dotfile
&lt;/h3>&lt;h4 id="gitconfig">.gitconfig
&lt;/h4>&lt;p>个人 git 相关配置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat &amp;gt; ~/.gitconfig &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[push]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> default = current
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> autoSetupRemote = true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[user]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> name = lcsk42
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> email = lcsk42@gmail.com
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[core]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> pager = diff-so-fancy | less --tabs=4 -RFX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[interactive]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> diffFilter = diff-so-fancy --patch
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[color]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> ui = true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[color &amp;#34;diff-highlight&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> oldNormal = red bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> oldHighlight = red bold 52
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> newNormal = green bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> newHighlight = green bold 22
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[color &amp;#34;diff&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> meta = 11
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> frag = magenta bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> func = 146 bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> commit = yellow bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> old = red bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> new = green bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> whitespace = red reverse
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[init]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> defaultBranch = main
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="gitignore_global">.gitignore_global
&lt;/h4>&lt;p>全局的 git 忽略类型&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat ~/.gitignore_global &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">*~
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.DS_Store
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.idea
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.vscode
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.nvm
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">target/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">*.iml
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">/out/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="tmuxconf">.tmux.conf
&lt;/h4>&lt;p>tmux 基础配置（类 vim）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat &amp;gt; ~/.tmux.conf &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># -- general -------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g default-terminal &amp;#34;screen-256color&amp;#34; # colors!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -g xterm-keys on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -s escape-time 10 # faster command sequences
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -sg repeat-time 600 # increase repeat timeout
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -q -g status-utf8 on # expect UTF-8 (tmux &amp;lt; 2.2)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -q -g utf8 on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g history-limit 5000 # boost history
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># -- display -------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g base-index 1 # start windows numbering at 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -g pane-base-index 1 # make pane numbering consistent with windows
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -g automatic-rename on # rename window to reflect current program
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g renumber-windows on # renumber windows when a window is closed
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g set-titles on # set terminal title
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g display-panes-time 800 # slightly longer pane indicators display time
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g display-time 1000 # slightly longer status messages display time
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g status-interval 10 # redraw status line every 10 seconds
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># clear both screen and history
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -n C-l send-keys C-l \; run &amp;#39;sleep 0.1&amp;#39; \; clear-history
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># activity
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g monitor-activity on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g visual-activity off
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># -- nvigation ----------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># create session
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind C-c new-session
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># find session
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind C-f command-prompt -p find-session &amp;#39;switch-client -t %%&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># split current window horizontally
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind - split-window -v
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># split current window vertically
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind _ split-window -h
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># pane navigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r h select-pane -L # move left
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r j select-pane -D # move down
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r k select-pane -U # move up
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r l select-pane -R # move right
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind &amp;gt; swap-pane -D # swap current pane with the next one
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind &amp;lt; swap-pane -U # swap current pane with the previous one
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#pane resizing
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r H resize-pane -L 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r J resize-pane -D 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r K resize-pane -U 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r L resize-pane -R 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># window navigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">unbind n
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">unbind p
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r C-h previous-window # select previous window
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r C-l next-window # select next window
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind Tab last-window # move to last active window
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="chrome-配置">Chrome 配置
&lt;/h2>&lt;p>开发必备了，事实上的前端标准，无数的封装，一个用户的电脑中实际安装可能高达几十个的运行环境。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install --cask google-chrome
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 google 账号进行数据同步。&lt;/p>
&lt;h3 id="插件">插件
&lt;/h3>&lt;h4 id="aria2-explorer">Aria2 Explorer
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/aria2-explorer/mpkodccbngfoacfalldjimigbofkhgjn?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/aria2-explorer/mpkodccbngfoacfalldjimigbofkhgjn?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> 配合下载软件(aria2c)一起使用&lt;/p>
&lt;p>直接使用打包好的 docker 镜像进行安装：
&lt;a class="link" href="https://p3terx.com/archives/docker-aria2-pro.html" target="_blank" rel="noopener"
>Aria2 Pro - 更好用的 Aria2 Docker 容器镜像&lt;/a>&lt;/p>
&lt;p>参照提供的 &lt;a class="link" href="https://github.com/P3TERX/Aria2-Pro-Docker/blob/master/docker-compose.yml" target="_blank" rel="noopener"
>docker-compose.yml&lt;/a> 示例，根据需要修改如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Aria2-Pro&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">aria2-pro&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">p3terx/aria2-pro&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">PUID=65534&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">PGID=65534&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">UMASK_SET=022&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">RPC_SECRET=P3TERX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">RPC_PORT=6800&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">LISTEN_PORT=6888&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">DISK_CACHE=128M&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">IPV6_MODE=false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">UPDATE_TRACKERS=true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">CUSTOM_TRACKER_URL=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">TZ=Asia/Shanghai&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">${PWD}/aria2-config:/config&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">${HOME}/Downloads:/downloads&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">network_mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">host&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unless-stopped&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">logging&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">driver&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">json-file&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">options&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">max-size&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">1m&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="immersive-translate---translate-web--pdf">Immersive Translate - Translate Web &amp;amp; PDF
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/immersive-translate-trans/bpoadfkcbjbfhfodiogcnhhhpibjhbnh?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/immersive-translate-trans/bpoadfkcbjbfhfodiogcnhhhpibjhbnh?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> 真 - 沉浸式翻译&lt;/p>
&lt;h4 id="proxy-switchyomega-3-zeroomega">Proxy SwitchyOmega 3 (ZeroOmega)
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/proxy-switchyomega-3-zero/pfnededegaaopdmhkdmcofjmoldfiped?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/proxy-switchyomega-3-zero/pfnededegaaopdmhkdmcofjmoldfiped?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> 处理不同网站之间的代理&lt;/p>
&lt;p>&lt;strong>Rule List:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="memo">Memo
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/memo/chgfencjlhmjhmnnpnlnchglkkdcipii?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/memo/chgfencjlhmjhmnnpnlnchglkkdcipii?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> 配合 GitHub 仓库，将搜藏的页面存储到一个仓库中&lt;/p>
&lt;h4 id="json-formatter">JSON Formatter
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> 格式化 JSON 数据&lt;/p>
&lt;h4 id="i-still-dont-care-about-cookies">I still don&amp;rsquo;t care about cookies
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/i-still-dont-care-about-c/edibdbjcniadpccecjdfdjjppcpchdlm?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/i-still-dont-care-about-c/edibdbjcniadpccecjdfdjjppcpchdlm?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> 如题&lt;/p>
&lt;h4 id="biliplus---bilibili-加大杯细节从大杯做起">BiliPlus - Bilibili 加大杯，细节从大杯做起
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/biliplus-bilibili-%E5%8A%A0%E5%A4%A7%E6%9D%AF%EF%BC%8C%E7%BB%86%E8%8A%82%E4%BB%8E/liddcdcjkpeaiblhebgihpmcaknpgbgk?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/biliplus-bilibili-%E5%8A%A0%E5%A4%A7%E6%9D%AF%EF%BC%8C%E7%BB%86%E8%8A%82%E4%BB%8E/liddcdcjkpeaiblhebgihpmcaknpgbgk?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> B 站优化&lt;/p>
&lt;h4 id="b-站空降助手">B 站空降助手
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong> &lt;a class="link" href="https://chromewebstore.google.com/detail/b%E7%AB%99%E7%A9%BA%E9%99%8D%E5%8A%A9%E6%89%8B/eaoelafamejbnggahofapllmfhlhajdd?hl=en" target="_blank" rel="noopener"
>https://chromewebstore.google.com/detail/b%E7%AB%99%E7%A9%BA%E9%99%8D%E5%8A%A9%E6%89%8B/eaoelafamejbnggahofapllmfhlhajdd?hl=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>功能：&lt;/strong> B 站优化&lt;/p>
&lt;h3 id="油猴脚本">油猴脚本
&lt;/h3>&lt;h4 id="ac-baidu-google_sogou_bing_redirectremove_favicon_adaway_twoline">AC-baidu-google_sogou_bing_RedirectRemove_favicon_adaway_TwoLine
&lt;/h4>&lt;p>&lt;strong>地址:&lt;/strong>&lt;a class="link" href="https://greasyfork.org/en/scripts/14178-ac-baidu-%E9%87%8D%E5%AE%9A%E5%90%91%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6%E6%90%9C%E7%8B%97%E8%B0%B7%E6%AD%8C%E5%BF%85%E5%BA%94%E6%90%9C%E7%B4%A2-favicon-%E5%8F%8C%E5%88%97" target="_blank" rel="noopener"
>https://greasyfork.org/en/scripts/14178-ac-baidu-%E9%87%8D%E5%AE%9A%E5%90%91%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6%E6%90%9C%E7%8B%97%E8%B0%B7%E6%AD%8C%E5%BF%85%E5%BA%94%E6%90%9C%E7%B4%A2-favicon-%E5%8F%8C%E5%88%97&lt;/a>&lt;/p>
&lt;h4 id="endless-google">Endless Google
&lt;/h4>&lt;p>&lt;strong>地址:&lt;/strong>&lt;a class="link" href="https://greasyfork.org/en/scripts/41041-endless-google-fork" target="_blank" rel="noopener"
>https://greasyfork.org/en/scripts/41041-endless-google-fork&lt;/a>&lt;/p>
&lt;h4 id="auto-skip-youtube-ads">Auto Skip YouTube Ads
&lt;/h4>&lt;p>&lt;strong>地址:&lt;/strong>&lt;a class="link" href="https://greasyfork.org/en/scripts/498197-auto-skip-youtube-ads" target="_blank" rel="noopener"
>https://greasyfork.org/en/scripts/498197-auto-skip-youtube-ads&lt;/a>&lt;/p>
&lt;h4 id="pixiv-plus">Pixiv Plus
&lt;/h4>&lt;p>&lt;strong>地址：&lt;/strong>&lt;a class="link" href="https://greasyfork.org/en/scripts/34153-pixiv-plus" target="_blank" rel="noopener"
>https://greasyfork.org/en/scripts/34153-pixiv-plus&lt;/a>&lt;/p>
&lt;h2 id="vs-code-配置">VS Code 配置
&lt;/h2>&lt;h3 id="配置文件">配置文件
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.cursorBlinking&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;solid&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.cursorStyle&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;block&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;workbench.colorTheme&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Default Light+&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.fontFamily&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#39;Hack Nerd Font Mono&amp;#39;, Monaco, &amp;#39;Courier New&amp;#39;, monospace&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.fontSize&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">18&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.fontLigatures&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.tabSize&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.tabCompletion&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;on&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.renderWhitespace&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;all&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.rulers&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">80&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.suggestSelection&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;first&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.wordWrap&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;wordWrapColumn&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.wordWrapColumn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;editor.bracketPairColorization.independentColorPoolPerBracketType&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;window.restoreWindows&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;files.autoSave&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;onFocusChange&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;files.defaultLanguage&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;javascript&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;files.trimTrailingWhitespace&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;files.exclude&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/.git&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/.svn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/.hg&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/CVS&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/.DS_Store&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/Thumbs.db&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/.gitignore&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;**/package-lock.json&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;files.eol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;terminal.external.osxExec&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;iTerm.app&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;terminal.integrated.fontSize&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;terminal.integrated.fontFamily&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Maple Mono NF CN&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;http.proxy&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http://127.0.0.1:7890&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;workbench.activityBar.location&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;hidden&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="插件-1">插件
&lt;/h3>&lt;h4 id="error-lens">Error lens
&lt;/h4>&lt;h4 id="better-comments">Better Comments
&lt;/h4>&lt;h4 id="bookmarks">Bookmarks
&lt;/h4>&lt;h4 id="code-spell-checker">Code Spell Checker
&lt;/h4>&lt;h2 id="小软件大提升">小软件大提升
&lt;/h2>&lt;h3 id="raycast">Raycast
&lt;/h3>&lt;p>&lt;strong>官网地址:&lt;/strong>
&lt;a class="link" href="https://www.raycast.com//" target="_blank" rel="noopener"
>https://www.raycast.com//&lt;/a>&lt;/p>
&lt;p>&lt;strong>安装方式:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install --cask raycast
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>核心功能:&lt;/strong>
软件启动器&lt;/p>
&lt;p>&lt;strong>辅助功能:&lt;/strong>
历史剪切板等&lt;/p>
&lt;h3 id="bark">Bark
&lt;/h3>&lt;p>&lt;strong>官网地址:&lt;/strong>
&lt;a class="link" href="https://bark.day.app/#/" target="_blank" rel="noopener"
>https://bark.day.app/#/&lt;/a>&lt;/p>
&lt;p>&lt;strong>安装方式:&lt;/strong>
App Store 直接安装&lt;/p>
&lt;p>&lt;strong>核心功能:&lt;/strong>
消息提醒，基于 Apple 的推送渠道，可以实现不运行软件就可以接受消息&lt;/p>
&lt;h3 id="keepingyouawake">KeepingYouAwake
&lt;/h3>&lt;p>&lt;strong>官网地址:&lt;/strong>
&lt;a class="link" href="https://keepingyouawake.app/" target="_blank" rel="noopener"
>https://keepingyouawake.app/&lt;/a>&lt;/p>
&lt;p>&lt;strong>安装方式:&lt;/strong>
App Store 直接安装&lt;/p>
&lt;p>&lt;strong>核心功能:&lt;/strong>
可以保持屏幕常亮。功能单一但好用。完美的遵循 Unix 哲学中的 KISS(Keep it simple, stupid) 原则&lt;/p>
&lt;h3 id="runcat">RunCat
&lt;/h3>&lt;p>&lt;strong>官网地址:&lt;/strong>
&lt;a class="link" href="https://kyome.io/runcat/?lang=en" target="_blank" rel="noopener"
>https://kyome.io/runcat/?lang=en&lt;/a>&lt;/p>
&lt;p>&lt;strong>安装方式:&lt;/strong>
App Store 直接安装&lt;/p>
&lt;p>&lt;strong>核心功能:&lt;/strong>
小猫可爱捏。会在状态栏显示一只奔跑的小猫，系统负载越大，跑得越快。也可以点开看一些系统资源的具体使用信息&lt;/p>
&lt;h3 id="inputsourcepro">InputSourcePro
&lt;/h3>&lt;p>&lt;strong>官网地址:&lt;/strong>
&lt;a class="link" href="https://inputsource.pro/" target="_blank" rel="noopener"
>https://inputsource.pro/&lt;/a>&lt;/p>
&lt;p>&lt;strong>安装方式:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install --cask input-source-pro
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>核心功能:&lt;/strong>
为不同的程序设置不同的默认打开输入法&lt;/p>
&lt;h2 id="文件目录定义">文件目录定义
&lt;/h2>&lt;p>使用 kebab-case 风格进行命名。&lt;/p>
&lt;ul>
&lt;li>/Document
&lt;ul>
&lt;li>/lcsk42.github.io&lt;/li>
&lt;li>/container&lt;/li>
&lt;li>/code
&lt;ul>
&lt;li>/com.lcsk42&lt;/li>
&lt;li>/com.skybeyondtech&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>/script
&lt;ul>
&lt;li>/jebra&lt;/li>
&lt;li>/navicat-premium-reset-trial&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="开发相关">开发相关
&lt;/h2>&lt;h3 id="back-end">Back-end
&lt;/h3>&lt;h4 id="java">Java
&lt;/h4>&lt;p>安装 jdk&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install jenv openjdk@21 openjdk@17 mvn
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>jenv: java 版本管理&lt;/li>
&lt;li>jdk：开发必备&lt;/li>
&lt;li>mvn: 包管理&lt;/li>
&lt;/ul>
&lt;h3 id="front-end">Front-end
&lt;/h3>&lt;ul>
&lt;li>IntelliJ IDEA: 吃饭的软件&lt;/li>
&lt;li>Navicat: 数据库连接软件&lt;/li>
&lt;li>Wireshark: 网络抓包&lt;/li>
&lt;/ul>
&lt;h2 id="沟通娱乐">沟通娱乐
&lt;/h2>&lt;ul>
&lt;li>WeChat： 国内必备&lt;/li>
&lt;li>Telegram：拓宽视野&lt;/li>
&lt;li>IINA：Mac 下最好的本地视频播放器&lt;/li>
&lt;/ul></description></item><item><title>软件列表</title><link>https://www.lcsk42.com/post/software-list/</link><pubDate>Thu, 20 Mar 2025 14:24:22 +0800</pubDate><guid>https://www.lcsk42.com/post/software-list/</guid><description>&lt;h2 id="software-list">Software List
&lt;/h2>&lt;p>为了方便新电脑和重装系统时（心理洁癖，当我觉得电脑特别乱时，就特别想把所有清空重置一下，干净的电脑可以给我一种干净的感觉？）可以快速恢复环境，记录一下自己使用到的软件。&lt;/p>
&lt;h3 id="cli">CLI
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://gitee.com/cunkai/HomebrewCN" target="_blank" rel="noopener"
>brew&lt;/a>: The Missing Package Manager for macOS (or Linux)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The following commands need to be executed one by one.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/bin/zsh -c &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="brew">Brew
&lt;/h4>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/nektos/act" target="_blank" rel="noopener"
>act&lt;/a>: Run your GitHub Actions locally&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/axel-download-accelerator/axel" target="_blank" rel="noopener"
>axel&lt;/a>: Light UNIX download accelerator&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/sharkdp/bat" target="_blank" rel="noopener"
>bat&lt;/a>: Clone of cat(1) with syntax highlighting and Git integration&lt;/li>
&lt;li>&lt;a class="link" href="https://www.docker.com/" target="_blank" rel="noopener"
>docker&lt;/a>: Pack, ship and run any application as a lightweight container&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.docker.com/compose/" target="_blank" rel="noopener"
>docker-compose&lt;/a>: Isolated development environments using Docker&lt;/li>
&lt;li>&lt;a class="link" href="https://www.docker.com/" target="_blank" rel="noopener"
>docker-completion&lt;/a>: Bash, Zsh and Fish completion for Docker&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/junegunn/fzf" target="_blank" rel="noopener"
>fzf&lt;/a>: Command-line fuzzy finder written in Go&lt;/li>
&lt;li>&lt;a class="link" href="https://gohugo.io/" target="_blank" rel="noopener"
>hugo&lt;/a>: Configurable static site generator&lt;/li>
&lt;li>&lt;a class="link" href="https://www.jenv.be/" target="_blank" rel="noopener"
>jenv&lt;/a>: Manage your Java environment&lt;/li>
&lt;li>&lt;a class="link" href="https://jqlang.github.io/jq/" target="_blank" rel="noopener"
>jq&lt;/a>: Lightweight and flexible command-line JSON processor&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/casey/just" target="_blank" rel="noopener"
>just&lt;/a>: Handy way to save and run project-specific commands&lt;/li>
&lt;li>&lt;a class="link" href="https://lima-vm.io/" target="_blank" rel="noopener"
>lima&lt;/a>: Linux virtual machines&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener"
>nvm&lt;/a>: Manage multiple Node.js versions&lt;/li>
&lt;li>&lt;a class="link" href="https://openjdk.java.net/" target="_blank" rel="noopener"
>openjdk@17&lt;/a>: Development kit for the Java programming language&lt;/li>
&lt;li>&lt;a class="link" href="https://openjdk.java.net/" target="_blank" rel="noopener"
>openjdk@21&lt;/a>: Development kit for the Java programming language&lt;/li>
&lt;li>&lt;a class="link" href="https://maven.apache.org/" target="_blank" rel="noopener"
>mvn&lt;/a>: Java-based project management&lt;/li>
&lt;li>&lt;a class="link" href="https://tmux.github.io/" target="_blank" rel="noopener"
>tmux&lt;/a>: Terminal multiplexer&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> act &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> axel &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> bat &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> docker &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> docker-compose &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> docker-completion &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> fzf &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> hugo &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> jenv &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> jq &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> just &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> lima &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> nvm &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> openjdk@17 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> openjdk@21 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> mvn &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> tmux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="cli-configuration">CLI Configuration
&lt;/h4>&lt;h5 id="gitconfig">.gitconfig
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat &amp;gt; ~/.gitconfig &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[push]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> default = current
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> autoSetupRemote = true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[user]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> name = lcsk42
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> email = lcsk42@gmail.com
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[core]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> pager = diff-so-fancy | less --tabs=4 -RFX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[interactive]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> diffFilter = diff-so-fancy --patch
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[color]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> ui = true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[color &amp;#34;diff-highlight&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> oldNormal = red bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> oldHighlight = red bold 52
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> newNormal = green bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> newHighlight = green bold 22
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[color &amp;#34;diff&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> meta = 11
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> frag = magenta bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> func = 146 bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> commit = yellow bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> old = red bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> new = green bold
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> whitespace = red reverse
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[init]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> defaultBranch = main
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="gitignore_global">.gitignore_global
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat ~/.gitignore_global &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">*~
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.DS_Store
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.idea
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.vscode
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">.nvm
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">target/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">*.iml
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">/out/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="justfile">.justfile
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat &amp;gt; ~/.justfile &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">default:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> @echo &amp;#34;\033[31mAlready at user home directory; no recipes available.\033[0m&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="tmuxconf">.tmux.conf
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat &amp;gt; ~/.tmux.conf &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># -- general -------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g default-terminal &amp;#34;screen-256color&amp;#34; # colors!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -g xterm-keys on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -s escape-time 10 # faster command sequences
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -sg repeat-time 600 # increase repeat timeout
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -q -g status-utf8 on # expect UTF-8 (tmux &amp;lt; 2.2)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -q -g utf8 on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g history-limit 5000 # boost history
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># -- display -------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g base-index 1 # start windows numbering at 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -g pane-base-index 1 # make pane numbering consistent with windows
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">setw -g automatic-rename on # rename window to reflect current program
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g renumber-windows on # renumber windows when a window is closed
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g set-titles on # set terminal title
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g display-panes-time 800 # slightly longer pane indicators display time
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g display-time 1000 # slightly longer status messages display time
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g status-interval 10 # redraw status line every 10 seconds
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># clear both screen and history
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -n C-l send-keys C-l \; run &amp;#39;sleep 0.1&amp;#39; \; clear-history
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># activity
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g monitor-activity on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set -g visual-activity off
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># -- nvigation ----------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># create session
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind C-c new-session
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># find session
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind C-f command-prompt -p find-session &amp;#39;switch-client -t %%&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># split current window horizontally
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind - split-window -v
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># split current window vertically
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind _ split-window -h
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># pane navigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r h select-pane -L # move left
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r j select-pane -D # move down
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r k select-pane -U # move up
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r l select-pane -R # move right
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind &amp;gt; swap-pane -D # swap current pane with the next one
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind &amp;lt; swap-pane -U # swap current pane with the previous one
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#pane resizing
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r H resize-pane -L 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r J resize-pane -D 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r K resize-pane -U 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r L resize-pane -R 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># window navigation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">unbind n
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">unbind p
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r C-h previous-window # select previous window
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind -r C-l next-window # select next window
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">bind Tab last-window # move to last active window
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="vimrc">.vimrc
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat &amp;gt; ~/.vimrc &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Open file type detection
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">filetype on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Load the corresponding plugin according to the detected different types
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">filetype plugin on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Always show the status bar
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set laststatus=2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Display the current position of the cursor
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set ruler
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Turn on line number display
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set number
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Highlight current row/column
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set cursorline
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; set cursorcolumn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Highlight search results
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set hlsearch
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Prohibition of folding
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set nowrap
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Turn on syntax highlighting
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">syntax enable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Allows replacement of default schemes with the specified syntax highlighting scheme
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">syntax on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Adaptive smart indentation in different languages
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">filetype indent on
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Extend tabs to spaces
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set expandtab
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Set tabs to occupy spaces when editing
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set tabstop=2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Set the number of spaces occupied by tabs when formatting
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set shiftwidth=2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Let vim treat a continuous number of spaces as a tab
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set softtabstop=2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Code folding based on indentation or grammar
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34;set foldmethod=indent
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set foldmethod=syntax
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;#34; Turn off folding code when starting vim
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">set nofoldenable
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="gui">GUI
&lt;/h3>&lt;h4 id="app-store">App Store
&lt;/h4>&lt;ul>
&lt;li>&lt;a class="link" href="https://bark.day.app/#/" target="_blank" rel="noopener"
>Bark&lt;/a>: Bark is a push notification tool app&lt;/li>
&lt;li>&lt;a class="link" href="https://keepingyouawake.app/" target="_blank" rel="noopener"
>KeepingYouAwake&lt;/a>: Prevents your Mac from going to sleep&lt;/li>
&lt;li>&lt;a class="link" href="https://kyome.io/runcat/?lang=en" target="_blank" rel="noopener"
>RunCat&lt;/a>: The cat tells you the CPU usage of Mac by running speed&lt;/li>
&lt;/ul>
&lt;h4 id="brew-cask">Brew Cask
&lt;/h4>&lt;ul>
&lt;li>&lt;a class="link" href="https://raycast.com/" target="_blank" rel="noopener"
>Raycast&lt;/a>: Control your tools with a few keystrokes&lt;/li>
&lt;li>&lt;a class="link" href="https://iterm2.com/" target="_blank" rel="noopener"
>iTerm2&lt;/a>: Terminal emulator as alternative to Apple&amp;rsquo;s Terminal app&lt;/li>
&lt;li>&lt;a class="link" href="https://www.google.com/chrome/" target="_blank" rel="noopener"
>Google Chrome&lt;/a>: Web browser&lt;/li>
&lt;li>&lt;a class="link" href="https://www.wireshark.org" target="_blank" rel="noopener"
>Wireshark&lt;/a>: Network analyzer and capture tool - without graphical user interface&lt;/li>
&lt;li>&lt;a class="link" href="https://iina.io/" target="_blank" rel="noopener"
>IINA&lt;/a>: Free and open-source media player&lt;/li>
&lt;li>&lt;a class="link" href="https://inputsource.pro/" target="_blank" rel="noopener"
>Input Source Pro&lt;/a>: Tool for multi-language users&lt;/li>
&lt;li>&lt;a class="link" href="https://mos.caldis.me/" target="_blank" rel="noopener"
>Mos&lt;/a>: Smooths scrolling and set mouse scroll directions independently&lt;/li>
&lt;li>&lt;a class="link" href="https://mac.weixin.qq.com/" target="_blank" rel="noopener"
>WeChat&lt;/a>: Free messaging and calling application&lt;/li>
&lt;li>&lt;a class="link" href="https://discord.com/" target="_blank" rel="noopener"
>Discord&lt;/a>: Voice and text chat software&lt;/li>
&lt;li>&lt;a class="link" href="https://macos.telegram.org/" target="_blank" rel="noopener"
>Telegram&lt;/a>: Messaging app with a focus on speed and security&lt;/li>
&lt;li>&lt;a class="link" href="https://karabiner-elements.pqrs.org/" target="_blank" rel="noopener"
>Karabiner-Elements&lt;/a>Keyboard customiser&lt;/li>
&lt;li>&lt;a class="link" href="https://obsproject.com/" target="_blank" rel="noopener"
>OBS&lt;/a>: Open-source software for live streaming and screen recording&lt;/li>
&lt;li>&lt;a class="link" href="https://code.visualstudio.com/" target="_blank" rel="noopener"
>Visual Studio Code&lt;/a>: Open-source code editor&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">brew install --cask &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> iterm2 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> google-chrome &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> wireshark &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> iina &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> input-source-pro &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> mos &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> wechat &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> telegram &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> discord &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> karabiner-elements &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> obs &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> visual-studio-code
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="gui-configuration">GUI Configuration
&lt;/h4>&lt;h5 id="karabiner-elementss-complex-modifications">karabiner-elements&amp;rsquo;s Complex Modifications
&lt;/h5>&lt;p>F1:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;description&amp;#34;: &amp;#34;Change right_command key to command+control+option+shift. (Post f19 key when pressed alone)&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;manipulators&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;from&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;key_code&amp;#34;: &amp;#34;right_command&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;modifiers&amp;#34;: { &amp;#34;optional&amp;#34;: [&amp;#34;any&amp;#34;] }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;to&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;key_code&amp;#34;: &amp;#34;left_shift&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;modifiers&amp;#34;: [&amp;#34;left_command&amp;#34;, &amp;#34;left_control&amp;#34;, &amp;#34;left_option&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;to_if_alone&amp;#34;: [{ &amp;#34;key_code&amp;#34;: &amp;#34;f19&amp;#34; }],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;basic&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>F2:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;description&amp;#34;: &amp;#34;Press caps_lock to activate as CTRL&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;manipulators&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;from&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;key_code&amp;#34;: &amp;#34;caps_lock&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;modifiers&amp;#34;: { &amp;#34;optional&amp;#34;: [&amp;#34;any&amp;#34;] }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;to&amp;#34;: [{ &amp;#34;key_code&amp;#34;: &amp;#34;left_control&amp;#34; }],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;basic&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>服务器服务管理</title><link>https://www.lcsk42.com/post/deployment-configs/</link><pubDate>Tue, 04 Feb 2025 13:00:32 +0800</pubDate><guid>https://www.lcsk42.com/post/deployment-configs/</guid><description>&lt;p>介绍一下服务器中服务管理的方法。&lt;/p>
&lt;h2 id="服务器服务管理">服务器服务管理
&lt;/h2>&lt;h3 id="管理技术选型">管理技术选型
&lt;/h3>&lt;p>在服务器服务管理中，选择合适的管理技术至关重要。当前，虚拟化技术因其高效性和灵活性，成为管理容器的首选方案。基于此，Docker 被选为运行各项服务的基础平台。Docker 不仅提供了轻量级的虚拟化环境，还能确保应用在不同环境中的一致性，极大地简化了部署和迁移过程。&lt;/p>
&lt;p>然而，直接使用 &lt;code>docker run&lt;/code> 命令来运行各个服务存在一定的局限性，尤其是在服务数量增多时，难以进行有效的归类整理和统一管理。为了解决这一问题，&lt;code>docker-compose&lt;/code> 被选为服务管理工具。&lt;code>docker-compose&lt;/code> 允许通过一个简单的 YAML 文件定义和管理多个容器，极大地提高了服务的可维护性和可扩展性。&lt;/p>
&lt;p>关于为什么不使用 Kubernetes (k8s) 或 k3s 等更复杂的容器编排系统，主要原因在于它们的体量较大，适合大规模、高可用性的生产环境。在企业生产实践中，为了保证服务的高可用性，通常会采用多实例部署，并依赖滚动更新、自动重启等功能。然而，对于当前场景，服务的体量较小，且对高可用性的要求相对较低。更倾向于在服务出现问题时，通过及时通知和手动干预来恢复服务，而不是依赖复杂的自动化机制。因此，选择 &lt;code>docker-compose&lt;/code> 不仅简化了管理流程，还降低了系统的复杂性和维护成本。&lt;/p>
&lt;p>综上所述，基于当前的需求和技术特点，使用 Docker 结合 &lt;code>docker-compose&lt;/code> 是一种既高效又实用的服务器服务管理方案。&lt;/p>
&lt;h3 id="文件夹结构">文件夹结构
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">- deployment-configs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|-- scripts # 用于管理服务的实用程序脚本
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |-- start-all.sh # 启动所有服务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |-- stop-all.sh # 关闭所有服务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|-- services # 包含各个服务的配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |-- bark # bark 通知服务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |-- data # bark 数据存醋
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |-- docker-compose.yml # bark 启动配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |-- mysql # mysql 数据库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |-- data # mysql 数据存醋
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |-- docker-compose.yml # mysql 启动配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |-- logs # mysql 日志文件位置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | |-- my.cnf # mysql 相关配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|-- shared # 包括环境变量和网络设置等共享配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| |-- common.env # 通用环境变量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|-- README.md # 介绍各个服务和相关命令
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>提供一下脚本，可直接执行，创建响应的目录结构&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建根目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p deployment-configs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 进入根目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> deployment-configs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建 scripts 目录及其文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p scripts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建 start-all.sh 文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch scripts/start-all.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 写入以下内容到 start-all.sh 文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &lt;span class="s">&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39; &amp;gt; scripts/start-all.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># Start all services defined in the &amp;#39;services&amp;#39; directory
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">echo &amp;#34;Starting all services...&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># Loop through each service directory and bring up the service
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">for service in services/*; do
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if [ -d &amp;#34;$service&amp;#34; ]; then
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> echo &amp;#34;Starting service: $service&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> cd &amp;#34;$service&amp;#34; || continue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> docker-compose up -d
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> cd - || continue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> fi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">done
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">echo &amp;#34;All services started.&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建 stop-all.sh 文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch scripts/stop-all.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 写入 stop-all.sh 内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &lt;span class="s">&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39; &amp;gt; scripts/stop-all.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># Stop all services defined in the &amp;#39;services&amp;#39; directory
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">echo &amp;#34;Stopping all services...&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># Loop through each service directory and bring down the service
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">for service in services/*; do
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if [ -d &amp;#34;$service&amp;#34; ]; then
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> echo &amp;#34;Stopping service: $service&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> cd &amp;#34;$service&amp;#34; || continue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> docker-compose down
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> cd - || continue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> fi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">done
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">echo &amp;#34;All services stopped.&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建 services 目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p services/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建 shared 目录及其文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p shared
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch shared/common.env
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建 README.md 文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &lt;span class="s">&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39; &amp;gt; README.md
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># Deployment Configs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">## Overview
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">This repository contains configuration files and setups for deploying services using Docker Compose. It is organized into modular directories for individual services and shared resources.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">## Structure
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">- `services/`: Contains configurations for individual services.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">- `shared/`: Includes shared configurations such as environment variables and network settings.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">- `scripts/`: Utility scripts for managing services.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 设置文件权限（可选）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x scripts/start-all.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x scripts/stop-all.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="如何保留空文件夹">如何保留空文件夹
&lt;/h3>&lt;p>在使用 Git 进行服务管理和同步时，通常不希望将 &lt;code>data&lt;/code>、&lt;code>logs&lt;/code> 等文件夹中的文件同步到远程仓库，因为这些文件可能包含临时数据或敏感信息。为了避免这些文件被同步，可以通过配置 &lt;code>.gitignore&lt;/code> 文件来忽略它们，例如：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">**/data/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**/logs/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**/cert/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**/nginx/files/**
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然而，配置忽略规则后，在推送代码到远程仓库或从远程仓库拉取代码时，这些文件夹将不会被创建。这可能导致在运行 docker-compose up -d 启动服务时出现问题，因为某些服务可能依赖这些文件夹的存在。&lt;/p>
&lt;p>为了解决这一问题，既需要避免将文件夹中的文件同步到远程仓库，又需要确保这些空文件夹能够被传输到远程并在拉取时保留，可以在每个需要保留的文件夹中添加一个 &lt;code>.gitignore&lt;/code> 文件，并在其中配置规则，使其不忽略自身。具体方法如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s1">&amp;#39;*\n!.gitignore&amp;#39;&lt;/span> &amp;gt;&amp;gt; .gitignore
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上述命令会在 &lt;code>.gitignore&lt;/code> 文件中添加两行内容：第一行 &lt;code>*&lt;/code> 表示忽略该文件夹中的所有文件，第二行 &lt;code>!.gitignore&lt;/code> 表示不忽略 &lt;code>.gitignore&lt;/code> 文件本身。这样，Git 会保留空文件夹及其中的 &lt;code>.gitignore&lt;/code> 文件，同时忽略其他文件，从而满足服务启动时的依赖需求。&lt;/p>
&lt;p>通过这种方式，既避免了不必要文件的同步，又确保了文件夹结构的完整性。&lt;/p></description></item><item><title>Docker Compose 服务依赖和健康检查</title><link>https://www.lcsk42.com/post/docker-depend-and-health/</link><pubDate>Sat, 01 Jun 2024 10:06:34 +0800</pubDate><guid>https://www.lcsk42.com/post/docker-depend-and-health/</guid><description>&lt;p>介绍 Docker Compose 服务依赖和健康检查相关知识。&lt;/p>
&lt;h2 id="概念介绍">概念介绍
&lt;/h2>&lt;h3 id="什么是服务依赖">什么是服务依赖？
&lt;/h3>&lt;p>服务启动有先后顺序，B 依赖 A，如部署 Service 服务一般需要依赖 Database, 这时我们需要先启动数据库，再启动我们的应用程序。&lt;/p>
&lt;h3 id="如何使用服务依赖">如何使用服务依赖？
&lt;/h3>&lt;p>在 docker-compose.yml 中指定 &lt;code>depends_on&lt;/code> 参数可以指定容器的启动顺序，B 服务要晚于 A 服务启动，则需要在 B 服务配置 &lt;code>depends_on&lt;/code> A 服务。&lt;/p>
&lt;h3 id="什么是健康检查">什么是健康检查？
&lt;/h3>&lt;p>容器启动后，判断其是否可以正常对外提供服务，不能服务启动了是 &lt;code>up&lt;/code> 状态，但是里面的服务一直在报错，这样事实上是启动有问题的，这个就是健康检查。&lt;/p>
&lt;h3 id="如何进行健康检查">如何进行健康检查？
&lt;/h3>&lt;p>容器本身提供的有健康检查，可以在服务启动时，或者 Dockerfile 中指定相关参数, 不过使用更多的还是直接在 docker-compose.yml 中指定。&lt;/p>
&lt;p>服务启动时：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">--health-cmd string Command to run to check health
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--health-interval duration Time between running the check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">(&lt;/span>ms&lt;span class="p">|&lt;/span>s&lt;span class="p">|&lt;/span>m&lt;span class="p">|&lt;/span>h&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>default 0s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--health-retries int Consecutive failures needed to
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> report unhealthy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--health-start-period duration Start period &lt;span class="k">for&lt;/span> the container to
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> initialize before starting
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> health-retries countdown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">(&lt;/span>ms&lt;span class="p">|&lt;/span>s&lt;span class="p">|&lt;/span>m&lt;span class="p">|&lt;/span>h&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>default 0s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--health-timeout duration Maximum &lt;span class="nb">time&lt;/span> to allow one check to
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Dockerfile 指定：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">HEALTHCHECK &lt;span class="o">[&lt;/span>OPTIONS&lt;span class="o">]&lt;/span> CMD &lt;span class="nb">command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The options that can appear before CMD are:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--interval&lt;span class="o">=&lt;/span>DURATION &lt;span class="o">(&lt;/span>default: 30s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--timeout&lt;span class="o">=&lt;/span>DURATION &lt;span class="o">(&lt;/span>default: 30s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--start-period&lt;span class="o">=&lt;/span>DURATION &lt;span class="o">(&lt;/span>default: 0s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--start-interval&lt;span class="o">=&lt;/span>DURATION &lt;span class="o">(&lt;/span>default: 5s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--retries&lt;span class="o">=&lt;/span>N &lt;span class="o">(&lt;/span>default: 3&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>docker-compose 方式指定:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">healthcheck:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> test: &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;CMD&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;curl&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;http://127.0.0.1:8080&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># healthcheck 间隔时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interval: 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 执行命令超时时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout: 3s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 重试次数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> retries: &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 容器启动多久后开始执行 healthcheck&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start_period: 10s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="两者的结合">两者的结合？
&lt;/h3>&lt;p>我们实际使用中遇到的情况可能是，B 服务依赖 A 服务，但是 A 服务开始启动之后，实际需要耗时一段时间（初始化数据等操作），此时如果直接启动 B 服务，就会报错，所以我们需要在 A 服务启动成功，能对外提供服务时，才开始启动 B 服务。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">异常情况(只使用 depends_on)：B 服务 需要访问 A 服务时，A 服务还在启动中，B 服务报错
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A [-----created-----](up)[-----starting-----][-----running-----]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">B [-created-][-starting-][-error-]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">正确情况: A 服务启动完成后，开始对外提供服务，开始启动 B 服务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A [-----created-----][-----starting-----](healthy)[-----running-----]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">B [-created-] [-starting-][-error-]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="如何解决">如何解决？
&lt;/h3>&lt;p>在 A 服务中配置健康检查，在 B 服务的服务依赖中配置 A 服务的服务状态为健康。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceA&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">healthcheck&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">test&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CMD&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;curl&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;http://127.0.0.1:8080&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">3s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">retries&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">start_period&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceB&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">depends_on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceA&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">service_healthy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="具体示例">具体示例
&lt;/h2>&lt;blockquote>
&lt;p>&lt;strong>请注意&lt;/strong>：此文件仅作为测试使用，无实际意义。&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker-compose down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; docker-compose.yml &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">version: &amp;#39;3.9&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">services:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> mysql8:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> image: mysql:8
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> environment:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - MYSQL_ROOT_PASSWORD=lucas
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> healthcheck:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> test:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> [
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;CMD&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;mysql&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;-u&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;root&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;-plucas&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;-e&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;select 1&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> interval: 10s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> timeout: 3s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> retries: 5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> start_period: 10s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> tomcat9:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> image: tomcat:9
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> depends_on:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> mysql8:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> condition: service_healthy
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> healthcheck:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> test: [ &amp;#34;CMD&amp;#34;, &amp;#34;curl&amp;#34;, &amp;#34;http://127.0.0.1:8080&amp;#34; ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> interval: 10s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> timeout: 3s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> retries: 5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> start_period: 10s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-compose up -d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="正常启动日志">正常启动日志
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Running 0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ⠇ Network docker_default Created 1.9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ⠇ Container docker-mysql8-1 Waiting 1.9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ⠇ Container docker-tomcat9-1 Created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Running 2/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ⠹ Network docker_default Created 11.2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ Container docker-mysql8-1 Healthy 10.9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ Container docker-tomcat9-1 Started 11.1s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ docker ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">33036c106e99 tomcat:9 &lt;span class="s2">&amp;#34;catalina.sh run&amp;#34;&lt;/span> &lt;span class="m">16&lt;/span> seconds ago Up &lt;span class="m">5&lt;/span> seconds &lt;span class="o">(&lt;/span>health: starting&lt;span class="o">)&lt;/span> 8080/tcp docker-tomcat9-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5f778d7b5c8d mysql:8 &lt;span class="s2">&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span> &lt;span class="m">16&lt;/span> seconds ago Up &lt;span class="m">15&lt;/span> seconds &lt;span class="o">(&lt;/span>healthy&lt;span class="o">)&lt;/span> 3306/tcp, 33060/tcp docker-mysql8-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ docker ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">33036c106e99 tomcat:9 &lt;span class="s2">&amp;#34;catalina.sh run&amp;#34;&lt;/span> &lt;span class="m">22&lt;/span> seconds ago Up &lt;span class="m">11&lt;/span> seconds &lt;span class="o">(&lt;/span>healthy&lt;span class="o">)&lt;/span> 8080/tcp docker-tomcat9-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5f778d7b5c8d mysql:8 &lt;span class="s2">&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span> &lt;span class="m">22&lt;/span> seconds ago Up &lt;span class="m">22&lt;/span> seconds &lt;span class="o">(&lt;/span>healthy&lt;span class="o">)&lt;/span> 3306/tcp, 33060/tcp docker-mysql8-1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="启动过程分析">启动过程分析
&lt;/h3>&lt;ol>
&lt;li>刚开始启动时，docker-mysql8-1 在 &lt;code>Waiting&lt;/code> 中。等待启动后的服务检查，docker-tomcat9-1 处于 &lt;code>Created&lt;/code> (容器创建了，再等待启动)&lt;/li>
&lt;li>docker-mysql8-1 状态为 &lt;code>Healthy&lt;/code>(启动成功，健康检查正常)，此时 docker-tomcat9-1 开始启动&lt;/li>
&lt;li>刚开始查看服务状态时，docker-tomcat9-1 服务的 &lt;code>STATUS&lt;/code> 为 (&lt;code>health: starting&lt;/code>)&lt;/li>
&lt;li>过了一段时间后，docker-tomcat9-1 服务的 &lt;code>STATUS&lt;/code> 变为 (&lt;code>health&lt;/code>)&lt;/li>
&lt;/ol>
&lt;h3 id="健康检查失败日志">健康检查失败日志
&lt;/h3>&lt;p>我们修改 mysql 的健康检查语句，使其执行失败，查看如果健康检查失败会是什么结果&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">[dependencies.bevy]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-compose.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- &amp;#34;-plucas&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ &amp;#34;-perrorpassword&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Running 1/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ⠧ Network docker_default Created 50.8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✘ Container docker-mysql8-1 Error 50.7s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ⠧ Container docker-tomcat9-1 Created 50.7s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dependency failed to start: container docker-mysql8-1 is unhealthy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ docker ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">868b161494b0 mysql:8 &lt;span class="s2">&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span> &lt;span class="m">57&lt;/span> seconds ago Up &lt;span class="m">57&lt;/span> seconds &lt;span class="o">(&lt;/span>unhealthy&lt;span class="o">)&lt;/span> 3306/tcp, 33060/tcp docker-mysql8-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ docker ps -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">52c90d95d7e9 tomcat:9 &lt;span class="s2">&amp;#34;catalina.sh run&amp;#34;&lt;/span> About a minute ago Created docker-tomcat9-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">868b161494b0 mysql:8 &lt;span class="s2">&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span> About a minute ago Up About a minute &lt;span class="o">(&lt;/span>unhealthy&lt;span class="o">)&lt;/span> 3306/tcp, 33060/tcp docker-mysql8-1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="失败日志分析">失败日志分析
&lt;/h3>&lt;ol>
&lt;li>首先启动时，docker-tomcat9-1 一直在等待，docker-mysql8-1 最终创建失败，耗时 50s (&lt;code>interval 10s&lt;/code> * &lt;code>retries 5&lt;/code>) 左右&lt;/li>
&lt;li>使用 docker ps -a 可以查看所有的容器状态，可以看到 docker-mysql8-1 为 &lt;code>unhealthy&lt;/code>, docker-tomcat9-1 为 &lt;code>Created&lt;/code> 并未启动&lt;/li>
&lt;/ol>
&lt;h3 id="如何查看分析错误">如何查看分析错误
&lt;/h3>&lt;p>使用 docker 的 &lt;code>inspect&lt;/code> 命令, 在 &lt;code>State.Health.Log&lt;/code> 中可以看到相关错误信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">❯ docker inspect docker-mysql8-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Status&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;running&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Running&amp;#34;&lt;/span>: true,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Paused&amp;#34;&lt;/span>: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Restarting&amp;#34;&lt;/span>: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;OOMKilled&amp;#34;&lt;/span>: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Dead&amp;#34;&lt;/span>: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Pid&amp;#34;&lt;/span>: 35046,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ExitCode&amp;#34;&lt;/span>: 0,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Error&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;StartedAt&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-05-31T18:13:03.413731054Z&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;FinishedAt&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;0001-01-01T00:00:00Z&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Health&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Status&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;unhealthy&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;FailingStreak&amp;#34;&lt;/span>: 39,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Log&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Start&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:18:54.821003238+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;End&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:18:54.860412275+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ExitCode&amp;#34;&lt;/span>: 1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Output&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;mysql: [Warning] Using a password on the command line interface can be insecure.\nERROR 1045 (28000): Access denied for user &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; (using password: YES)\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Start&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:04.862050738+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;End&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:04.905490712+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ExitCode&amp;#34;&lt;/span>: 1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Output&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;mysql: [Warning] Using a password on the command line interface can be insecure.\nERROR 1045 (28000): Access denied for user &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; (using password: YES)\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Start&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:14.907068839+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;End&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:14.941198241+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ExitCode&amp;#34;&lt;/span>: 1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Output&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;mysql: [Warning] Using a password on the command line interface can be insecure.\nERROR 1045 (28000): Access denied for user &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; (using password: YES)\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Start&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:24.94265745+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;End&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:24.980647633+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ExitCode&amp;#34;&lt;/span>: 1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Output&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;mysql: [Warning] Using a password on the command line interface can be insecure.\nERROR 1045 (28000): Access denied for user &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; (using password: YES)\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Start&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:34.983078462+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;End&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;2024-06-01T02:19:35.023463408+08:00&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ExitCode&amp;#34;&lt;/span>: 1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Output&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;mysql: [Warning] Using a password on the command line interface can be insecure.\nERROR 1045 (28000): Access denied for user &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; (using password: YES)\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Arthas</title><link>https://www.lcsk42.com/post/arthas/</link><pubDate>Fri, 22 Mar 2024 09:39:46 +0800</pubDate><guid>https://www.lcsk42.com/post/arthas/</guid><description>&lt;p>Alibaba 开源的 Java 诊断工具 Arthas 使用记录。&lt;/p>
&lt;h2 id="开始">开始
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 下载启动测试程序&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://arthas.aliyun.com/math-game.jar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">java -jar math-game.jar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下载启动 arthas&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://arthas.aliyun.com/arthas-boot.jar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">java -jar arthas-boot.jar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="表达式核心变量">表达式核心变量
&lt;/h2>&lt;p>无论是匹配表达式也好、观察表达式也罢，他们核心判断变量都是围绕着一个 Arthas 中的通用通知对象 &lt;code>Advice&lt;/code> 进行。&lt;/p>
&lt;p>它的简略代码结构如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Advice&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ClassLoader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">loader&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">clazz&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArthasMethod&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">returnObj&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Throwable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">throwExp&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isBefore&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isThrow&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isReturn&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// getter/setter&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里列一个表格来说明不同变量的含义&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">变量名&lt;/th>
&lt;th>变量解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">loader&lt;/td>
&lt;td>本次调用类所在的 ClassLoader&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">clazz&lt;/td>
&lt;td>本次调用类的 Class 引用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">method&lt;/td>
&lt;td>本次调用方法反射引用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">target&lt;/td>
&lt;td>本次调用类的实例&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">params&lt;/td>
&lt;td>本次调用参数列表，这是一个数组，如果方法是无参方法则为空数组&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">returnObj&lt;/td>
&lt;td>本次调用返回的对象。当且仅当 isReturn==true 成立时候有效，表明方法调用是以正常返回的方式结束。如果当前方法无返回值 void，则值为 null&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">throwExp&lt;/td>
&lt;td>本次调用抛出的异常。当且仅当 isThrow==true 成立时有效，表明方法调用是以抛出异常的方式结束。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">isBefore&lt;/td>
&lt;td>辅助判断标记，当前的通知节点有可能是在方法一开始就通知，此时 isBefore==true 成立，同时 isThrow==false 和 isReturn==false，因为在方法刚开始时，还无法确定方法调用将会如何结束。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">isThrow&lt;/td>
&lt;td>辅助判断标记，当前的方法调用以抛异常的形式结束。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">isReturn&lt;/td>
&lt;td>辅助判断标记，当前的方法调用以正常返回的形式结束。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>所有变量都可以在表达式中直接使用，如果在表达式中编写了不符合 OGNL 脚本语法或者引入了不在表格中的变量，则退出命令的执行；用户可以根据当前的异常信息修正 &lt;code>条件表达式 &lt;/code>或 &lt;code>观察表达式&lt;/code>。&lt;/p>
&lt;h2 id="基础命令">基础命令
&lt;/h2>&lt;h3 id="help">help
&lt;/h3>&lt;p>查看命令帮助信息，可以查看当前 arthas 版本支持的指令，或者查看具体指令的使用说明。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">不接参数&lt;/td>
&lt;td>查询当前 arthas 版本支持的指令以及指令描述&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[name:]&lt;/td>
&lt;td>查询具体指令的使用说明&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">help&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NAME DESCRIPTION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">help&lt;/span> Display Arthas Help
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth Authenticates the current session
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> keymap Display all the available keymap &lt;span class="k">for&lt;/span> the specified connection.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sc Search all the classes loaded by JVM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sm Search the method of classes loaded by JVM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> classloader Show classloader info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jad Decompile class
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> getstatic Show the static field of a class
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> monitor Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stack Display the stack trace &lt;span class="k">for&lt;/span> the specified class and method
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> thread Display thread info, thread stack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> trace Trace the execution &lt;span class="nb">time&lt;/span> of specified method invocation.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> watch Display the input/output parameter, &lt;span class="k">return&lt;/span> object, and thrown exception of specified method invocation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tt Time Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jvm Display the target JVM information
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory Display jvm memory info.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> perfcounter Display the perf counter information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ognl Execute ognl expression.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mc Memory compiler, compiles java files into bytecode and class files in memory.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redefine Redefine classes. @see Instrumentation#redefineClasses&lt;span class="o">(&lt;/span>ClassDefinition...&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> retransform Retransform classes. @see Instrumentation#retransformClasses&lt;span class="o">(&lt;/span>Class...&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dashboard Overview of target jvm&lt;span class="err">&amp;#39;&lt;/span>s thread, memory, gc, vm, tomcat info.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dump Dump class byte array from JVM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> heapdump Heap dump
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> options View and change various Arthas options
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cls Clear the screen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reset Reset all the enhanced classes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version Display Arthas version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> session Display current session information
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysprop Display and change the system properties.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysenv Display the system env.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vmoption Display, and update the vm diagnostic options.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> logger Print logger info, and update the logger level
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">history&lt;/span> Display &lt;span class="nb">command&lt;/span> &lt;span class="nb">history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cat Concatenate and print files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> base64 Encode and decode using Base64 representation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> write arguments to the standard output
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">pwd&lt;/span> Return working directory name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mbean Display the mbean information
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> grep grep &lt;span class="nb">command&lt;/span> &lt;span class="k">for&lt;/span> pipes.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tee tee &lt;span class="nb">command&lt;/span> &lt;span class="k">for&lt;/span> pipes.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profiler Async Profiler. https://github.com/jvm-profiling-tools/async-profiler
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vmtool jvm tool
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stop Stop/Shutdown Arthas server and &lt;span class="nb">exit&lt;/span> the console.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jfr Java Flight Recorder Command
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">help&lt;/span> dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> USAGE:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dashboard &lt;span class="o">[&lt;/span>-h&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>-i &amp;lt;value&amp;gt;&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>-n &amp;lt;value&amp;gt;&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SUMMARY:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Overview of target jvm&lt;span class="err">&amp;#39;&lt;/span>s thread, memory, gc, vm, tomcat info.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EXAMPLES:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dashboard -n &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dashboard -i &lt;span class="m">2000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> WIKI:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://arthas.aliyun.com/doc/dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OPTIONS:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -h, --help this &lt;span class="nb">help&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -i, --interval &amp;lt;value&amp;gt; The interval &lt;span class="o">(&lt;/span>in ms&lt;span class="o">)&lt;/span> between two executions, default is &lt;span class="m">5000&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -n, --number-of-execution &amp;lt;value&amp;gt; The number of &lt;span class="nb">times&lt;/span> this &lt;span class="nb">command&lt;/span> will be executed.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="cls">cls
&lt;/h3>&lt;p>清空当前屏幕区域。&lt;/p>
&lt;h3 id="session">session
&lt;/h3>&lt;p>查看当前会话的信息，显示当前绑定的 pid 以及会话 id。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>如果配置了 tunnel server，会追加打印 代理 id、tunnel 服务器的 url 以及连接状态。&lt;/p>
&lt;p>如果使用了 staturl 做统计，会追加显示 statUrl 地址。&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ session
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name Value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> JAVA_PID &lt;span class="m">96956&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SESSION_ID 14219aff-0255-4e7d-aaa8-244061bd8277
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="reset">reset
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>重置增强类，将被 Arthas 增强过的类全部还原，Arthas 服务端 stop 时会重置所有增强过的类&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 还原指定类&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reset Test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 还原所有类&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reset
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="version">version
&lt;/h3>&lt;p>输出当前目标 Java 进程所加载的 Arthas 版本号&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3.7.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="history">history
&lt;/h3>&lt;p>打印命令历史。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>历史指令会通过一个名叫 history 的文件持久化，所以 history 指令可以查看当前 arthas 服务器的所有历史命令，而不仅只是当前次会话使用过的命令。&lt;/p>&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>清空历史指令&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>显示最近执行的 n 条指令&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="quit-stop">quit-stop
&lt;/h3>&lt;p>退出当前 Arthas 客户端，其他 Arthas 客户端不受影响。等同于 exit、logout、q 三个指令。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>只是退出当前 Arthas 客户端，Arthas 的服务器端并没有关闭，所做的修改也不会被重置。&lt;/p>&lt;/blockquote>
&lt;h3 id="keymap">keymap
&lt;/h3>&lt;p>&lt;code>keymap&lt;/code> 命令输出当前的快捷键映射表：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>快捷键&lt;/th>
&lt;th>快捷键说明&lt;/th>
&lt;th>命令名称&lt;/th>
&lt;th>命令说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&amp;ldquo;\C-a&amp;rdquo;&lt;/td>
&lt;td>ctrl + a&lt;/td>
&lt;td>beginning-of-line&lt;/td>
&lt;td>跳到行首&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-e&amp;rdquo;&lt;/td>
&lt;td>ctrl + e&lt;/td>
&lt;td>end-of-line&lt;/td>
&lt;td>跳到行尾&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-f&amp;rdquo;&lt;/td>
&lt;td>ctrl + f&lt;/td>
&lt;td>forward-word&lt;/td>
&lt;td>向前移动一个单词&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-b&amp;rdquo;&lt;/td>
&lt;td>ctrl + b&lt;/td>
&lt;td>backward-word&lt;/td>
&lt;td>向后移动一个单词&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\e[D&amp;rdquo;&lt;/td>
&lt;td>键盘左方向键&lt;/td>
&lt;td>backward-char&lt;/td>
&lt;td>光标向前移动一个字符&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\e[C&amp;rdquo;&lt;/td>
&lt;td>键盘右方向键&lt;/td>
&lt;td>forward-char&lt;/td>
&lt;td>光标向后移动一个字符&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\e[B&amp;rdquo;&lt;/td>
&lt;td>键盘下方向键&lt;/td>
&lt;td>next-history&lt;/td>
&lt;td>下翻显示下一个命令&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\e[A&amp;rdquo;&lt;/td>
&lt;td>键盘上方向键&lt;/td>
&lt;td>previous-history&lt;/td>
&lt;td>上翻显示上一个命令&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-h&amp;rdquo;&lt;/td>
&lt;td>ctrl + h&lt;/td>
&lt;td>backward-delete-char&lt;/td>
&lt;td>向后删除一个字符&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-?&amp;rdquo;&lt;/td>
&lt;td>ctrl + shift + /&lt;/td>
&lt;td>backward-delete-char&lt;/td>
&lt;td>向后删除一个字符&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-u&amp;rdquo;&lt;/td>
&lt;td>ctrl + u&lt;/td>
&lt;td>undo&lt;/td>
&lt;td>撤销上一个命令，相当于清空当前行&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-d&amp;rdquo;&lt;/td>
&lt;td>ctrl + d&lt;/td>
&lt;td>delete-char&lt;/td>
&lt;td>删除当前光标所在字符&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-k&amp;rdquo;&lt;/td>
&lt;td>ctrl + k&lt;/td>
&lt;td>kill-line&lt;/td>
&lt;td>删除当前光标到行尾的所有字符&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-i&amp;rdquo;&lt;/td>
&lt;td>ctrl + i&lt;/td>
&lt;td>complete&lt;/td>
&lt;td>自动补全，相当于敲 TAB&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-j&amp;rdquo;&lt;/td>
&lt;td>ctrl + j&lt;/td>
&lt;td>accept-line&lt;/td>
&lt;td>结束当前行，相当于敲回车&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-m&amp;rdquo;&lt;/td>
&lt;td>ctrl + m&lt;/td>
&lt;td>accept-line&lt;/td>
&lt;td>结束当前行，相当于敲回车&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-w&amp;rdquo;&lt;/td>
&lt;td>-&lt;/td>
&lt;td>backward-delete-word&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\C-x\e[3~&amp;rdquo;&lt;/td>
&lt;td>-&lt;/td>
&lt;td>backward-kill-line&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;ldquo;\e\C-?&amp;rdquo;&lt;/td>
&lt;td>-&lt;/td>
&lt;td>backward-kill-word&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>任何时候 tab 键，会根据当前的输入给出提示&lt;/li>
&lt;li>命令后敲 - 或 &amp;ndash; ，然后按 tab 键，可以展示出此命令具体的选项&lt;/li>
&lt;/ul>
&lt;h4 id="自定义快捷键">自定义快捷键
&lt;/h4>&lt;p>在当前用户目录下新建 &lt;code>$USER_HOME/.arthas/conf/inputrc&lt;/code> 文件，加入自定义配置。&lt;/p>
&lt;h4 id="后台异步命令相关快捷键">后台异步命令相关快捷键
&lt;/h4>&lt;p>ctrl + c: 终止当前命令
ctrl + z: 挂起当前命令，后续可以 bg/fg 重新支持此命令，或 kill 掉
ctrl + a: 回到行首
ctrl + e: 回到行尾&lt;/p>
&lt;h3 id="cat">cat
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>打印文件内容，和 linux 里的 cat 命令类似。&lt;/p>&lt;/blockquote>
&lt;h3 id="echo">echo
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>打印参数，和 linux 里的 echo 命令类似。&lt;/p>&lt;/blockquote>
&lt;h3 id="grep">grep
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>类似传统的 grep 命令。&lt;/p>&lt;/blockquote>
&lt;h3 id="tee">tee
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>类似传统的 tee 命令, 用于读取标准输入的数据，并将其内容输出成文件。&lt;/p>
&lt;p>tee 指令会从标准输入设备读取数据，将其内容输出到标准输出设备，同时保存成文件。&lt;/p>&lt;/blockquote>
&lt;h3 id="pwd">pwd
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>返回当前的工作目录，和 linux 命令类似&lt;/p>&lt;/blockquote>
&lt;h3 id="plaintext">plaintext
&lt;/h3>&lt;h3 id="wc">wc
&lt;/h3>&lt;h3 id="options">options
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>全局开关&lt;/p>&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>名称&lt;/th>
&lt;th>默认值&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>unsafe&lt;/td>
&lt;td>false&lt;/td>
&lt;td>是否支持对系统级别的类进行增强，打开该开关可能导致把 JVM 搞挂，请慎重选择！&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>dump&lt;/td>
&lt;td>false&lt;/td>
&lt;td>是否支持被增强了的类 dump 到外部文件中，如果打开开关，class 文件会被 dump 到/${application working dir}/arthas-class-dump/目录下，具体位置详见控制台输出&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>batch-re-transform&lt;/td>
&lt;td>true&lt;/td>
&lt;td>是否支持批量对匹配到的类执行 retransform 操作&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>json-format&lt;/td>
&lt;td>false&lt;/td>
&lt;td>是否支持 json 化的输出&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>disable-sub-class&lt;/td>
&lt;td>false&lt;/td>
&lt;td>是否禁用子类匹配，默认在匹配目标类的时候会默认匹配到其子类，如果想精确匹配，可以关闭此开关&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>support-default-method&lt;/td>
&lt;td>true&lt;/td>
&lt;td>是否支持匹配到 default method， 默认会查找 interface，匹配里面的 default method。参考 #1105 在新窗口打开&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>save-result&lt;/td>
&lt;td>false&lt;/td>
&lt;td>是否打开执行结果存日志功能，打开之后所有命令的运行结果都将保存到~/logs/arthas-cache/result.log 中&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>job-timeout&lt;/td>
&lt;td>1d&lt;/td>
&lt;td>异步后台任务的默认超时时间，超过这个时间，任务自动停止；比如设置 1d, 2h, 3m, 25s，分别代表天、小时、分、秒&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>print-parent-fields&lt;/td>
&lt;td>true&lt;/td>
&lt;td>是否打印在 parent class 里的 filed&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>verbose&lt;/td>
&lt;td>false&lt;/td>
&lt;td>是否打印更多详细信息&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>strict&lt;/td>
&lt;td>true&lt;/td>
&lt;td>是否启用 strict 模式&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看所有的 options&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">options
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 获取 option 的值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">options json-format
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 设置指定的 option&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">options save-result &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>默认情况下 &lt;code>json-format&lt;/code> 为 false，如果希望 &lt;code>watch&lt;/code>/&lt;code>tt&lt;/code> 等命令结果以 json 格式输出，则可以设置 &lt;code>json-format&lt;/code> 为 true。&lt;/p>&lt;/blockquote>
&lt;h4 id="打开-unsafe-开关支持-jdk-package-下的类">打开 unsafe 开关，支持 jdk package 下的类
&lt;/h4>&lt;p>默认情况下，&lt;code>watch&lt;/code>/&lt;code>trace&lt;/code>/&lt;code>tt&lt;/code>/&lt;code>trace&lt;/code>/&lt;code>monitor&lt;/code> 等命令不支持 &lt;code>java.\*&lt;/code> package 下的类。可以设置 &lt;code>unsafe&lt;/code> 为 true，则可以增强。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">options unsafe &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="关闭-strict-模式允许在-ognl-表达式里设置对象属性">关闭 strict 模式，允许在 ognl 表达式里设置对象属性
&lt;/h4>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>since 3.6.0&lt;/p>&lt;/blockquote>
&lt;p>对于新用户，在编写 ognl 表达式时，可能会出现误用。&lt;/p>
&lt;p>比如对于 &lt;code>Student&lt;/code>，判断年龄等于 18 时，可能条件表达式会误写为 &lt;code>target.age=18&lt;/code>，这个表达式实际上是把当前对象的 &lt;code>age&lt;/code> 设置为 18 了。正确的写法是 &lt;code>target.age==18&lt;/code>。&lt;/p>
&lt;p>为了防止出现类似上面的误用，Arthas 默认启用 &lt;code>strict&lt;/code> 模式，在 &lt;code>ognl&lt;/code> 表达式里，禁止更新对象的 Property 或者调用 &lt;code>setter&lt;/code> 函数。&lt;/p>
&lt;p>以 &lt;code>MathGame&lt;/code> 为例，会出现以下的错误提示。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s1">&amp;#39;target&amp;#39;&lt;/span> &lt;span class="s1">&amp;#39;target.illegalArgumentCount=1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">20&lt;/span> ms, listenerId: &lt;span class="m">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch failed, condition is: target.illegalArgumentCount&lt;span class="o">=&lt;/span>1, express is: target, By default, strict mode is true, not allowed to &lt;span class="nb">set&lt;/span> object properties. Want to &lt;span class="nb">set&lt;/span> object properties, execute &lt;span class="sb">`&lt;/span>options strict &lt;span class="nb">false&lt;/span>&lt;span class="sb">`&lt;/span>, visit /Users/lucaschen/logs/arthas/arthas.log &lt;span class="k">for&lt;/span> more details.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用户如果确定要在 &lt;code>ognl&lt;/code> 表达式里更新对象，可以执行 &lt;code>options strict false&lt;/code>，关闭 strict 模式。&lt;/p>
&lt;h2 id="系统命令">系统命令
&lt;/h2>&lt;h3 id="dashboard">dashboard
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>&lt;/blockquote>
&lt;p>当前系统的实时数据面板，按 ctrl+c 退出。&lt;/p>
&lt;p>当运行在 Ali-tomcat 时，会显示当前 tomcat 的实时信息，如 HTTP 请求的 qps, rt, 错误数, 线程池信息等等。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">[i:]&lt;/td>
&lt;td>刷新实时数据的时间间隔 (ms)，默认 5000ms&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>刷新实时数据的次数&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;img src="https://www.lcsk42.com/post/arthas/dashboard.png"
width="1209"
height="920"
srcset="https://www.lcsk42.com/post/arthas/dashboard_hu_bb153b684e218245.png 480w, https://www.lcsk42.com/post/arthas/dashboard_hu_612f3b3392d45954.png 1024w"
loading="lazy"
alt="dashboard"
class="gallery-image"
data-flex-grow="131"
data-flex-basis="315px"
>&lt;/p>
&lt;h4 id="数据说明">数据说明
&lt;/h4>&lt;ul>
&lt;li>ID: Java 级别的线程 ID，注意这个 ID 不能跟 jstack 中的 nativeID 一一对应。&lt;/li>
&lt;li>NAME: 线程名&lt;/li>
&lt;li>GROUP: 线程组名&lt;/li>
&lt;li>PRIORITY: 线程优先级, 1~10 之间的数字，越大表示优先级越高&lt;/li>
&lt;li>STATE: 线程的状态&lt;/li>
&lt;li>CPU%: 线程的 cpu 使用率。比如采样间隔 1000ms，某个线程的增量 cpu 时间为 100ms，则 cpu 使用率=100/1000=10%&lt;/li>
&lt;li>DELTA_TIME: 上次采样之后线程运行增量 CPU 时间，数据格式为&lt;code>秒&lt;/code>&lt;/li>
&lt;li>TIME: 线程运行总 CPU 时间，数据格式为&lt;code>分:秒&lt;/code>&lt;/li>
&lt;li>INTERRUPTED: 线程当前的中断位状态&lt;/li>
&lt;li>DAEMON: 是否是 daemon 线程&lt;/li>
&lt;/ul>
&lt;h4 id="jvm-内部线程">JVM 内部线程
&lt;/h4>&lt;p>Java 8 之后支持获取 JVM 内部线程 CPU 时间，这些线程只有名称和 CPU 时间，没有 ID 及状态等信息（显示 ID 为-1）。 通过内部线程可以观测到 JVM 活动，如 GC、JIT 编译等占用 CPU 情况，方便了解 JVM 整体运行状况。&lt;/p>
&lt;ul>
&lt;li>当 JVM 堆(heap)/元数据(metaspace)空间不足或 OOM 时，可以看到 GC 线程的 CPU 占用率明显高于其他的线程。&lt;/li>
&lt;li>当执行 &lt;code>trace/watch/tt/redefine&lt;/code> 等命令后，可以看到 JIT 线程活动变得更频繁。因为 JVM 热更新 class 字节码时清除了此 class 相关的 JIT 编译结果，需要重新编译。&lt;/li>
&lt;/ul>
&lt;p>JVM 内部线程包括下面几种：&lt;/p>
&lt;ul>
&lt;li>JIT 编译线程: 如 &lt;code>C1 CompilerThread0&lt;/code>, &lt;code>C2 CompilerThread0&lt;/code>&lt;/li>
&lt;li>GC 线程: 如 &lt;code>GC Thread0&lt;/code>, &lt;code>G1 Young RemSet Sampling&lt;/code>&lt;/li>
&lt;li>其它内部线程: 如 &lt;code>VM Periodic Task Thread&lt;/code>, &lt;code>VM Thread&lt;/code>, &lt;code>Service Thread&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="thread">thread
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看当前线程信息，查看线程的堆栈&lt;/p>&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">id&lt;/td>
&lt;td>线程 id&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>指定最忙的前 N 个线程并打印堆栈&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[b]&lt;/td>
&lt;td>找出当前阻塞其他线程的线程&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[i &amp;lt;value&amp;gt;]&lt;/td>
&lt;td>指定 cpu 使用率统计的采样间隔，单位为毫秒，默认值为 200&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[&amp;ndash;all]&lt;/td>
&lt;td>显示所有匹配的线程&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>这里的 cpu 使用率与 linux 命令 &lt;code>top -H -p &amp;lt;pid&amp;gt;&lt;/code> 的线程 &lt;code>%CPU&lt;/code> 类似，一段采样间隔时间内，当前 JVM 里各个线程的增量 cpu 时间与采样间隔时间的比例。&lt;/p>
&lt;p>工作原理说明：&lt;/p>
&lt;ul>
&lt;li>首先第一次采样，获取所有线程的 CPU 时间(调用的是 &lt;code>java.lang.management.ThreadMXBean#getThreadCpuTime()&lt;/code> 及 &lt;code>sun.management.HotspotThreadMBean.getInternalThreadCpuTimes()&lt;/code> 接口)&lt;/li>
&lt;li>然后睡眠等待一个间隔时间（默认为 200ms，可以通过 &lt;code>-i&lt;/code> 指定间隔时间）&lt;/li>
&lt;li>再次第二次采样，获取所有线程的 CPU 时间，对比两次采样数据，计算出每个线程的增量 CPU 时间&lt;/li>
&lt;li>线程 CPU 使用率 = 线程增量 CPU 时间 / 采样间隔时间 * 100%&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;strong>注意&lt;/strong>&lt;/p>
&lt;p>注意： 这个统计也会产生一定的开销（JDK 这个接口本身开销比较大），因此会看到 as 的线程占用一定的百分比，为了降低统计自身的开销带来的影响，可以把采样间隔拉长一些，比如 5000 毫秒。&lt;/p>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>另外一种查看 Java 进程的线程 cpu 使用率方法：可以使用 show-busy-java-threads 这个脚本&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 一键展示当前最忙的前 N 个线程并打印堆栈&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread -n &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>没有线程 ID，包含 &lt;code>[Internal]&lt;/code>表示为 JVM 内部线程，参考 &lt;a class="link" href="#dashboard" >dashboard&lt;/a> 命令的介绍。&lt;/li>
&lt;li>&lt;code>cpuUsage&lt;/code> 为采样间隔时间内线程的 CPU 使用率，与 &lt;a class="link" href="#dashboard" >dashboard&lt;/a> 命令的数据一致。&lt;/li>
&lt;li>&lt;code>deltaTime&lt;/code> 为采样间隔时间内线程的增量 CPU 时间，小于 1ms 时被取整显示为 0ms。&lt;/li>
&lt;li>&lt;code>time&lt;/code> 线程运行总 CPU 时间。&lt;/li>
&lt;/ul>
&lt;p>注意：线程栈为第二采样结束时获取，不能表明采样间隔时间内该线程都是在处理相同的任务。建议间隔时间不要太长，可能间隔时间越大越不准确。 可以根据具体情况尝试指定不同的间隔时间，观察输出结果。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 当没有参数时，显示第一页线程的信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 默认按照 CPU 增量时间降序排列，只显示第一页数据。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 显示所有匹配线程信息，有时需要获取全部 JVM 的线程数据进行分析。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thread id, 显示指定线程的运行堆栈&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thread -b, 找出当前阻塞其他线程的线程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 有时候我们发现应用卡住了， 通常是由于某个线程拿住了某个锁， 并且其他线程都在等待这把锁造成的。 为了排查这类问题， arthas 提供了 thread -b， 一键找出那个罪魁祸首&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># **注意**&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 注意， 目前只支持找出 synchronized 关键字阻塞住的线程， 如果是java.util.concurrent.Lock， 目前还不支持&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread -b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thread -i, 指定采样时间间隔&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 统计最近 1000ms 内的线程 CPU 时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread -i &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 列出 1000ms 内最忙的 3 个线程栈&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread -n &lt;span class="m">3&lt;/span> -i &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thread --state ，查看指定状态的线程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">thread --state WAITING
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="jvm">jvm
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看当前 JVM 信息&lt;/p>&lt;/blockquote>
&lt;p>THREAD 相关:&lt;/p>
&lt;ul>
&lt;li>COUNT: JVM 当前活跃的线程数&lt;/li>
&lt;li>DAEMON-COUNT: JVM 当前活跃的守护线程数&lt;/li>
&lt;li>PEAK-COUNT: 从 JVM 启动开始曾经活着的最大线程数&lt;/li>
&lt;li>STARTED-COUNT: 从 JVM 启动开始总共启动过的线程次数&lt;/li>
&lt;li>DEADLOCK-COUNT: JVM 当前死锁的线程数&lt;/li>
&lt;/ul>
&lt;p>文件描述符相关:&lt;/p>
&lt;ul>
&lt;li>MAX-FILE-DESCRIPTOR-COUNT：JVM 进程最大可以打开的文件描述符数&lt;/li>
&lt;li>OPEN-FILE-DESCRIPTOR-COUNT：JVM 当前打开的文件描述符数&lt;/li>
&lt;/ul>
&lt;h3 id="sysprop">sysprop
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看当前 JVM 的系统属性(System Property)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看所有属性&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysprop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看单个属性, 支持通过TAB键自动补全&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysprop java.version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改单个属性&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysprop user.country CN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="sysenv">sysenv
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看当前 JVM 的环境属性(System Environment Variables)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看所有环境变量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysenv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看单个环境变量, 支持通过TAB键自动补全&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysenv java.version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="vmoption">vmoption
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看，更新 VM 诊断相关的参数&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看所有的 option&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmoption
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看指定的 option&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmoption PrintGC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 更新指定的 option&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmoption PrintGCDetails &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="vmtool">vmtool
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>@since 3.5.1&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>vmtool&lt;/code> 利用 &lt;code>JVMTI&lt;/code> 接口，实现查询内存对象，强制 GC 等功能。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 获取对象&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通过 --limit参数，可以限制返回值数量，避免获取超大数据时对 JVM 造成压力。默认值是 10。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmtool --action getInstances --className java.lang.String --limit &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 指定 classloader name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmtool --action getInstances --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader --className org.springframework.context.ApplicationContext
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 指定 classloader hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#可以通过sc命令查找到加载 class 的 classloader。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sc -d org.springframework.context.ApplicationContext
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> class-info org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> code-source file:/private/tmp/demo-arthas-spring-boot.jar!/BOOT-INF/lib/spring-boot-1.5.13.RELEASE.jar!/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> class-loader +-org.springframework.boot.loader.LaunchedURLClassLoader@19469ea2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@75b84c92
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-sun.misc.Launcher&lt;span class="nv">$ExtClassLoader&lt;/span>@4f023edb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> classLoaderHash 19469ea2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 然后用-c/--classloader 参数指定：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmtool --action getInstances -c 19469ea2 --className org.springframework.context.ApplicationContext
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 指定返回结果展开层数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># getInstances action 返回结果绑定到instances变量上，它是数组。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通过 -x/--expand 参数可以指定结果的展开层次，默认值是 1。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmtool --action getInstances -c 19469ea2 --className org.springframework.context.ApplicationContext -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 执行表达式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># getInstances action 返回结果绑定到instances变量上，它是数组。可以通过--express参数执行指定的表达式。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmtool --action getInstances --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader --className org.springframework.context.ApplicationContext --express &lt;span class="s1">&amp;#39;instances[0].getBeanDefinitionNames()&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 强制 GC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 可以结合 vmoption 命令动态打开PrintGC开关&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmtool --action forceGc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># interrupt 指定线程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thread id 通过-t参数指定，可以使用 thread 命令获取。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmtool --action interruptThread -t &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="perfcounter">perfcounter
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看当前 JVM 的 Perf Counter 信息&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">perfcounter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 可以用-d参数打印更多信息：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">perfcounter -d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>jdk9 以上的应用,如果没有打印出信息，应用在启动时，加下面的参数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">--add-opens java.base/jdk.internal.perf&lt;span class="o">=&lt;/span>ALL-UNNAMED --add-exports java.base/jdk.internal.perf&lt;span class="o">=&lt;/span>ALL-UNNAMED --add-opens java.management/sun.management.counter.perf&lt;span class="o">=&lt;/span>ALL-UNNAMED --add-opens java.management/sun.management.counter&lt;span class="o">=&lt;/span>ALL-UNNAMED
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="logger">logger
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看 logger 信息，更新 logger level&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 更新 logger level&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logger --name ROOT --level debug
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="getstatic">getstatic
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通过 getstatic 命令可以方便的查看类的静态属性。使用方法为 `getstatic class_name field_name`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">getstatic demo.MathGame random
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 注意 hashcode 是变化的，需要先查看当前的 ClassLoader 信息，使用sc -d &amp;lt;ClassName&amp;gt;提取对应 ClassLoader 的 hashcode。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果你使用-c，你需要手动输入 hashcode：-c &amp;lt;hashcode&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">getstatic -c 3d4eac69 demo.MathGame random
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 对于只有唯一实例的 ClassLoader 可以通过--classLoaderClass指定 class name，使用起来更加方便：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">getstatic --classLoaderClass sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span> demo.MathGame random
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ognl">ognl
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>执行 ognl 表达式&lt;/p>&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">express&lt;/td>
&lt;td>执行的表达式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>执行表达式的 ClassLoader 的 hashcode，默认值是 SystemClassLoader&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[classLoaderClass:]&lt;/td>
&lt;td>指定执行表达式的 ClassLoader 的 class name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[x]&lt;/td>
&lt;td>结果对象的展开层次，默认值 1&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 调用静态函数：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ognl &lt;span class="s1">&amp;#39;@java.lang.System@out.println(&amp;#34;hello&amp;#34;)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 获取静态类的静态字段：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ognl &lt;span class="s1">&amp;#39;@demo.MathGame@random&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 执行多行表达式，赋值给临时变量，返回一个 List：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ognl &lt;span class="s1">&amp;#39;#value1=@System@getProperty(&amp;#34;java.home&amp;#34;), #value2=@System@getProperty(&amp;#34;java.runtime.name&amp;#34;), {#value1, #value2}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>arthas 中的特殊用法：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看第一个参数：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看第一个参数的 size：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0].size()&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将结果按 name 属性投影：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0].{ #this.name }&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 按条件过滤：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0].{? #this.name == null }.size() &amp;gt; 0&amp;#34;&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 过滤后统计：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0].{? #this.age &amp;gt; 10 }.size()&amp;#34;&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 判断字符串相等&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.demo.Test &lt;span class="nb">test&lt;/span> &lt;span class="s1">&amp;#39;params[0]==&amp;#34;xyz&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 判断 long 型&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.demo.Test &lt;span class="nb">test&lt;/span> &lt;span class="s1">&amp;#39;params[0]==123456789L&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 子表达式求值：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0].{? #this.age &amp;gt; 10 }.size().(#this &amp;gt; 20 ? #this - 10 : #this + 10)&amp;#34;&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 选择第一个满足条件：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0].{^ #this.name != null}&amp;#34;&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 选择最后一个满足条件：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">watch com.taobao.container.Test &lt;span class="nb">test&lt;/span> &lt;span class="s2">&amp;#34;params[0].{&lt;/span>$&lt;span class="s2"> #this.name != null}&amp;#34;&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 匹配线程 &amp;amp; 正则多个类多个方法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">trace -E &lt;span class="s1">&amp;#39;io\.netty\.channel\.nio\.NioEventLoop|io\.netty\.util\.concurrent\.SingleThreadEventExecutor&amp;#39;&lt;/span> &lt;span class="s1">&amp;#39;select|processSelectedKeys|runAllTasks&amp;#39;&lt;/span> &lt;span class="s1">&amp;#39;@Thread@currentThread().getName().contains(&amp;#34;IO-HTTP-WORKER-IOPool&amp;#34;)&amp;amp;&amp;amp;#cost&amp;gt;500&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="mbean">mbean
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看 Mbean 的信息&lt;/p>&lt;/blockquote>
&lt;p>这个命令可以便捷的查看或监控 Mbean 的属性信息。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">name-pattern&lt;/td>
&lt;td>名称表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">attribute-pattern&lt;/td>
&lt;td>属性名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[m]&lt;/td>
&lt;td>查看元信息&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[i:]&lt;/td>
&lt;td>刷新属性值的时间间隔 (ms)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>刷新属性值的次数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配。仅对属性名有效&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 列出所有 Mbean 的名称：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看 Mbean 的元信息：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean -m java.lang:type&lt;span class="o">=&lt;/span>Threading
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看 mbean 属性信息：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean java.lang:type&lt;span class="o">=&lt;/span>Threading
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mbean 的 name 支持通配符匹配：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 注意：ObjectName 的匹配规则与正常的通配符存在差异，详细参见：[javax.management.ObjectName](https://docs.oracle.com/javase/8/docs/api/javax/management/ObjectName.html?is-external=true)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean java.lang:type&lt;span class="o">=&lt;/span>Th*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通配符匹配特定的属性字段：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean java.lang:type&lt;span class="o">=&lt;/span>Threading *Count
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 -E 命令切换为正则匹配：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean -E java.lang:type&lt;span class="o">=&lt;/span>Threading PeakThreadCount&lt;span class="p">|&lt;/span>ThreadCount&lt;span class="p">|&lt;/span>DaemonThreadCount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 -i 命令实时监控：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean -i &lt;span class="m">1000&lt;/span> java.lang:type&lt;span class="o">=&lt;/span>Threading *Count
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 实时监控使用 -i，使用 -n 命令执行命令的次数（默认为 100 次）：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mbean -i &lt;span class="m">1000&lt;/span> -n &lt;span class="m">50&lt;/span> java.lang:type&lt;span class="o">=&lt;/span>Threading *Count
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="heapdump">heapdump
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>dump java heap, 类似 jmap 命令的 heap dump 功能。&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dump 到指定文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 生成文件在arthas-output目录，可以通过浏览器下载： http://localhost:8563/arthas-output/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">heapdump arthas-output/dump.hprof
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 只 dump live 对象&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">heapdump --live /tmp/dump.hprof
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dump 到临时文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">heapdump
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="类命令">类命令
&lt;/h2>&lt;h3 id="sc">sc
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看 JVM 已加载的类信息&lt;/p>&lt;/blockquote>
&lt;p>“Search-Class” 的简写，这个命令能搜索出所有已经加载到 JVM 中的 Class 信息，这个命令支持的参数有 &lt;code>[d]&lt;/code>、&lt;code>[E]&lt;/code>、&lt;code>[f]&lt;/code> 和 &lt;code>[x:]&lt;/code>。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>method-pattern&lt;/em>&lt;/td>
&lt;td>方法名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[d]&lt;/td>
&lt;td>输出当前类的详细信息，包括这个类所加载的原始文件来源、类的声明、加载的 ClassLoader 等详细信息。如果一个类被多个 ClassLoader 所加载，则会出现多次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[f]&lt;/td>
&lt;td>输出当前类的成员变量信息（需要配合参数-d 一起使用）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[x:]&lt;/td>
&lt;td>指定输出静态变量时属性的遍历深度，默认为 0，即直接使用 toString 输出&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>指定 class 的 ClassLoader 的 hashcode&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[classLoaderClass:]&lt;/td>
&lt;td>指定执行表达式的 ClassLoader 的 class name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>具有详细信息的匹配类的最大数量（默认为 100）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[cs &amp;lt;arg&amp;gt;]&lt;/td>
&lt;td>指定 class 的 ClassLoader#toString() 返回值。长格式[classLoaderStr &amp;lt;arg&amp;gt;]&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;blockquote>
&lt;p>&lt;em>提示&lt;/em>&lt;/p>
&lt;p>class-pattern 支持全限定名，如 &lt;code>com.taobao.test.AAA&lt;/code>，也支持 &lt;code>com/taobao/test/AAA&lt;/code> 这样的格式，这样，我们从异常堆栈里面把类名拷贝过来的时候，不需要在手动把 &lt;code>/&lt;/code> 替换为 &lt;code>.&lt;/code> 啦。&lt;/p>
&lt;p>sc 默认开启了子类匹配功能，也就是说所有当前类的子类也会被搜索出来，想要精确的匹配，请打开 &lt;code>options disable-sub-class true&lt;/code> 开关&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 模糊搜索&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sc demo.*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 打印类的详细信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sc -d demo.MathGame
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 打印出类的 Field 信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sc -d -f demo.MathGame
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通过 ClassLoader#toString 查找类（前提：有一个 toString()返回值是apo的类加载器，加载的类中包含 `demo.MathGame`, `demo.MyBar`, `demo.MyFoo3` 个类）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sc -cs apo *demo*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="sm">sm
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看已加载类的方法信息&lt;/p>&lt;/blockquote>
&lt;p>“Search-Method” 的简写，这个命令能搜索出所有已经加载了 Class 信息的方法信息。&lt;/p>
&lt;p>&lt;code>sm&lt;/code> 命令只能看到由当前类所声明 (declaring) 的方法，父类则无法看到。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>method-pattern&lt;/em>&lt;/td>
&lt;td>方法名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[d]&lt;/td>
&lt;td>展示每个方法的详细信息&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>指定 class 的 ClassLoader 的 hashcode&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[classLoaderClass:]&lt;/td>
&lt;td>指定执行表达式的 ClassLoader 的 class name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>具有详细信息的匹配类的最大数量（默认为 100）&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sm java.lang.String
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sm -d java.lang.String toString
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="jad">jad
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>反编译指定已加载类的源码&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>jad&lt;/code> 命令将 JVM 中实际运行的 class 的 byte code 反编译成 java 代码，便于你理解业务逻辑；如需批量下载指定包的目录的 class 字节码可以参考 dump。&lt;/p>
&lt;ul>
&lt;li>在 Arthas Console 上，反编译出来的源码是带语法高亮的，阅读更方便&lt;/li>
&lt;li>当然，反编译出来的 java 代码可能会存在语法错误，但不影响你进行阅读理解&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>类所属 ClassLoader 的 hashcode&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[classLoaderClass:]&lt;/td>
&lt;td>指定执行表达式的 ClassLoader 的 class name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 反编译java.lang.String&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jad java.lang.String
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 反编译时只显示源代码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 默认情况下，反编译结果里会带有 ClassLoader 信息，通过 --source-only 选项，可以只打印源代码。方便和 mc/retransform 命令结合使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jad --source-only demo.MathGame
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 反编译指定的函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jad demo.MathGame main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 反编译时不显示行号&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --lineNumber 参数默认值为 true，显示指定为 false 则不打印行号。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jad demo.MathGame main --lineNumber &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 反编译时指定 ClassLoader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 当有多个 ClassLoader 都加载了这个类时，jad 命令会输出对应 ClassLoader 实例的 hashcode，然后你只需要重新执行 jad 命令，并使用参数 -c &amp;lt;hashcode&amp;gt; 就可以反编译指定 ClassLoader 加载的那个类了；&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jad org.apache.log4j.Logger
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 对于只有唯一实例的 ClassLoader 还可以通过--classLoaderClass指定 class name，使用起来更加方便：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --classLoaderClass 的值是 ClassLoader 的类名，只有匹配到唯一的 ClassLoader 实例时才能工作，目的是方便输入通用命令，而-c &amp;lt;hashcode&amp;gt;是动态变化的。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="mc-retransform">mc-retransform
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&amp;gt; **提示**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; 加载外部的.class文件，retransform jvm 已加载的类。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># retransform 指定的 .class 文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 加载指定的 .class 文件，然后解析出 class name，再 retransform jvm 中已加载的对应的类。每加载一个 .class 文件，则会记录一个 retransform entry.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果多次执行 retransform 加载同一个 class 文件，则会有多条 retransform entry.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform /tmp/Test.class
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看 retransform entry&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># TransformCount 统计在 ClassFileTransformer#transform 函数里尝试返回 entry 对应的 .class 文件的次数，但并不表明 transform 一定成功。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删除指定 retransform entry&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 需要指定 id：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform -d &lt;span class="m">1&lt;/span> &lt;span class="c1"># delete retransform entry&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删除所有 retransform entry&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform --deleteAll &lt;span class="c1"># delete all retransform entries&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 显式触发 retransform&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 注意：对于同一个类，当存在多个 retransform entry 时，如果显式触发 retransform ，则最后添加的 entry 生效(id 最大的)。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform --classPattern demo.* &lt;span class="c1"># triger retransform classes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform -c 327a647b /tmp/Test.class /tmp/Test&lt;span class="se">\$&lt;/span>Inner.class
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform --classLoaderClass &lt;span class="s1">&amp;#39;sun.misc.Launcher$AppClassLoader&amp;#39;&lt;/span> /tmp/Test.class
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="如果对某个类执行-retransform-之后想消除影响则需要">如果对某个类执行 retransform 之后，想消除影响，则需要
&lt;/h4>&lt;ul>
&lt;li>删除这个类对应的 retransform entry&lt;/li>
&lt;li>重新触发 retransform&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>如果不清除掉所有的 retransform entry，并重新触发 retransform ，则 arthas stop 时，retransform 过的类仍然生效。&lt;/p>&lt;/blockquote>
&lt;h4 id="结合-jadmc-命令使用">结合 jad/mc 命令使用
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">jad --source-only com.example.demo.arthas.user.UserController &amp;gt; /tmp/UserController.java
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mc /tmp/UserController.java -d /tmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">retransform /tmp/com/example/demo/arthas/user/UserController.class
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>jad 命令反编译，然后可以用其它编译器，比如 vim 来修改源码&lt;/li>
&lt;li>mc 命令来内存编译修改过的代码&lt;/li>
&lt;li>用 retransform 命令加载新的字节码&lt;/li>
&lt;/ul>
&lt;h4 id="上传-class-文件到服务器的技巧">上传 .class 文件到服务器的技巧
&lt;/h4>&lt;p>使用 mc 命令来编译 jad 的反编译的代码有可能失败。可以在本地修改代码，编译好后再上传到服务器上。有的服务器不允许直接上传文件，可以使用 base64 命令来绕过。&lt;/p>
&lt;ol>
&lt;li>在本地先转换.class 文件为 base64，再保存为 result.txt&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">base64 &amp;lt; Test.class &amp;gt; result.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>
&lt;p>到服务器上，新建并编辑 result.txt，复制本地的内容，粘贴再保存&lt;/p>
&lt;/li>
&lt;li>
&lt;p>把服务器上的 result.txt 还原为.class&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">base64 -d &amp;lt; result.txt &amp;gt; Test.class
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>用 md5 命令计算哈希值，校验是否一致&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>retransform 的限制&lt;/p>
&lt;ul>
&lt;li>不允许新增加 field/method&lt;/li>
&lt;li>正在跑的函数，没有退出不能生效，比如下面新增加的 &lt;code>System.out.println&lt;/code>，只有 &lt;code>run()&lt;/code> 函数里的会生效&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MathGame&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InterruptedException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">MathGame&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">game&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MathGame&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">game&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">SECONDS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// 这个不生效，因为代码一直跑在 while里&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;in loop&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InterruptedException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// 这个生效，因为run()函数每次都可以完整结束&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;call run()&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">number&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">primeFactors&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">primeFactors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">number&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">number&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">primeFactors&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;illegalArgumentCount:%3d, &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">illegalArgumentCount&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getMessage&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="mc-redefine">mc-redefine
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>推荐使用 &lt;a class="link" href="#mc-retransform" >retransform&lt;/a> 命令&lt;/p>&lt;/blockquote>
&lt;h3 id="dump">dump
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>dump 已加载类的 bytecode 到特定目录&lt;/p>&lt;/blockquote>
&lt;p>dump 命令将 JVM 中实际运行的 class 的 byte code dump 到指定目录，适用场景批量下载指定包目录的 class 字节码；如需反编译单一类、实时查看类信息，可参考 &lt;a class="link" href="#jad" >jad&lt;/a>。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>类所属 ClassLoader 的 hashcode&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[classLoaderClass:]&lt;/td>
&lt;td>指定执行表达式的 ClassLoader 的 class name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[d:]&lt;/td>
&lt;td>设置类文件的目标目录&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dump java.lang.String
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dump demo.*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dump -d /tmp/output java.lang.String
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 指定 classLoader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果你使用 -c，你需要手动输入 hashcode：-c &amp;lt;hashcode&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dump -c 3d4eac69 demo.*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 对于只有唯一实例的 ClassLoader 可以通过--classLoaderClass指定 class name，使用起来更加方便：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dump --classLoaderClass sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span> demo.*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="classloader">classloader
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>查看 classloader 的继承树，urls，类加载信息&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>classloader&lt;/code> 命令将 JVM 中所有的 classloader 的信息统计出来，并可以展示继承树，urls 等。&lt;/p>
&lt;p>可以让指定的 classloader 去 getResources，打印出所有查找到的 resources 的 url。对于 &lt;code>ResourceNotFoundException&lt;/code> 比较有用。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">[l]&lt;/td>
&lt;td>按类加载实例进行统计&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[t]&lt;/td>
&lt;td>打印所有 ClassLoader 的继承树&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[a]&lt;/td>
&lt;td>列出所有 ClassLoader 加载的类，请谨慎使用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>ClassLoader 的 hashcode&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[classLoaderClass:]&lt;/td>
&lt;td>指定执行表达式的 ClassLoader 的 class name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c: r:]&lt;/td>
&lt;td>用 ClassLoader 去查找 resource&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c: load:]&lt;/td>
&lt;td>用 ClassLoader 去加载指定的类&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 按类加载类型查看统计信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 按类加载实例查看统计信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看 ClassLoader 的继承树&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader -t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看 URLClassLoader 实际的 urls&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader -c 3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 注意 hashcode 是变化的，需要先查看当前的 ClassLoader 信息，提取对应 ClassLoader 的 hashcode。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 对于只有唯一实例的 ClassLoader 可以通过 class name 指定，使用起来更加方便：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader --classLoaderClass sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 ClassLoader 去查找 resource&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader -c 3d4eac69 -r META-INF/MANIFEST.MF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 也可以尝试查找类的 class 文件：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader -c 1b6d3586 -r java/lang/String.class
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 ClassLoader 去加载类&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader -c 3d4eac69 --load demo.MathGame
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 统计 ClassLoader 实际使用 URL 和未使用的 URL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">classloader --url-stat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 注意，基于 JVM 目前已加载的所有类统计，不代表 Unused URLs 可以从应用中删掉。因为可能将来需要从 Unused URLs 里加载类，或者需要加载 resources。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="增强命令">增强命令
&lt;/h2>&lt;h3 id="monitor">monitor
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>方法执行监控&lt;/p>&lt;/blockquote>
&lt;p>对匹配 &lt;code>class-pattern&lt;/code>／&lt;code>method-pattern&lt;/code>／&lt;code>condition-express&lt;/code> 的类、方法的调用进行监控。&lt;/p>
&lt;p>&lt;code>monitor&lt;/code> 命令是一个非实时返回命令.&lt;/p>
&lt;p>实时返回命令是输入之后立即返回，而非实时返回的命令，则是不断的等待目标 Java 进程返回信息，直到用户输入 &lt;code>Ctrl+C&lt;/code> 为止。&lt;/p>
&lt;p>服务端是以任务的形式在后台跑任务，植入的代码随着任务的中止而不会被执行，所以任务关闭后，不会对原有性能产生太大影响，而且原则上，任何 Arthas 命令不会引起原有业务逻辑的改变。&lt;/p>
&lt;p>监控维度：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">监控项&lt;/th>
&lt;th>说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">timestamp&lt;/td>
&lt;td>时间戳&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">class&lt;/td>
&lt;td>Java 类&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">method&lt;/td>
&lt;td>方法（构造方法、普通方法）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">total&lt;/td>
&lt;td>调用次数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">success&lt;/td>
&lt;td>成功次数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">fail&lt;/td>
&lt;td>失败次数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">rt&lt;/td>
&lt;td>平均 RT&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">fail-rate&lt;/td>
&lt;td>失败率&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>参数：&lt;/p>
&lt;p>方法拥有一个命名参数 &lt;code>[c:]&lt;/code>，意思是统计周期（cycle of output），拥有一个整型的参数值&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>method-pattern&lt;/em>&lt;/td>
&lt;td>方法名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>condition-express&lt;/em>&lt;/td>
&lt;td>条件表达式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[c:]&lt;/td>
&lt;td>统计周期，默认值为 120 秒&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[b]&lt;/td>
&lt;td>在方法调用之前计算 condition-express&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[m &amp;lt;arg&amp;gt;]&lt;/td>
&lt;td>指定 Class 最大匹配数量，默认值为 50。长格式为[maxMatch &amp;lt;arg&amp;gt;]。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ monitor -c &lt;span class="m">5&lt;/span> demo.MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">94&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2018-12-03 19:06:38 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">4&lt;/span> 1.15 80.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2018-12-03 19:06:43 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">2&lt;/span> 42.29 40.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2018-12-03 19:06:48 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">2&lt;/span> 67.92 40.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2018-12-03 19:06:53 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">3&lt;/span> 0.25 60.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2018-12-03 19:06:58 demo.MathGame primeFactors &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> 0.45 0.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2018-12-03 19:07:03 demo.MathGame primeFactors &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">0&lt;/span> 3182.72 0.00%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="指定-class-最大匹配数量">指定 Class 最大匹配数量
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ monitor -c &lt;span class="m">1&lt;/span> -m &lt;span class="m">1&lt;/span> demo.MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count:1 , method count:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">384&lt;/span> ms, listenerId: 6.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2022-12-25 21:12:58 demo.MathGame primeFactors &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> 0.18 0.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2022-12-25 21:12:59 demo.MathGame primeFactors &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> 0.00 0.00%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="计算条件表达式过滤统计结果方法执行完毕之后">计算条件表达式过滤统计结果(方法执行完毕之后)
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">monitor -c &lt;span class="m">5&lt;/span> demo.MathGame primeFactors &lt;span class="s2">&amp;#34;params[0] &amp;lt;= 2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">19&lt;/span> ms, listenerId: &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:36 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">2&lt;/span> 0.09 40.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:41 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">3&lt;/span> 0.11 60.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:46 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">4&lt;/span> 0.06 80.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:51 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">4&lt;/span> 0.12 80.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:56 demo.MathGame primeFactors &lt;span class="m">5&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">2&lt;/span> 0.15 40.00%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="计算条件表达式过滤统计结果方法执行完毕之前">计算条件表达式过滤统计结果(方法执行完毕之前)
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">monitor -b -c &lt;span class="m">5&lt;/span> com.test.testes.MathGame primeFactors &lt;span class="s2">&amp;#34;params[0] &amp;lt;= 2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">21&lt;/span> ms, listenerId: &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:41:57 demo.MathGame primeFactors &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">1&lt;/span> 0.10 100.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:02 demo.MathGame primeFactors &lt;span class="m">3&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">3&lt;/span> 0.06 100.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:07 demo.MathGame primeFactors &lt;span class="m">2&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">2&lt;/span> 0.06 100.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:12 demo.MathGame primeFactors &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">1&lt;/span> 0.05 100.00%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timestamp class method total success fail avg-rt&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> fail-rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2020-09-02 09:42:17 demo.MathGame primeFactors &lt;span class="m">2&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">2&lt;/span> 0.10 100.00%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="watch">watch
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>函数执行数据观测&lt;/p>&lt;/blockquote>
&lt;p>让你能方便的观察到指定函数的调用情况。能观察到的范围为：&lt;code>返回值&lt;/code>、&lt;code>抛出异常&lt;/code>、&lt;code>入参&lt;/code>，通过编写 OGNL 表达式进行对应变量的查看。&lt;/p>
&lt;p>watch 的参数比较多，主要是因为它能在 4 个不同的场景观察对象&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>method-pattern&lt;/em>&lt;/td>
&lt;td>函数名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>express&lt;/em>&lt;/td>
&lt;td>观察表达式，默认值：{params, target, returnObj}&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>condition-express&lt;/em>&lt;/td>
&lt;td>条件表达式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[b]&lt;/td>
&lt;td>在&lt;strong>函数调用之前&lt;/strong>观察&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[e]&lt;/td>
&lt;td>在&lt;strong>函数异常之后&lt;/strong>观察&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[s]&lt;/td>
&lt;td>在&lt;strong>函数返回之后&lt;/strong>观察&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[f]&lt;/td>
&lt;td>在&lt;strong>函数结束之后&lt;/strong>(正常返回和异常返回)观察&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[x:]&lt;/td>
&lt;td>指定输出结果的属性遍历深度，默认为 1，最大值是 4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[m &amp;lt;arg&amp;gt;]&lt;/td>
&lt;td>指定 Class 最大匹配数量，默认值为 50。长格式为[maxMatch &amp;lt;arg&amp;gt;]。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>这里重点要说明的是观察表达式，观察表达式的构成主要由 ognl 表达式组成，所以你可以这样写 &lt;code>&amp;quot;{params,returnObj}&amp;quot;&lt;/code>，只要是一个合法的 ognl 表达式，都能被正常支持。&lt;/p>
&lt;p>观察的维度也比较多，主要体现在参数 &lt;code>advice&lt;/code> 的数据结构上。&lt;code>Advice&lt;/code> 参数最主要是封装了通知节点的所有信息。请参考&lt;a class="link" href="#%e8%a1%a8%e8%be%be%e5%bc%8f%e6%a0%b8%e5%bf%83%e5%8f%98%e9%87%8f" >表达式核心变量&lt;/a>中关于该节点的描述。&lt;/p>
&lt;ul>
&lt;li>watch 命令定义了 4 个观察事件点，即 &lt;code>-b&lt;/code> 函数调用前，&lt;code>-e&lt;/code> 函数异常后，&lt;code>-s&lt;/code> 函数返回后，&lt;code>-f&lt;/code> 函数结束后&lt;/li>
&lt;li>4 个观察事件点 &lt;code>-b&lt;/code>、&lt;code>-e&lt;/code>、&lt;code>-s&lt;/code> 默认关闭，&lt;code>-f&lt;/code> 默认打开，当指定观察点被打开后，在相应事件点会对观察表达式进行求值并输出&lt;/li>
&lt;li>这里要注意 &lt;code>函数入参&lt;/code> 和 &lt;code>函数出参&lt;/code> 的区别，有可能在中间被修改导致前后不一致，除了 &lt;code>-b&lt;/code> 事件点 &lt;code>params&lt;/code> 代表函数入参外，其余事件都代表函数出参&lt;/li>
&lt;li>当使用 -b 时，由于观察事件点是在函数调用前，此时返回值或异常均不存在&lt;/li>
&lt;li>在 watch 命令的结果里，会打印出 &lt;code>location&lt;/code> 信息。&lt;code>location&lt;/code> 有三种可能值：&lt;code>AtEnter&lt;/code>，&lt;code>AtExit&lt;/code>，&lt;code>AtExceptionExit&lt;/code>。对应函数入口，函数正常 return，函数抛出异常。&lt;/li>
&lt;/ul>
&lt;h4 id="观察函数调用返回时的参数this-对象和返回值">观察函数调用返回时的参数、this 对象和返回值
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 观察表达式，默认值是{params, target, returnObj}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">32&lt;/span> ms, listenerId: &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">method&lt;/span>&lt;span class="o">=&lt;/span>demo.MathGame.primeFactors &lt;span class="nv">location&lt;/span>&lt;span class="o">=&lt;/span>AtExceptionExit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-08-31 15:22:57&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.220625ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>-179173&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">random&lt;/span>&lt;span class="o">=&lt;/span>@Random&lt;span class="o">[&lt;/span>java.util.Random@31cefde0&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">illegalArgumentCount&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>44&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> null,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">method&lt;/span>&lt;span class="o">=&lt;/span>demo.MathGame.primeFactors &lt;span class="nv">location&lt;/span>&lt;span class="o">=&lt;/span>AtExit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-08-31 15:22:58&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>1.020982ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">random&lt;/span>&lt;span class="o">=&lt;/span>@Random&lt;span class="o">[&lt;/span>java.util.Random@31cefde0&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">illegalArgumentCount&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>44&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>26947&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>上面的结果里，说明函数被执行了两次，第一次结果是 &lt;code>location=AtExceptionExit&lt;/code>，说明函数抛出异常了，因此 &lt;code>returnObj&lt;/code> 是 null&lt;/li>
&lt;li>在第二次结果里是 &lt;code>location=AtExit&lt;/code>，说明函数正常返回，因此可以看到 &lt;code>returnObj&lt;/code> 结果是一个 ArrayList&lt;/li>
&lt;/ul>
&lt;h4 id="指定-class-最大匹配数量-1">指定 Class 最大匹配数量
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors -m &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">302&lt;/span> ms, listenerId: &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">method&lt;/span>&lt;span class="o">=&lt;/span>demo.MathGame.primeFactors &lt;span class="nv">location&lt;/span>&lt;span class="o">=&lt;/span>AtExceptionExit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2022-12-25 19:58:41&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.222419ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>&lt;span class="nv">isEmpty&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">size&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>demo.MathGame@3bf400&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> null,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">method&lt;/span>&lt;span class="o">=&lt;/span>demo.MathGame.primeFactors &lt;span class="nv">location&lt;/span>&lt;span class="o">=&lt;/span>AtExceptionExit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2022-12-25 19:58:51&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.046928ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>&lt;span class="nv">isEmpty&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">size&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>demo.MathGame@3bf400&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> null,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="观察函数调用入口的参数和返回值">观察函数调用入口的参数和返回值
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s2">&amp;#34;{params,returnObj}&amp;#34;&lt;/span> -x &lt;span class="m">2&lt;/span> -b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">50&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:23:23&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.0353ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>-1077465243&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> null,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 对比前一个例子，返回值为空（事件点为函数执行前，因此获取不到返回值）&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="同时观察函数调用前和函数返回后">同时观察函数调用前和函数返回后
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s2">&amp;#34;{params,target,returnObj}&amp;#34;&lt;/span> -x &lt;span class="m">2&lt;/span> -b -s -n &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">46&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:29:54&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.01696ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">random&lt;/span>&lt;span class="o">=&lt;/span>@Random&lt;span class="o">[&lt;/span>java.util.Random@522b408a&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">illegalArgumentCount&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>13038&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> null,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:29:54&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>4.277392ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">random&lt;/span>&lt;span class="o">=&lt;/span>@Random&lt;span class="o">[&lt;/span>java.util.Random@522b408a&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">illegalArgumentCount&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>13038&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>5&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>5&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>73&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>241&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>439&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>参数里 &lt;code>-n 2&lt;/code>，表示只执行两次&lt;/li>
&lt;li>这里输出结果中，第一次输出的是函数调用前的观察表达式的结果，第二次输出的是函数返回后的表达式的结果&lt;/li>
&lt;li>结果的输出顺序和事件发生的先后顺序一致，和命令中 &lt;code>-s&lt;/code> &lt;code>-b&lt;/code> 的顺序无关&lt;/li>
&lt;/ul>
&lt;h4 id="调整-x-的值观察具体的函数参数值">调整-x 的值，观察具体的函数参数值
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s2">&amp;#34;{params,target}&amp;#34;&lt;/span> -x &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">58&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:34:19&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.587833ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">random&lt;/span>&lt;span class="o">=&lt;/span>@Random&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">serialVersionUID&lt;/span>&lt;span class="o">=&lt;/span>@Long&lt;span class="o">[&lt;/span>3905348978240129619&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">seed&lt;/span>&lt;span class="o">=&lt;/span>@AtomicLong&lt;span class="o">[&lt;/span>3133719055989&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">multiplier&lt;/span>&lt;span class="o">=&lt;/span>@Long&lt;span class="o">[&lt;/span>25214903917&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">addend&lt;/span>&lt;span class="o">=&lt;/span>@Long&lt;span class="o">[&lt;/span>11&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">mask&lt;/span>&lt;span class="o">=&lt;/span>@Long&lt;span class="o">[&lt;/span>281474976710655&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">DOUBLE_UNIT&lt;/span>&lt;span class="o">=&lt;/span>@Double&lt;span class="o">[&lt;/span>1.1102230246251565E-16&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">BadBound&lt;/span>&lt;span class="o">=&lt;/span>@String&lt;span class="o">[&lt;/span>bound must be positive&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">BadRange&lt;/span>&lt;span class="o">=&lt;/span>@String&lt;span class="o">[&lt;/span>bound must be greater than origin&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">BadSize&lt;/span>&lt;span class="o">=&lt;/span>@String&lt;span class="o">[&lt;/span>size must be non-negative&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">seedUniquifier&lt;/span>&lt;span class="o">=&lt;/span>@AtomicLong&lt;span class="o">[&lt;/span>-3282039941672302964&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">nextNextGaussian&lt;/span>&lt;span class="o">=&lt;/span>@Double&lt;span class="o">[&lt;/span>0.0&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">haveNextNextGaussian&lt;/span>&lt;span class="o">=&lt;/span>@Boolean&lt;span class="o">[&lt;/span>false&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">serialPersistentFields&lt;/span>&lt;span class="o">=&lt;/span>@ObjectStreamField&lt;span class="o">[][&lt;/span>&lt;span class="nv">isEmpty&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">size&lt;/span>&lt;span class="o">=&lt;/span>3&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">unsafe&lt;/span>&lt;span class="o">=&lt;/span>@Unsafe&lt;span class="o">[&lt;/span>sun.misc.Unsafe@2eaa1027&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">seedOffset&lt;/span>&lt;span class="o">=&lt;/span>@Long&lt;span class="o">[&lt;/span>24&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">illegalArgumentCount&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>13159&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>-x&lt;/code> 表示遍历深度，可以调整来打印具体的参数和结果内容，默认值是 1。&lt;/li>
&lt;li>&lt;code>-x&lt;/code> 最大值是 4，防止展开结果占用太多内存。用户可以在 &lt;code>ognl&lt;/code> 表达式里指定更具体的 field。&lt;/li>
&lt;/ul>
&lt;h4 id="条件表达式的例子">条件表达式的例子
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s2">&amp;#34;{params[0],target}&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;params[0]&amp;lt;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">68&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:36:04&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.530255ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>-18178089&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @MathGame&lt;span class="o">[&lt;/span>demo.MathGame@41cf53f9&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 只有满足条件的调用，才会有响应。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="观察异常信息的例子">观察异常信息的例子
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s2">&amp;#34;{params[0],throwExp}&amp;#34;&lt;/span> -e -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">62&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:38:00&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>1.414993ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>-1120397038&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> java.lang.IllegalArgumentException: number is: -1120397038, need &amp;gt;&lt;span class="o">=&lt;/span> &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.primeFactors&lt;span class="o">(&lt;/span>MathGame.java:46&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.run&lt;span class="o">(&lt;/span>MathGame.java:24&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.main&lt;span class="o">(&lt;/span>MathGame.java:16&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>-e&lt;/code>表示抛出异常时才触发&lt;/li>
&lt;li>express 中，表示异常信息的变量是 &lt;code>throwExp&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="按照耗时进行过滤">按照耗时进行过滤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s1">&amp;#39;{params, returnObj}&amp;#39;&lt;/span> &lt;span class="s1">&amp;#39;#cost&amp;gt;200&amp;#39;&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">66&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:40:28&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>2112.168897ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>5&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>428379493&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>#cost&amp;gt;200&lt;/code> (单位是 ms)表示只有当耗时大于 200ms 时才会输出，过滤掉执行时间小于 200ms 的调用&lt;/li>
&lt;/ul>
&lt;h4 id="观察当前对象中的属性">观察当前对象中的属性
&lt;/h4>&lt;p>如果想查看函数运行前后，当前对象中的属性，可以使用 target 关键字，代表当前对象&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s1">&amp;#39;target&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">52&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 19:41:52&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.477882ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@MathGame&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">random&lt;/span>&lt;span class="o">=&lt;/span>@Random&lt;span class="o">[&lt;/span>java.util.Random@522b408a&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">illegalArgumentCount&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>13355&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后使用 target.field_name 访问当前对象的某个属性&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch demo.MathGame primeFactors &lt;span class="s1">&amp;#39;target.illegalArgumentCount&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">67&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 20:04:34&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>131.303498ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>8&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-03 20:04:35&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.961441ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@Integer&lt;span class="o">[&lt;/span>8&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="获取类的静态字段调用类的静态函数的例子">获取类的静态字段、调用类的静态函数的例子
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">watch demo.MathGame * &lt;span class="s1">&amp;#39;{params,@demo.MathGame@random.nextInt(100)}&amp;#39;&lt;/span> -v -n &lt;span class="m">1&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>arthas@6527&lt;span class="o">]&lt;/span>$ watch demo.MathGame * &lt;span class="s1">&amp;#39;{params,@demo.MathGame@random.nextInt(100)}&amp;#39;&lt;/span> -n &lt;span class="m">1&lt;/span> -x &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 5&lt;span class="o">)&lt;/span> cost in &lt;span class="m">34&lt;/span> ms, listenerId: &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2021-01-05 21:35:20&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.173966ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>-138282&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>89&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意这里使用 &lt;code>Thread.currentThread().getContextClassLoader()&lt;/code> 加载,使用精确 &lt;code>classloader&lt;/code> ognl 更好。&lt;/p>
&lt;h4 id="排除掉指定的类">排除掉指定的类
&lt;/h4>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>watch/trace/monitor/stack/tt 命令都支持 &lt;code>--exclude-class-pattern&lt;/code> 参数&lt;/p>&lt;/blockquote>
&lt;p>使用 &lt;code>--exclude-class-pattern&lt;/code> 参数可以排除掉指定的类，比如：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">watch javax.servlet.Filter * --exclude-class-pattern com.demo.TestFilter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="不匹配子类">不匹配子类
&lt;/h4>&lt;p>默认情况下 watch/trace/monitor/stack/tt 命令都会匹配子类。如果想不匹配，可以通过全局参数关掉。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">options disable-sub-class &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="使用--v-参数打印更多信息">使用 -v 参数打印更多信息
&lt;/h4>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>watch/trace/monitor/stack/tt 命令都支持 &lt;code>-v&lt;/code> 参数&lt;/p>&lt;/blockquote>
&lt;p>当命令执行之后，没有输出结果。有两种可能：&lt;/p>
&lt;ol>
&lt;li>匹配到的函数没有被执行&lt;/li>
&lt;li>条件表达式结果是 false&lt;/li>
&lt;/ol>
&lt;p>但用户区分不出是哪种情况。&lt;/p>
&lt;p>使用 -v 选项，则会打印 Condition express 的具体值和执行结果，方便确认。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ watch -v -x &lt;span class="m">2&lt;/span> demo.MathGame print &lt;span class="s1">&amp;#39;params&amp;#39;&lt;/span> &lt;span class="s1">&amp;#39;params[0] &amp;gt; 100000&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">29&lt;/span> ms, listenerId: &lt;span class="m">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Condition express: params&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> &amp;gt; &lt;span class="m">100000&lt;/span> , result: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Condition express: params&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> &amp;gt; &lt;span class="m">100000&lt;/span> , result: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Condition express: params&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> &amp;gt; &lt;span class="m">100000&lt;/span> , result: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2020-12-02 22:38:56&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.060843ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>200033&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>200033&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Condition express: params&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> &amp;gt; &lt;span class="m">100000&lt;/span> , result: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2020-12-02 22:38:57&lt;span class="p">;&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nv">cost&lt;/span>&lt;span class="o">=&lt;/span>0.052877ms&lt;span class="o">]&lt;/span> &lt;span class="nv">result&lt;/span>&lt;span class="o">=&lt;/span>@Object&lt;span class="o">[][&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>123047&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>29&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>4243&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="trace">trace
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>方法内部调用路径，并输出方法路径上的每个节点上耗时&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>trace&lt;/code> 命令能主动搜索 &lt;code>class-pattern&lt;/code>／&lt;code>method-pattern&lt;/code> 对应的方法调用路径，渲染和统计整个调用链路上的所有性能开销和追踪调用链路。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>method-pattern&lt;/em>&lt;/td>
&lt;td>方法名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>condition-express&lt;/em>&lt;/td>
&lt;td>条件表达式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>命令执行次数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">#cost&lt;/td>
&lt;td>方法执行耗时&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[m &amp;lt;arg&amp;gt;]&lt;/td>
&lt;td>指定 Class 最大匹配数量，默认值为 50。长格式为[maxMatch &amp;lt;arg&amp;gt;]。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>这里重点要说明的是条件表达式，条件表达式的构成主要由 &lt;code>ognl&lt;/code> 表达式组成，所以你可以这样写 &lt;code>&amp;quot;params[0]&amp;lt;0&amp;quot;&lt;/code>，只要是一个合法的 ognl 表达式，都能被正常支持。&lt;/p>
&lt;p>很多时候我们只想看到某个方法的 rt 大于某个时间之后的 trace 结果，现在 Arthas 可以按照方法执行的耗时来进行过滤了，例如 &lt;code>trace \*StringUtils isBlank '#cost&amp;gt;100'&lt;/code> 表示当执行时间超过 100ms 的时候，才会输出 trace 的结果。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>watch/stack/trace 这个三个命令都支持 &lt;code>#cost&lt;/code>&lt;/p>&lt;/blockquote>
&lt;p>注意事项:&lt;/p>
&lt;ul>
&lt;li>trace 能方便的帮助你定位和发现因 RT 高而导致的性能问题缺陷，但其每次只能跟踪一级方法的调用链路。&lt;/li>
&lt;li>3.3.0 版本后，可以使用动态 Trace 功能，不断增加新的匹配类，参考下面的示例。&lt;/li>
&lt;li>目前不支持 trace java.lang.Thread getName ，考虑到不是非常必要场景，且修复有一定难度，因此当前暂不修复&lt;/li>
&lt;/ul>
&lt;h4 id="trace-函数">trace 函数
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ trace demo.MathGame run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">28&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2019-12-04 00:45:08&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.617465ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.078946ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#24 [throws Exception]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2019-12-04 00:45:09&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>1.276874ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.03752ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#24 [throws Exception]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>结果里的 &lt;code>#24&lt;/code>，表示在 run 函数里，在源文件的第 24 行调用了&lt;code>primeFactors()&lt;/code>函数。&lt;/p>
&lt;h4 id="指定-class-匹配的最大数量">指定 Class 匹配的最大数量
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ trace demo.MathGame run -m &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">412&lt;/span> ms, listenerId: &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2022-12-25 21:00:00&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@b4aac2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.762093ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>30.21% 0.230241ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#46 [throws Exception]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2022-12-25 21:00:10&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@b4aac2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.315298ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>13.95% 0.043995ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#46 [throws Exception]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="trace-次数限制">trace 次数限制
&lt;/h4>&lt;p>如果方法调用的次数很多，那么可以用 &lt;code>-n&lt;/code> 参数指定捕捉结果的次数。比如下面的例子里，捕捉到一次调用就退出命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">trace demo.MathGame run -n &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">20&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2019-12-04 00:45:53&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.549379ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.059839ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.232887ms&lt;span class="o">]&lt;/span> demo.MathGame:print&lt;span class="o">()&lt;/span> &lt;span class="c1">#25&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Command execution &lt;span class="nb">times&lt;/span> exceed limit: 1, so &lt;span class="nb">command&lt;/span> will exit. You can &lt;span class="nb">set&lt;/span> it with -n option.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="包含-jdk-的函数">包含 jdk 的函数
&lt;/h4>&lt;ul>
&lt;li>&lt;code>--skipJDKMethod &amp;lt;value&amp;gt;&lt;/code> skip jdk method trace, default value true.&lt;/li>
&lt;/ul>
&lt;p>默认情况下，trace 不会包含 jdk 里的函数调用，如果希望 trace jdk 里的函数，需要显式设置 &lt;code>--skipJDKMethod false&lt;/code>。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ trace --skipJDKMethod &lt;span class="nb">false&lt;/span> demo.MathGame run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">60&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2019-12-04 00:44:41&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>1.357742ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.028624ms&lt;span class="o">]&lt;/span> java.util.Random:nextInt&lt;span class="o">()&lt;/span> &lt;span class="c1">#23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.045534ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#24 [throws Exception]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.005372ms&lt;span class="o">]&lt;/span> java.lang.StringBuilder:&amp;lt;init&amp;gt;&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.012257ms&lt;span class="o">]&lt;/span> java.lang.Integer:valueOf&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.234537ms&lt;span class="o">]&lt;/span> java.lang.String:format&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>&lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>0.004539ms,max&lt;span class="o">=&lt;/span>0.005778ms,total&lt;span class="o">=&lt;/span>0.010317ms,count&lt;span class="o">=&lt;/span>2&lt;span class="o">]&lt;/span> java.lang.StringBuilder:append&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.013777ms&lt;span class="o">]&lt;/span> java.lang.Exception:getMessage&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.004935ms&lt;span class="o">]&lt;/span> java.lang.StringBuilder:toString&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.06941ms&lt;span class="o">]&lt;/span> java.io.PrintStream:println&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2019-12-04 00:44:42&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>3.030432ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.010473ms&lt;span class="o">]&lt;/span> java.util.Random:nextInt&lt;span class="o">()&lt;/span> &lt;span class="c1">#23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.023715ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#24 [throws Exception]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.005198ms&lt;span class="o">]&lt;/span> java.lang.StringBuilder:&amp;lt;init&amp;gt;&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.006405ms&lt;span class="o">]&lt;/span> java.lang.Integer:valueOf&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.178583ms&lt;span class="o">]&lt;/span> java.lang.String:format&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>&lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>0.011636ms,max&lt;span class="o">=&lt;/span>0.838077ms,total&lt;span class="o">=&lt;/span>0.849713ms,count&lt;span class="o">=&lt;/span>2&lt;span class="o">]&lt;/span> java.lang.StringBuilder:append&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.008747ms&lt;span class="o">]&lt;/span> java.lang.Exception:getMessage&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.019768ms&lt;span class="o">]&lt;/span> java.lang.StringBuilder:toString&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.076457ms&lt;span class="o">]&lt;/span> java.io.PrintStream:println&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="根据调用耗时过滤">根据调用耗时过滤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ trace demo.MathGame run &lt;span class="s1">&amp;#39;#cost &amp;gt; 10&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">41&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2018-12-04 01:12:02&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>12.033735ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.006783ms&lt;span class="o">]&lt;/span> java.util.Random:nextInt&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>11.852594ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.05447ms&lt;span class="o">]&lt;/span> demo.MathGame:print&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>只会展示耗时大于 10ms 的调用路径，有助于在排查问题的时候，只关注异常情况&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>是不是很眼熟，没错，在 JProfiler 等收费软件中你曾经见识类似的功能，这里你将可以通过命令就能打印出指定调用路径。 友情提醒下，&lt;code>trace&lt;/code> 在执行的过程中本身是会有一定的性能开销，在统计的报告中并未像 JProfiler 一样预先减去其自身的统计开销。所以这统计出来有些许的不准，渲染路径上调用的类、方法越多，性能偏差越大。但还是能让你看清一些事情的。&lt;/li>
&lt;li>[12.033735ms] 的含义，&lt;code>12.033735&lt;/code> 的含义是：当前节点在当前步骤的耗时，单位为毫秒&lt;/li>
&lt;li>[0,0,0ms,11]xxx:yyy() [throws Exception]，对该方法中相同的方法调用进行了合并，&lt;code>0,0,0ms,11&lt;/code> 表示方法调用耗时，&lt;code>min,max,total,count&lt;/code>；&lt;code>throws Exception&lt;/code> 表明该方法调用中存在异常返回&lt;/li>
&lt;li>这里存在一个统计不准确的问题，就是所有方法耗时加起来可能会小于该监测方法的总耗时，这个是由于 Arthas 本身的逻辑会有一定的耗时&lt;/li>
&lt;/ul>
&lt;h4 id="trace-多个类或者多个函数">trace 多个类或者多个函数
&lt;/h4>&lt;p>trace 命令只会 trace 匹配到的函数里的子调用，并不会向下 trace 多层。因为 trace 是代价比较贵的，多层 trace 可能会导致最终要 trace 的类和函数非常多。&lt;/p>
&lt;p>可以用正则表匹配路径上的多个类和函数，一定程度上达到多层 trace 的效果。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">trace -E com.test.ClassA&lt;span class="p">|&lt;/span>org.test.ClassB method1&lt;span class="p">|&lt;/span>method2&lt;span class="p">|&lt;/span>method3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="trace-时间不准确">trace 时间不准确
&lt;/h4>&lt;p>比如下面的结果里：&lt;code>0.705196&lt;/code> &amp;gt; &lt;code>(0.152743 + 0.145825)&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ trace demo.MathGame run -n &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">66&lt;/span> ms, listenerId: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2021-02-08 11:27:36&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@232204a1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.705196ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.152743ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.145825ms&lt;span class="o">]&lt;/span> demo.MathGame:print&lt;span class="o">()&lt;/span> &lt;span class="c1">#25&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>那么其它的时间消耗在哪些地方？&lt;/p>
&lt;ol>
&lt;li>没有被 trace 到的函数。比如 &lt;code>java.\*&lt;/code> 下的函数调用默认会忽略掉。通过增加 &lt;code>--skipJDKMethod false&lt;/code> 参数可以打印出来。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ trace demo.MathGame run --skipJDKMethod &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">35&lt;/span> ms, listenerId: &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>---ts&lt;span class="o">=&lt;/span>2021-02-08 11:27:48&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@232204a1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.810591ms&lt;span class="o">]&lt;/span> demo.MathGame:run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.034568ms&lt;span class="o">]&lt;/span> java.util.Random:nextInt&lt;span class="o">()&lt;/span> &lt;span class="c1">#23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.119367ms&lt;span class="o">]&lt;/span> demo.MathGame:primeFactors&lt;span class="o">()&lt;/span> &lt;span class="c1">#24 [throws Exception]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.017407ms&lt;span class="o">]&lt;/span> java.lang.StringBuilder:&amp;lt;init&amp;gt;&lt;span class="o">()&lt;/span> &lt;span class="c1">#28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.127922ms&lt;span class="o">]&lt;/span> java.lang.String:format&lt;span class="o">()&lt;/span> &lt;span class="c1">#57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>&lt;span class="nv">min&lt;/span>&lt;span class="o">=&lt;/span>0.01419ms,max&lt;span class="o">=&lt;/span>0.020221ms,total&lt;span class="o">=&lt;/span>0.034411ms,count&lt;span class="o">=&lt;/span>2&lt;span class="o">]&lt;/span> java.lang.StringBuilder:append&lt;span class="o">()&lt;/span> &lt;span class="c1">#57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.021911ms&lt;span class="o">]&lt;/span> java.lang.Exception:getMessage&lt;span class="o">()&lt;/span> &lt;span class="c1">#57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +---&lt;span class="o">[&lt;/span>0.015643ms&lt;span class="o">]&lt;/span> java.lang.StringBuilder:toString&lt;span class="o">()&lt;/span> &lt;span class="c1">#57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>---&lt;span class="o">[&lt;/span>0.086622ms&lt;span class="o">]&lt;/span> java.io.PrintStream:println&lt;span class="o">()&lt;/span> &lt;span class="c1">#57&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>非函数调用的指令消耗。比如 i++, getfield 等指令。&lt;/li>
&lt;li>在代码执行过程中，JVM 可能出现停顿，比如 GC，进入同步块等。&lt;/li>
&lt;/ol>
&lt;h3 id="stack">stack
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>输出当前方法被调用的调用路径&lt;/p>&lt;/blockquote>
&lt;p>很多时候我们都知道一个方法被执行，但这个方法被执行的路径非常多，或者你根本就不知道这个方法是从那里被执行了，此时你需要的是 stack 命令。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>class-pattern&lt;/em>&lt;/td>
&lt;td>类名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>method-pattern&lt;/em>&lt;/td>
&lt;td>方法名表达式匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>condition-express&lt;/em>&lt;/td>
&lt;td>条件表达式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[E]&lt;/td>
&lt;td>开启正则表达式匹配，默认为通配符匹配&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>执行次数限制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[m &amp;lt;arg&amp;gt;]&lt;/td>
&lt;td>指定 Class 最大匹配数量，默认值为 50。长格式为[maxMatch &amp;lt;arg&amp;gt;]。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>这里重点要说明的是观察表达式，观察表达式的构成主要由 &lt;code>ognl&lt;/code> 表达式组成，所以你可以这样写 &lt;code>&amp;quot;{params,returnObj}&amp;quot;&lt;/code>，只要是一个合法的 ognl 表达式，都能被正常支持。&lt;/p>
&lt;p>观察的维度也比较多，主要体现在参数 &lt;code>advice&lt;/code> 的数据结构上。&lt;code>Advice&lt;/code> 参数最主要是封装了通知节点的所有信息。&lt;/p>
&lt;h4 id="stack---run">stack - run
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ stack demo.MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">36&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-04 01:32:19&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @demo.MathGame.run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.main&lt;span class="o">(&lt;/span>MathGame.java:16&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="指定-class-最大匹配数量-2">指定 Class 最大匹配数量
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ stack demo.MathGame primeFactors -m &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count:1 , method count:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">561&lt;/span> ms, listenerId: 5.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2022-12-25 21:07:07&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@b4aac2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @demo.MathGame.primeFactors&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.run&lt;span class="o">(&lt;/span>MathGame.java:46&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.main&lt;span class="o">(&lt;/span>MathGame.java:38&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="据条件表达式来过滤">据条件表达式来过滤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ stack demo.MathGame primeFactors &lt;span class="s1">&amp;#39;params[0]&amp;lt;0&amp;#39;&lt;/span> -n &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">30&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-04 01:34:27&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @demo.MathGame.run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.main&lt;span class="o">(&lt;/span>MathGame.java:16&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-04 01:34:30&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @demo.MathGame.run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.main&lt;span class="o">(&lt;/span>MathGame.java:16&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Command execution &lt;span class="nb">times&lt;/span> exceed limit: 2, so &lt;span class="nb">command&lt;/span> will exit. You can &lt;span class="nb">set&lt;/span> it with -n option.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="据执行时间来过滤">据执行时间来过滤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ stack demo.MathGame primeFactors &lt;span class="s1">&amp;#39;#cost&amp;gt;5&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">35&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2018-12-04 01:35:58&lt;span class="p">;&lt;/span>&lt;span class="nv">thread_name&lt;/span>&lt;span class="o">=&lt;/span>main&lt;span class="p">;&lt;/span>&lt;span class="nv">id&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="p">;&lt;/span>&lt;span class="nv">is_daemon&lt;/span>&lt;span class="o">=&lt;/span>false&lt;span class="p">;&lt;/span>&lt;span class="nv">priority&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>&lt;span class="nv">TCCL&lt;/span>&lt;span class="o">=&lt;/span>sun.misc.Launcher&lt;span class="nv">$AppClassLoader&lt;/span>@3d4eac69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @demo.MathGame.run&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.main&lt;span class="o">(&lt;/span>MathGame.java:16&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="tt">tt
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>watch&lt;/code> 虽然很方便和灵活，但需要提前想清楚观察表达式的拼写，这对排查问题而言要求太高，因为很多时候我们并不清楚问题出自于何方，只能靠蛛丝马迹进行猜测。&lt;/p>
&lt;p>这个时候如果能记录下当时方法调用的所有入参和返回值、抛出的异常会对整个问题的思考与判断非常有帮助。&lt;/p>
&lt;p>于是乎，TimeTunnel 命令就诞生了。&lt;/p>
&lt;p>注意事项:&lt;/p>
&lt;ul>
&lt;li>tt 命令的实现是：把函数的入参/返回值等，保存到一个 &lt;code>Map&amp;lt;Integer, TimeFragment&amp;gt;&lt;/code> 里，默认的大小是 100。&lt;/li>
&lt;li>tt 相关功能在使用完之后，需要手动释放内存，否则长时间可能导致 OOM。退出 arthas 不会自动清除 tt 的缓存 map。&lt;/li>
&lt;/ul>
&lt;h4 id="记录调用">记录调用
&lt;/h4>&lt;p>对于一个最基本的使用来说，就是记录下当前方法的每次调用环境现场。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ tt -t demo.MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class-cnt:1 , method-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">66&lt;/span> ms.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> INDEX TIMESTAMP COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> IS-RET IS-EXP OBJECT CLASS METHOD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------------------------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1000&lt;/span> 2018-12-04 11:15:38 1.096236 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1001&lt;/span> 2018-12-04 11:15:39 0.191848 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1002&lt;/span> 2018-12-04 11:15:40 0.069523 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1003&lt;/span> 2018-12-04 11:15:41 0.186073 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1004&lt;/span> 2018-12-04 11:15:42 17.76437 &lt;span class="nb">true&lt;/span> &lt;span class="nb">false&lt;/span> 0x4b67cf4d MathGame
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="指定-class-最大匹配数量-3">指定 Class 最大匹配数量
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ tt -t -m &lt;span class="m">1&lt;/span> demo.MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count:1 , method count:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">130&lt;/span> ms, listenerId: 1.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> INDEX TIMESTAMP COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> IS-RET IS-EXP OBJECT CLASS METHOD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------------------------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1000&lt;/span> 2022-12-25 19:41:45 2.629929 &lt;span class="nb">true&lt;/span> &lt;span class="nb">false&lt;/span> 0x3bf400 MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1001&lt;/span> 2022-12-25 19:41:55 0.146161 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x3bf400 MathGame
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>命令参数解析&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>-t&lt;/code>
&lt;code>tt&lt;/code> 命令有很多个主参数，&lt;code>-t&lt;/code> 就是其中之一。这个参数的表明希望记录下类 *Test 的 print 方法的每次执行情况。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-n 3&lt;/code>
当你执行一个调用量不高的方法时可能你还能有足够的时间用 &lt;code>CTRL+C&lt;/code> 中断 tt 命令记录的过程，但如果遇到调用量非常大的方法，瞬间就能将你的 JVM 内存撑爆。&lt;/p>
&lt;p>此时你可以通过 &lt;code>-n&lt;/code> 参数指定你需要记录的次数，当达到记录次数时 Arthas 会主动中断 tt 命令的记录过程，避免人工操作无法停止的情况。&lt;/p>
&lt;ul>
&lt;li>&lt;code>-m 1&lt;/code>
通过 &lt;code>-m&lt;/code> 参数指定 Class 匹配的最大数量，防止匹配到的 Class 数量太多导致 JVM 挂起，默认值是 50&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>表格字段说明&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>表格字段&lt;/th>
&lt;th>字段解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>INDEX&lt;/td>
&lt;td>时间片段记录编号，每一个编号代表着一次调用，后续 tt 还有很多命令都是基于此编号指定记录操作，非常重要。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>TIMESTAMP&lt;/td>
&lt;td>方法执行的本机时间，记录了这个时间片段所发生的本机时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>COST(ms)&lt;/td>
&lt;td>方法执行的耗时&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IS-RET&lt;/td>
&lt;td>方法是否以正常返回的形式结束&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IS-EXP&lt;/td>
&lt;td>方法是否以抛异常的形式结束&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>OBJECT&lt;/td>
&lt;td>执行对象的 hashCode()，注意，曾经有人误认为是对象在 JVM 中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CLASS&lt;/td>
&lt;td>执行的类名&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>METHOD&lt;/td>
&lt;td>执行的方法名&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>条件表达式
不知道大家是否有在使用过程中遇到以下困惑&lt;/p>
&lt;ul>
&lt;li>Arthas 似乎很难区分出重载的方法&lt;/li>
&lt;li>我只需要观察特定参数，但是 tt 却全部都给我记录了下来&lt;/li>
&lt;/ul>
&lt;p>条件表达式也是用 OGNL 来编写，核心的判断对象依然是 Advice 对象。除了 tt 命令之外，watch、trace、stack 命令也都支持条件表达式。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解决方法重载&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> tt -t *Test print params.length&lt;span class="o">==&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过制定参数个数的形式解决不同的方法签名，如果参数个数一样，你还可以这样写&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">tt -t *Test print &lt;span class="s1">&amp;#39;params[1] instanceof Integer&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>解决指定参数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">tt -t *Test print params&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>.mobile&lt;span class="o">==&lt;/span>&lt;span class="s2">&amp;#34;13989838402&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>构成条件表达式的 &lt;code>Advice&lt;/code> 对象&lt;/p>
&lt;p>前边看到了很多条件表达式中，都使用了 params[0]，有关这个变量的介绍，请参考表达式核心变量&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="检索调用记录">检索调用记录
&lt;/h4>&lt;p>当你用 tt 记录了一大片的时间片段之后，你希望能从中筛选出自己需要的时间片段，这个时候你就需要对现有记录进行检索。&lt;/p>
&lt;p>假设我们有这些记录&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ tt -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> INDEX TIMESTAMP COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> IS-RET IS-EXP OBJECT CLASS METHOD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------------------------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1000&lt;/span> 2018-12-04 11:15:38 1.096236 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1001&lt;/span> 2018-12-04 11:15:39 0.191848 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1002&lt;/span> 2018-12-04 11:15:40 0.069523 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1003&lt;/span> 2018-12-04 11:15:41 0.186073 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1004&lt;/span> 2018-12-04 11:15:42 17.76437 &lt;span class="nb">true&lt;/span> &lt;span class="nb">false&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1005&lt;/span> 2018-12-04 11:15:43 0.4776 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>row-cnt:6&lt;span class="o">)&lt;/span> cost in &lt;span class="m">4&lt;/span> ms.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我需要筛选出 &lt;code>primeFactors&lt;/code> 方法的调用信息&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ tt -s &lt;span class="s1">&amp;#39;method.name==&amp;#34;primeFactors&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> INDEX TIMESTAMP COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> IS-RET IS-EXP OBJECT CLASS METHOD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------------------------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1000&lt;/span> 2018-12-04 11:15:38 1.096236 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1001&lt;/span> 2018-12-04 11:15:39 0.191848 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1002&lt;/span> 2018-12-04 11:15:40 0.069523 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1003&lt;/span> 2018-12-04 11:15:41 0.186073 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1004&lt;/span> 2018-12-04 11:15:42 17.76437 &lt;span class="nb">true&lt;/span> &lt;span class="nb">false&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1005&lt;/span> 2018-12-04 11:15:43 0.4776 &lt;span class="nb">false&lt;/span> &lt;span class="nb">true&lt;/span> 0x4b67cf4d MathGame primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>row-cnt:6&lt;span class="o">)&lt;/span> cost in &lt;span class="m">607&lt;/span> ms.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>你需要一个 &lt;code>-s&lt;/code> 参数。同样的，搜索表达式的核心对象依旧是 Advice 对象。&lt;/p>
&lt;h4 id="查看调用信息">查看调用信息
&lt;/h4>&lt;p>对于具体一个时间片的信息而言，你可以通过 &lt;code>-i&lt;/code> 参数后边跟着对应的 &lt;code>INDEX&lt;/code> 编号查看到他的详细信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ tt -i &lt;span class="m">1003&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> INDEX &lt;span class="m">1003&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GMT-CREATE 2018-12-04 11:15:41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> 0.186073
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OBJECT 0x4b67cf4d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CLASS demo.MathGame
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> METHOD primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IS-RETURN &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IS-EXCEPTION &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PARAMETERS&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> @Integer&lt;span class="o">[&lt;/span>-564322413&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> THROW-EXCEPTION java.lang.IllegalArgumentException: number is: -564322413, need &amp;gt;&lt;span class="o">=&lt;/span> &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.primeFactors&lt;span class="o">(&lt;/span>MathGame.java:46&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.run&lt;span class="o">(&lt;/span>MathGame.java:24&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at demo.MathGame.main&lt;span class="o">(&lt;/span>MathGame.java:16&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>row-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">11&lt;/span> ms.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="重做一次调用">重做一次调用
&lt;/h4>&lt;p>当你稍稍做了一些调整之后，你可能需要前端系统重新触发一次你的调用，此时得求爷爷告奶奶的需要前端配合联调的同学再次发起一次调用。而有些场景下，这个调用不是这么好触发的。&lt;/p>
&lt;p>&lt;code>tt&lt;/code> 命令由于保存了当时调用的所有现场信息，所以我们可以自己主动对一个 &lt;code>INDEX&lt;/code> 编号的时间片自主发起一次调用，从而解放你的沟通成本。此时你需要 &lt;code>-p&lt;/code> 参数。通过 &lt;code>--replay-times&lt;/code> 指定 调用次数，通过 &lt;code>--replay-interval&lt;/code> 指定多次调用间隔(单位 ms, 默认 1000ms)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ tt -i &lt;span class="m">1004&lt;/span> -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RE-INDEX &lt;span class="m">1004&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GMT-REPLAY 2018-12-04 11:26:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OBJECT 0x4b67cf4d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CLASS demo.MathGame
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> METHOD primeFactors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PARAMETERS&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> @Integer&lt;span class="o">[&lt;/span>946738738&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IS-RETURN &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IS-EXCEPTION &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> 0.186073
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RETURN-OBJ @ArrayList&lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>11&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>17&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Integer&lt;span class="o">[&lt;/span>2531387&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Time fragment&lt;span class="o">[&lt;/span>1004&lt;span class="o">]&lt;/span> successfully replayed.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>row-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">14&lt;/span> ms.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>你会发现结果虽然一样，但调用的路径发生了变化，由原来的程序发起变成了 Arthas 自己的内部线程发起的调用了。&lt;/p>
&lt;h4 id="观察表达式">观察表达式
&lt;/h4>&lt;p>&lt;code>-w, --watch-express&lt;/code> 观察时空隧道使用 &lt;code>ognl&lt;/code> 表达式&lt;/p>
&lt;ul>
&lt;li>
&lt;p>使用表达式核心变量中所有变量作为已知条件编写表达式。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>arthas@10718&lt;span class="o">]&lt;/span>$ tt -t demo.MathGame run -n &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">56&lt;/span> ms, listenerId: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INDEX TIMESTAMP COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> IS-RET IS-EXP OBJECT CLASS METHOD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1000&lt;/span> 2021-01-08 21:54:17 0.901091 &lt;span class="nb">true&lt;/span> &lt;span class="nb">false&lt;/span> 0x7699a589 MathGame run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>arthas@10718&lt;span class="o">]&lt;/span>$ tt -w &lt;span class="s1">&amp;#39;target.illegalArgumentCount&amp;#39;&lt;/span> -x &lt;span class="m">1&lt;/span> -i &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@Integer&lt;span class="o">[&lt;/span>60&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>row-cnt:1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">7&lt;/span> ms.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>获取类的静态字段、调用类的静态方法&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>arthas@10718&lt;span class="o">]&lt;/span>$ tt -t demo.MathGame run -n &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Q or Ctrl+C to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Affect&lt;span class="o">(&lt;/span>class count: &lt;span class="m">1&lt;/span> , method count: 1&lt;span class="o">)&lt;/span> cost in &lt;span class="m">56&lt;/span> ms, listenerId: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INDEX TIMESTAMP COST&lt;span class="o">(&lt;/span>ms&lt;span class="o">)&lt;/span> IS-RET IS-EXP OBJECT CLASS METHOD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1000&lt;/span> 2021-01-08 21:54:17 0.901091 &lt;span class="nb">true&lt;/span> &lt;span class="nb">false&lt;/span> 0x7699a589 MathGame run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>arthas@10718&lt;span class="o">]&lt;/span>$ tt -w &lt;span class="s1">&amp;#39;@demo.MathGame@random.nextInt(100)&amp;#39;&lt;/span> -x &lt;span class="m">1&lt;/span> -i &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@Integer&lt;span class="o">[&lt;/span>46&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意这里使用 &lt;code>com.taobao.arthas.core.advisor.Advice#getLoader&lt;/code> 加载,使用精确 &lt;code>classloader&lt;/code> ognl 更好。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>需要强调的点&lt;/p>
&lt;ol>
&lt;li>ThreadLocal 信息丢失&lt;/li>
&lt;/ol>
&lt;p>很多框架偷偷的将一些环境变量信息塞到了发起调用线程的 ThreadLocal 中，由于调用线程发生了变化，这些 ThreadLocal 线程信息无法通过 Arthas 保存，所以这些信息将会丢失。&lt;/p>
&lt;p>一些常见的 CASE 比如：鹰眼的 TraceId 等。&lt;/p>
&lt;ol start="2">
&lt;li>引用的对象&lt;/li>
&lt;/ol>
&lt;p>需要强调的是，tt 命令是将当前环境的对象引用保存起来，但仅仅也只能保存一个引用而已。如果方法内部对入参进行了变更，或者返回的对象经过了后续的处理，那么在 tt 查看的时候将无法看到当时最准确的值。这也是为什么 watch 命令存在的意义。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="通过索引删除指定的-tt-记录">通过索引删除指定的 tt 记录
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">tt -d &lt;span class="m">1001&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="清除所有的-tt-记录">清除所有的 tt 记录
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">tt --delete-all
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="profiler">profiler
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>使用 async-profiler 生成火焰图&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>profiler&lt;/code> 命令支持生成应用热点的火焰图。本质上是通过不断的采样，然后把收集到的采样结果生成火焰图。&lt;/p>
&lt;p>&lt;code>profiler&lt;/code> 命令基本运行结构是 &lt;code>profiler action [actionArg]&lt;/code>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>action&lt;/em>&lt;/td>
&lt;td>要执行的操作&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>actionArg&lt;/em>&lt;/td>
&lt;td>属性名模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[i:]&lt;/td>
&lt;td>采样间隔（单位：ns）（默认值：10'000'000，即 10 ms）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[f:]&lt;/td>
&lt;td>将输出转储到指定路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[d:]&lt;/td>
&lt;td>运行评测指定秒&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[e:]&lt;/td>
&lt;td>要跟踪哪个事件（cpu, alloc, lock, cache-misses 等），默认是 cpu&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="启动-profiler">启动 profiler
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>默认情况下，生成的是 cpu 的火焰图，即 event 为 cpu。可以用&amp;ndash;event 参数来指定。&lt;/p>&lt;/blockquote>
&lt;h4 id="获取已采集的-sample-的数量">获取已采集的 sample 的数量
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ profiler getSamples
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">23&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看-profiler-状态">查看 profiler 状态
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ profiler status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>cpu&lt;span class="o">]&lt;/span> profiling is running &lt;span class="k">for&lt;/span> &lt;span class="m">4&lt;/span> seconds
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以查看当前 profiler 在采样哪种 &lt;code>event&lt;/code> 和采样时间。&lt;/p>
&lt;h4 id="停止-profiler">停止 profiler
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 默认情况下，结果文件是html格式，也可以用--format参数指定：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ profiler stop --format html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profiler output file: /tmp/test/arthas-output/20211207-111550.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 或者在--file参数里用文件名指名格式。比如--file /tmp/result.html 。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="profiler-支持的-events">profiler 支持的 events
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在不同的平台，不同的 OS 下面，支持的 events 各有不同。可以使用命令查看：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profiler list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 可以用--event参数指定要采样的事件，比如对alloc事件进入采样：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profiler start --event alloc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="恢复采样">恢复采样
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler resume
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>start&lt;/code> 和 &lt;code>resume&lt;/code> 的区别是：&lt;code>start&lt;/code> 是新开始采样，&lt;code>resume&lt;/code> 会保留上次 &lt;code>stop&lt;/code> 时的数据。&lt;/p>
&lt;p>通过执行 &lt;code>profiler getSamples&lt;/code> 可以查看 &lt;code>samples&lt;/code> 的数量来验证。&lt;/p>
&lt;h4 id="使用-execute-来执行复杂的命令">使用 execute 来执行复杂的命令
&lt;/h4>&lt;p>比如开始采样：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler execute &lt;span class="s1">&amp;#39;start,framebuf=5000000&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>停止采样，并保存到指定文件里：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler execute &lt;span class="s1">&amp;#39;stop,file=/tmp/result.html&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看所有支持的-action">查看所有支持的 action
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ profiler actions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Supported Actions: &lt;span class="o">[&lt;/span>resume, dumpCollapsed, getSamples, start, list, execute, version, stop, load, dumpFlat, actions, dumpTraces, status&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看版本">查看版本
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ profiler version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Async-profiler 1.6 built on Sep &lt;span class="m">9&lt;/span> &lt;span class="m">2019&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copyright &lt;span class="m">2019&lt;/span> Andrei Pangin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置-framebuf-参数">配置 framebuf 参数
&lt;/h4>&lt;blockquote>
&lt;p>如果遇到生成的火焰图有 [frame_buffer_overflow]，则需要增大 framebuf（默认值是 1'000'000），可以显式配置，比如：&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler start --framebuf &lt;span class="m">5000000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置-includeexclude-来过滤数据">配置 include/exclude 来过滤数据
&lt;/h4>&lt;p>如果应用比较复杂，生成的内容很多，想只关注部分数据，可以通过 include/exclude 来过滤。比如&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler start --include &lt;span class="s1">&amp;#39;java/*&amp;#39;&lt;/span> --include &lt;span class="s1">&amp;#39;demo/*&amp;#39;&lt;/span> --exclude &lt;span class="s1">&amp;#39;*Unsafe.park*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>include/exclude 都支持设置多个值 ，但是需要配置在命令行的最后。&lt;/p>&lt;/blockquote>
&lt;h4 id="指定执行时间">指定执行时间
&lt;/h4>&lt;p>比如，希望 profiler 执行 300 秒自动结束，可以用 &lt;code>-d/--duration&lt;/code> 参数指定：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler start --duration &lt;span class="m">300&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="生成-jfr-格式结果">生成 jfr 格式结果
&lt;/h4>&lt;p>注意，jfr 只支持在 &lt;code>start&lt;/code> 时配置。如果是在 &lt;code>stop&lt;/code> 时指定，则不会生效。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">profiler start --file /tmp/test.jfr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>file&lt;/code> 参数支持一些变量：&lt;/p>
&lt;ul>
&lt;li>时间戳： &amp;ndash;file /tmp/test-%t.jfr&lt;/li>
&lt;li>进程 ID： &amp;ndash;file /tmp/test-%p.jfr&lt;/li>
&lt;/ul>
&lt;p>生成的结果可以用支持 jfr 格式的工具来查看。比如：&lt;/p>
&lt;ul>
&lt;li>JDK Mission Control&lt;/li>
&lt;li>JProfiler&lt;/li>
&lt;/ul>
&lt;h3 id="jfr">jfr
&lt;/h3>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>Java Flight Recorder (JFR) 是一种用于收集有关正在运行的 Java 应用程序的诊断和分析数据的工具。它集成到 Java 虚拟机 (JVM) 中，几乎不会造成性能开销，因此即使在负载较重的生产环境中也可以使用。&lt;/p>&lt;/blockquote>
&lt;p>&lt;code>jfr&lt;/code> 命令支持在程序动态运行过程中开启和关闭 JFR 记录。 记录收集有关 event 的数据。事件在特定时间点发生在 JVM 或 Java 应用程序中。每个事件都有一个名称、一个时间戳和一个可选的有效负载。负载是与事件相关的数据，例如 CPU 使用率、事件前后的 Java 堆大小、锁持有者的线程 ID 等。&lt;/p>
&lt;p>&lt;code>jfr&lt;/code> 命令基本运行结构是 &lt;code>jfr cmd [actionArg]&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>注意： JDK8 的 8u262 版本之后才支持 jfr&lt;/p>&lt;/blockquote>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: right">参数名称&lt;/th>
&lt;th>参数说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: right">&lt;em>cmd&lt;/em>&lt;/td>
&lt;td>要执行的操作 支持的命令【start，status，dump，stop】&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">&lt;em>actionArg&lt;/em>&lt;/td>
&lt;td>属性名模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[n:]&lt;/td>
&lt;td>记录名称&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[r:]&lt;/td>
&lt;td>记录 id 值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[dumponexit:]&lt;/td>
&lt;td>程序退出时，是否要 dump 出 .jfr 文件，默认为 false&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[d:]&lt;/td>
&lt;td>延迟多久后启动 JFR 记录，支持带单位配置，eg: 60s, 2m, 5h, 3d. 不带单位就是秒，默认无延迟&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[duration:]&lt;/td>
&lt;td>JFR 记录持续时间，支持单位配置，不带单位就是秒，默认一直记录&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[s:]&lt;/td>
&lt;td>采集 Event 的详细配置文件，默认是 default.jfc 位于 $JAVA_HOME/lib/jfr/default.jfc&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[f:]&lt;/td>
&lt;td>将输出转储到指定路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[maxage:]&lt;/td>
&lt;td>缓冲区数据最大文件记录保存时间，支持单位配置，不带单位就是秒，默认是不限制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[maxsize:]&lt;/td>
&lt;td>缓冲区的最大文件大小，支持单位配置， 不带单位是字节，m 或者 M 代表 MB，g 或者 G 代表 GB。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: right">[state:]&lt;/td>
&lt;td>jfr 记录状态&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="启动-jfr-记录">启动 JFR 记录
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Started recording 1. No limit specified, using &lt;span class="nv">maxsize&lt;/span>&lt;span class="o">=&lt;/span>250MB as default.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>提示&lt;/strong>&lt;/p>
&lt;p>默认情况下，开启的是默认参数的 jfr 记录&lt;/p>&lt;/blockquote>
&lt;p>启动 jfr 记录，指定记录名，记录持续时间，记录文件保存路径。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr start -n myRecording --duration 60s -f /tmp/myRecording.jfr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Started recording 2. The result will be written to:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/tmp/myRecording.jfr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看-jfr-记录状态">查看 JFR 记录状态
&lt;/h4>&lt;p>默认是查看所有 JFR 记录信息&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Recording: &lt;span class="nv">recording&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>Recording-1 &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Recording: &lt;span class="nv">recording&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>myRecording &lt;span class="nv">duration&lt;/span>&lt;span class="o">=&lt;/span>PT1M &lt;span class="o">(&lt;/span>closed&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看指定记录 id 的记录信息&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr status -r &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Recording: &lt;span class="nv">recording&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>Recording-1 &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看指定状态的记录信息&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr status --state closed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Recording: &lt;span class="nv">recording&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>myRecording &lt;span class="nv">duration&lt;/span>&lt;span class="o">=&lt;/span>PT1M &lt;span class="o">(&lt;/span>closed&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="dump-jfr-记录">dump jfr 记录
&lt;/h4>&lt;p>&lt;code>jfr dump&lt;/code> 会输出从开始到运行该命令这段时间内的记录到 JFR 文件，且不会停止 &lt;code>jfr&lt;/code> 的记录
指定记录输出路径&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr dump -r &lt;span class="m">1&lt;/span> -f /tmp/myRecording1.jfr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dump recording 1, The result will be written to:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/tmp/myRecording1.jfr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>不指定文件输出路径，默认是保存到 arthas-output 目录下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr dump -r &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dump recording 1, The result will be written to:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/tmp/test/arthas-output/20220819-200915.jfr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="停止-jfr-记录">停止 jfr 记录
&lt;/h4>&lt;p>不指定记录输出路径，默认是保存到 arthas-output 目录下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ jfr stop -r &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Stop recording 1, The result will be written to:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/tmp/test/arthas-output/20220819-202049.jfr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>注意一条记录只能停止一次。&lt;/p>&lt;/blockquote>
&lt;p>也可以指定记录输出路径。&lt;/p>
&lt;h4 id="通过浏览器查看-arthas-output-下面-jfr-记录的结果">通过浏览器查看 arthas-output 下面 JFR 记录的结果
&lt;/h4>&lt;p>默认情况下，arthas 使用 8563 端口，则可以打开： http://localhost:8563/arthas-output/ 查看到 arthas-output 目录下面的 JFR 记录结果。&lt;/p>
&lt;p>生成的结果可以用支持 jfr 格式的工具来查看。比如：&lt;/p>
&lt;ul>
&lt;li>JDK Mission Control&lt;/li>
&lt;/ul></description></item></channel></rss>