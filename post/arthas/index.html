<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="æ•´ç† Arthas çš„ä½¿ç”¨æ–¹æ³•"><title>Arthas</title>
<link rel=canonical href=https://www.lcsk42.com/post/arthas/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Arthas"><meta property='og:description' content="æ•´ç† Arthas çš„ä½¿ç”¨æ–¹æ³•"><meta property='og:url' content='https://www.lcsk42.com/post/arthas/'><meta property='og:site_name' content="Lucas's Article"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Arthas'><meta property='article:published_time' content='2024-03-22T09:39:46+08:00'><meta property='article:modified_time' content='2024-03-22T09:39:46+08:00'><meta name=twitter:title content="Arthas"><meta name=twitter:description content="æ•´ç† Arthas çš„ä½¿ç”¨æ–¹æ³•"><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_b46f367e8ae3a2b0.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ« </span></figure><div class=site-meta><h1 class=site-name><a href=/>Lucas's Article</a></h1><h2 class=site-description>Life is short; meeting you is the best fortune.</h2></div></header><ol class=menu-social><li><a href=https://github.com/lcsk42 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:lcsk42@gmail.com target=_blank title=Mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://x.com/lcsk42 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/about/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-pagekit"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12.077 20H7V4h11v14h-5.077"/></svg>
<span>About</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#å¼€å§‹>å¼€å§‹</a></li><li><a href=#è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡>è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</a></li><li><a href=#åŸºç¡€å‘½ä»¤>åŸºç¡€å‘½ä»¤</a><ol><li><a href=#help>help</a></li><li><a href=#cls>cls</a></li><li><a href=#session>session</a></li><li><a href=#reset>reset</a></li><li><a href=#version>version</a></li><li><a href=#history>history</a></li><li><a href=#quit-stop>quit-stop</a></li><li><a href=#keymap>keymap</a><ol><li><a href=#è‡ªå®šä¹‰å¿«æ·é”®>è‡ªå®šä¹‰å¿«æ·é”®</a></li><li><a href=#åå°å¼‚æ­¥å‘½ä»¤ç›¸å…³å¿«æ·é”®>åå°å¼‚æ­¥å‘½ä»¤ç›¸å…³å¿«æ·é”®</a></li></ol></li><li><a href=#cat>cat</a></li><li><a href=#echo>echo</a></li><li><a href=#grep>grep</a></li><li><a href=#tee>tee</a></li><li><a href=#pwd>pwd</a></li><li><a href=#plaintext>plaintext</a></li><li><a href=#wc>wc</a></li><li><a href=#options>options</a><ol><li><a href=#æ‰“å¼€-unsafe-å¼€å…³æ”¯æŒ-jdk-package-ä¸‹çš„ç±»>æ‰“å¼€ unsafe å¼€å…³ï¼Œæ”¯æŒ jdk package ä¸‹çš„ç±»</a></li><li><a href=#å…³é—­-strict-æ¨¡å¼å…è®¸åœ¨-ognl-è¡¨è¾¾å¼é‡Œè®¾ç½®å¯¹è±¡å±æ€§>å…³é—­ strict æ¨¡å¼ï¼Œå…è®¸åœ¨ ognl è¡¨è¾¾å¼é‡Œè®¾ç½®å¯¹è±¡å±æ€§</a></li></ol></li></ol></li><li><a href=#ç³»ç»Ÿå‘½ä»¤>ç³»ç»Ÿå‘½ä»¤</a><ol><li><a href=#dashboard>dashboard</a><ol><li><a href=#æ•°æ®è¯´æ˜>æ•°æ®è¯´æ˜</a></li><li><a href=#jvm-å†…éƒ¨çº¿ç¨‹>JVM å†…éƒ¨çº¿ç¨‹</a></li></ol></li><li><a href=#thread>thread</a></li><li><a href=#jvm>jvm</a></li><li><a href=#sysprop>sysprop</a></li><li><a href=#sysenv>sysenv</a></li><li><a href=#vmoption>vmoption</a></li><li><a href=#vmtool>vmtool</a></li><li><a href=#perfcounter>perfcounter</a></li><li><a href=#logger>logger</a></li><li><a href=#getstatic>getstatic</a></li><li><a href=#ognl>ognl</a></li><li><a href=#mbean>mbean</a></li><li><a href=#heapdump>heapdump</a></li></ol></li><li><a href=#ç±»å‘½ä»¤>ç±»å‘½ä»¤</a><ol><li><a href=#sc>sc</a></li><li><a href=#sm>sm</a></li><li><a href=#jad>jad</a></li><li><a href=#mc-retransform>mc-retransform</a><ol><li><a href=#å¦‚æœå¯¹æŸä¸ªç±»æ‰§è¡Œ-retransform-ä¹‹åæƒ³æ¶ˆé™¤å½±å“åˆ™éœ€è¦>å¦‚æœå¯¹æŸä¸ªç±»æ‰§è¡Œ retransform ä¹‹åï¼Œæƒ³æ¶ˆé™¤å½±å“ï¼Œåˆ™éœ€è¦</a></li><li><a href=#ç»“åˆ-jadmc-å‘½ä»¤ä½¿ç”¨>ç»“åˆ jad/mc å‘½ä»¤ä½¿ç”¨</a></li><li><a href=#ä¸Šä¼ -class-æ–‡ä»¶åˆ°æœåŠ¡å™¨çš„æŠ€å·§>ä¸Šä¼  .class æ–‡ä»¶åˆ°æœåŠ¡å™¨çš„æŠ€å·§</a></li></ol></li><li><a href=#mc-redefine>mc-redefine</a></li><li><a href=#dump>dump</a></li><li><a href=#classloader>classloader</a></li></ol></li><li><a href=#å¢å¼ºå‘½ä»¤>å¢å¼ºå‘½ä»¤</a><ol><li><a href=#monitor>monitor</a><ol><li><a href=#æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</a></li><li><a href=#è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å>è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœ(æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å)</a></li><li><a href=#è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å‰>è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœ(æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å‰)</a></li></ol></li><li><a href=#watch>watch</a><ol><li><a href=#è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°this-å¯¹è±¡å’Œè¿”å›å€¼>è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°ã€this å¯¹è±¡å’Œè¿”å›å€¼</a></li><li><a href=#æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡-1>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</a></li><li><a href=#è§‚å¯Ÿå‡½æ•°è°ƒç”¨å…¥å£çš„å‚æ•°å’Œè¿”å›å€¼>è§‚å¯Ÿå‡½æ•°è°ƒç”¨å…¥å£çš„å‚æ•°å’Œè¿”å›å€¼</a></li><li><a href=#åŒæ—¶è§‚å¯Ÿå‡½æ•°è°ƒç”¨å‰å’Œå‡½æ•°è¿”å›å>åŒæ—¶è§‚å¯Ÿå‡½æ•°è°ƒç”¨å‰å’Œå‡½æ•°è¿”å›å</a></li><li><a href=#è°ƒæ•´-x-çš„å€¼è§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼>è°ƒæ•´-x çš„å€¼ï¼Œè§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼</a></li><li><a href=#æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­>æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­</a></li><li><a href=#è§‚å¯Ÿå¼‚å¸¸ä¿¡æ¯çš„ä¾‹å­>è§‚å¯Ÿå¼‚å¸¸ä¿¡æ¯çš„ä¾‹å­</a></li><li><a href=#æŒ‰ç…§è€—æ—¶è¿›è¡Œè¿‡æ»¤>æŒ‰ç…§è€—æ—¶è¿›è¡Œè¿‡æ»¤</a></li><li><a href=#è§‚å¯Ÿå½“å‰å¯¹è±¡ä¸­çš„å±æ€§>è§‚å¯Ÿå½“å‰å¯¹è±¡ä¸­çš„å±æ€§</a></li><li><a href=#è·å–ç±»çš„é™æ€å­—æ®µè°ƒç”¨ç±»çš„é™æ€å‡½æ•°çš„ä¾‹å­>è·å–ç±»çš„é™æ€å­—æ®µã€è°ƒç”¨ç±»çš„é™æ€å‡½æ•°çš„ä¾‹å­</a></li><li><a href=#æ’é™¤æ‰æŒ‡å®šçš„ç±»>æ’é™¤æ‰æŒ‡å®šçš„ç±»</a></li><li><a href=#ä¸åŒ¹é…å­ç±»>ä¸åŒ¹é…å­ç±»</a></li><li><a href=#ä½¿ç”¨--v-å‚æ•°æ‰“å°æ›´å¤šä¿¡æ¯>ä½¿ç”¨ -v å‚æ•°æ‰“å°æ›´å¤šä¿¡æ¯</a></li></ol></li><li><a href=#trace>trace</a><ol><li><a href=#trace-å‡½æ•°>trace å‡½æ•°</a></li><li><a href=#æŒ‡å®š-class-åŒ¹é…çš„æœ€å¤§æ•°é‡>æŒ‡å®š Class åŒ¹é…çš„æœ€å¤§æ•°é‡</a></li><li><a href=#trace-æ¬¡æ•°é™åˆ¶>trace æ¬¡æ•°é™åˆ¶</a></li><li><a href=#åŒ…å«-jdk-çš„å‡½æ•°>åŒ…å« jdk çš„å‡½æ•°</a></li><li><a href=#æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤>æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤</a></li><li><a href=#trace-å¤šä¸ªç±»æˆ–è€…å¤šä¸ªå‡½æ•°>trace å¤šä¸ªç±»æˆ–è€…å¤šä¸ªå‡½æ•°</a></li><li><a href=#trace-æ—¶é—´ä¸å‡†ç¡®>trace æ—¶é—´ä¸å‡†ç¡®</a></li></ol></li><li><a href=#stack>stack</a><ol><li><a href=#stack---run>stack - run</a></li><li><a href=#æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡-2>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</a></li><li><a href=#æ®æ¡ä»¶è¡¨è¾¾å¼æ¥è¿‡æ»¤>æ®æ¡ä»¶è¡¨è¾¾å¼æ¥è¿‡æ»¤</a></li><li><a href=#æ®æ‰§è¡Œæ—¶é—´æ¥è¿‡æ»¤>æ®æ‰§è¡Œæ—¶é—´æ¥è¿‡æ»¤</a></li></ol></li><li><a href=#tt>tt</a><ol><li><a href=#è®°å½•è°ƒç”¨>è®°å½•è°ƒç”¨</a></li><li><a href=#æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡-3>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</a></li><li><a href=#æ£€ç´¢è°ƒç”¨è®°å½•>æ£€ç´¢è°ƒç”¨è®°å½•</a></li><li><a href=#æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯>æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯</a></li><li><a href=#é‡åšä¸€æ¬¡è°ƒç”¨>é‡åšä¸€æ¬¡è°ƒç”¨</a></li><li><a href=#è§‚å¯Ÿè¡¨è¾¾å¼>è§‚å¯Ÿè¡¨è¾¾å¼</a></li><li><a href=#é€šè¿‡ç´¢å¼•åˆ é™¤æŒ‡å®šçš„-tt-è®°å½•>é€šè¿‡ç´¢å¼•åˆ é™¤æŒ‡å®šçš„ tt è®°å½•</a></li><li><a href=#æ¸…é™¤æ‰€æœ‰çš„-tt-è®°å½•>æ¸…é™¤æ‰€æœ‰çš„ tt è®°å½•</a></li></ol></li><li><a href=#profiler>profiler</a><ol><li><a href=#å¯åŠ¨-profiler>å¯åŠ¨ profiler</a></li><li><a href=#è·å–å·²é‡‡é›†çš„-sample-çš„æ•°é‡>è·å–å·²é‡‡é›†çš„ sample çš„æ•°é‡</a></li><li><a href=#æŸ¥çœ‹-profiler-çŠ¶æ€>æŸ¥çœ‹ profiler çŠ¶æ€</a></li><li><a href=#åœæ­¢-profiler>åœæ­¢ profiler</a></li><li><a href=#profiler-æ”¯æŒçš„-events>profiler æ”¯æŒçš„ events</a></li><li><a href=#æ¢å¤é‡‡æ ·>æ¢å¤é‡‡æ ·</a></li><li><a href=#ä½¿ç”¨-execute-æ¥æ‰§è¡Œå¤æ‚çš„å‘½ä»¤>ä½¿ç”¨ execute æ¥æ‰§è¡Œå¤æ‚çš„å‘½ä»¤</a></li><li><a href=#æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„-action>æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„ action</a></li><li><a href=#æŸ¥çœ‹ç‰ˆæœ¬>æŸ¥çœ‹ç‰ˆæœ¬</a></li><li><a href=#é…ç½®-framebuf-å‚æ•°>é…ç½® framebuf å‚æ•°</a></li><li><a href=#é…ç½®-includeexclude-æ¥è¿‡æ»¤æ•°æ®>é…ç½® include/exclude æ¥è¿‡æ»¤æ•°æ®</a></li><li><a href=#æŒ‡å®šæ‰§è¡Œæ—¶é—´>æŒ‡å®šæ‰§è¡Œæ—¶é—´</a></li><li><a href=#ç”Ÿæˆ-jfr-æ ¼å¼ç»“æœ>ç”Ÿæˆ jfr æ ¼å¼ç»“æœ</a></li></ol></li><li><a href=#jfr>jfr</a><ol><li><a href=#å¯åŠ¨-jfr-è®°å½•>å¯åŠ¨ JFR è®°å½•</a></li><li><a href=#æŸ¥çœ‹-jfr-è®°å½•çŠ¶æ€>æŸ¥çœ‹ JFR è®°å½•çŠ¶æ€</a></li><li><a href=#dump-jfr-è®°å½•>dump jfr è®°å½•</a></li><li><a href=#åœæ­¢-jfr-è®°å½•>åœæ­¢ jfr è®°å½•</a></li><li><a href=#é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹-arthas-output-ä¸‹é¢-jfr-è®°å½•çš„ç»“æœ>é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹ arthas-output ä¸‹é¢ JFR è®°å½•çš„ç»“æœ</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/ops/>Ops</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/arthas/>Arthas</a></h2><h3 class=article-subtitle>æ•´ç† Arthas çš„ä½¿ç”¨æ–¹æ³•</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 22, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>38 minute read</time></div></footer></div></header><section class=article-content><p>Alibaba å¼€æºçš„ Java è¯Šæ–­å·¥å…· Arthas ä½¿ç”¨è®°å½•ã€‚</p><h2 id=å¼€å§‹>å¼€å§‹</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## ä¸‹è½½å¯åŠ¨æµ‹è¯•ç¨‹åº</span>
</span></span><span class=line><span class=cl>curl -O https://arthas.aliyun.com/math-game.jar
</span></span><span class=line><span class=cl>java -jar math-game.jar
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸‹è½½å¯åŠ¨ arthas</span>
</span></span><span class=line><span class=cl>curl -O https://arthas.aliyun.com/arthas-boot.jar
</span></span><span class=line><span class=cl>java -jar arthas-boot.jar
</span></span></code></pre></td></tr></table></div></div><h2 id=è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡>è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</h2><p>æ— è®ºæ˜¯åŒ¹é…è¡¨è¾¾å¼ä¹Ÿå¥½ã€è§‚å¯Ÿè¡¨è¾¾å¼ä¹Ÿç½¢ï¼Œä»–ä»¬æ ¸å¿ƒåˆ¤æ–­å˜é‡éƒ½æ˜¯å›´ç»•ç€ä¸€ä¸ª Arthas ä¸­çš„é€šç”¨é€šçŸ¥å¯¹è±¡ <code>Advice</code> è¿›è¡Œã€‚</p><p>å®ƒçš„ç®€ç•¥ä»£ç ç»“æ„å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Advice</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ClassLoader</span><span class=w> </span><span class=n>loader</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>clazz</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ArthasMethod</span><span class=w> </span><span class=n>method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>target</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>params</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>returnObj</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=n>throwExp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isBefore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isThrow</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isReturn</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// getter/setter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œåˆ—ä¸€ä¸ªè¡¨æ ¼æ¥è¯´æ˜ä¸åŒå˜é‡çš„å«ä¹‰</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å˜é‡å</th><th>å˜é‡è§£é‡Š</th></tr></thead><tbody><tr><td style=text-align:right>loader</td><td>æœ¬æ¬¡è°ƒç”¨ç±»æ‰€åœ¨çš„ ClassLoader</td></tr><tr><td style=text-align:right>clazz</td><td>æœ¬æ¬¡è°ƒç”¨ç±»çš„ Class å¼•ç”¨</td></tr><tr><td style=text-align:right>method</td><td>æœ¬æ¬¡è°ƒç”¨æ–¹æ³•åå°„å¼•ç”¨</td></tr><tr><td style=text-align:right>target</td><td>æœ¬æ¬¡è°ƒç”¨ç±»çš„å®ä¾‹</td></tr><tr><td style=text-align:right>params</td><td>æœ¬æ¬¡è°ƒç”¨å‚æ•°åˆ—è¡¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœæ–¹æ³•æ˜¯æ— å‚æ–¹æ³•åˆ™ä¸ºç©ºæ•°ç»„</td></tr><tr><td style=text-align:right>returnObj</td><td>æœ¬æ¬¡è°ƒç”¨è¿”å›çš„å¯¹è±¡ã€‚å½“ä¸”ä»…å½“ isReturn==true æˆç«‹æ—¶å€™æœ‰æ•ˆï¼Œè¡¨æ˜æ–¹æ³•è°ƒç”¨æ˜¯ä»¥æ­£å¸¸è¿”å›çš„æ–¹å¼ç»“æŸã€‚å¦‚æœå½“å‰æ–¹æ³•æ— è¿”å›å€¼ voidï¼Œåˆ™å€¼ä¸º null</td></tr><tr><td style=text-align:right>throwExp</td><td>æœ¬æ¬¡è°ƒç”¨æŠ›å‡ºçš„å¼‚å¸¸ã€‚å½“ä¸”ä»…å½“ isThrow==true æˆç«‹æ—¶æœ‰æ•ˆï¼Œè¡¨æ˜æ–¹æ³•è°ƒç”¨æ˜¯ä»¥æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼ç»“æŸã€‚</td></tr><tr><td style=text-align:right>isBefore</td><td>è¾…åŠ©åˆ¤æ–­æ ‡è®°ï¼Œå½“å‰çš„é€šçŸ¥èŠ‚ç‚¹æœ‰å¯èƒ½æ˜¯åœ¨æ–¹æ³•ä¸€å¼€å§‹å°±é€šçŸ¥ï¼Œæ­¤æ—¶ isBefore==true æˆç«‹ï¼ŒåŒæ—¶ isThrow==false å’Œ isReturn==falseï¼Œå› ä¸ºåœ¨æ–¹æ³•åˆšå¼€å§‹æ—¶ï¼Œè¿˜æ— æ³•ç¡®å®šæ–¹æ³•è°ƒç”¨å°†ä¼šå¦‚ä½•ç»“æŸã€‚</td></tr><tr><td style=text-align:right>isThrow</td><td>è¾…åŠ©åˆ¤æ–­æ ‡è®°ï¼Œå½“å‰çš„æ–¹æ³•è°ƒç”¨ä»¥æŠ›å¼‚å¸¸çš„å½¢å¼ç»“æŸã€‚</td></tr><tr><td style=text-align:right>isReturn</td><td>è¾…åŠ©åˆ¤æ–­æ ‡è®°ï¼Œå½“å‰çš„æ–¹æ³•è°ƒç”¨ä»¥æ­£å¸¸è¿”å›çš„å½¢å¼ç»“æŸã€‚</td></tr></tbody></table></div><p>æ‰€æœ‰å˜é‡éƒ½å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœåœ¨è¡¨è¾¾å¼ä¸­ç¼–å†™äº†ä¸ç¬¦åˆ OGNL è„šæœ¬è¯­æ³•æˆ–è€…å¼•å…¥äº†ä¸åœ¨è¡¨æ ¼ä¸­çš„å˜é‡ï¼Œåˆ™é€€å‡ºå‘½ä»¤çš„æ‰§è¡Œï¼›ç”¨æˆ·å¯ä»¥æ ¹æ®å½“å‰çš„å¼‚å¸¸ä¿¡æ¯ä¿®æ­£ <code>æ¡ä»¶è¡¨è¾¾å¼ </code>æˆ– <code>è§‚å¯Ÿè¡¨è¾¾å¼</code>ã€‚</p><h2 id=åŸºç¡€å‘½ä»¤>åŸºç¡€å‘½ä»¤</h2><h3 id=help>help</h3><p>æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰ arthas ç‰ˆæœ¬æ”¯æŒçš„æŒ‡ä»¤ï¼Œæˆ–è€…æŸ¥çœ‹å…·ä½“æŒ‡ä»¤çš„ä½¿ç”¨è¯´æ˜ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>ä¸æ¥å‚æ•°</td><td>æŸ¥è¯¢å½“å‰ arthas ç‰ˆæœ¬æ”¯æŒçš„æŒ‡ä»¤ä»¥åŠæŒ‡ä»¤æè¿°</td></tr><tr><td style=text-align:right>[name:]</td><td>æŸ¥è¯¢å…·ä½“æŒ‡ä»¤çš„ä½¿ç”¨è¯´æ˜</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>help</span>
</span></span><span class=line><span class=cl> NAME         DESCRIPTION
</span></span><span class=line><span class=cl> <span class=nb>help</span>         Display Arthas Help
</span></span><span class=line><span class=cl> auth         Authenticates the current session
</span></span><span class=line><span class=cl> keymap       Display all the available keymap <span class=k>for</span> the specified connection.
</span></span><span class=line><span class=cl> sc           Search all the classes loaded by JVM
</span></span><span class=line><span class=cl> sm           Search the method of classes loaded by JVM
</span></span><span class=line><span class=cl> classloader  Show classloader info
</span></span><span class=line><span class=cl> jad          Decompile class
</span></span><span class=line><span class=cl> getstatic    Show the static field of a class
</span></span><span class=line><span class=cl> monitor      Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc.
</span></span><span class=line><span class=cl> stack        Display the stack trace <span class=k>for</span> the specified class and method
</span></span><span class=line><span class=cl> thread       Display thread info, thread stack
</span></span><span class=line><span class=cl> trace        Trace the execution <span class=nb>time</span> of specified method invocation.
</span></span><span class=line><span class=cl> watch        Display the input/output parameter, <span class=k>return</span> object, and thrown exception of specified method invocation
</span></span><span class=line><span class=cl> tt           Time Tunnel
</span></span><span class=line><span class=cl> jvm          Display the target JVM information
</span></span><span class=line><span class=cl> memory       Display jvm memory info.
</span></span><span class=line><span class=cl> perfcounter  Display the perf counter information.
</span></span><span class=line><span class=cl> ognl         Execute ognl expression.
</span></span><span class=line><span class=cl> mc           Memory compiler, compiles java files into bytecode and class files in memory.
</span></span><span class=line><span class=cl> redefine     Redefine classes. @see Instrumentation#redefineClasses<span class=o>(</span>ClassDefinition...<span class=o>)</span>
</span></span><span class=line><span class=cl> retransform  Retransform classes. @see Instrumentation#retransformClasses<span class=o>(</span>Class...<span class=o>)</span>
</span></span><span class=line><span class=cl> dashboard    Overview of target jvm<span class=err>&#39;</span>s thread, memory, gc, vm, tomcat info.
</span></span><span class=line><span class=cl> dump         Dump class byte array from JVM
</span></span><span class=line><span class=cl> heapdump     Heap dump
</span></span><span class=line><span class=cl> options      View and change various Arthas options
</span></span><span class=line><span class=cl> cls          Clear the screen
</span></span><span class=line><span class=cl> reset        Reset all the enhanced classes
</span></span><span class=line><span class=cl> version      Display Arthas version
</span></span><span class=line><span class=cl> session      Display current session information
</span></span><span class=line><span class=cl> sysprop      Display and change the system properties.
</span></span><span class=line><span class=cl> sysenv       Display the system env.
</span></span><span class=line><span class=cl> vmoption     Display, and update the vm diagnostic options.
</span></span><span class=line><span class=cl> logger       Print logger info, and update the logger level
</span></span><span class=line><span class=cl> <span class=nb>history</span>      Display <span class=nb>command</span> <span class=nb>history</span>
</span></span><span class=line><span class=cl> cat          Concatenate and print files
</span></span><span class=line><span class=cl> base64       Encode and decode using Base64 representation
</span></span><span class=line><span class=cl> <span class=nb>echo</span>         write arguments to the standard output
</span></span><span class=line><span class=cl> <span class=nb>pwd</span>          Return working directory name
</span></span><span class=line><span class=cl> mbean        Display the mbean information
</span></span><span class=line><span class=cl> grep         grep <span class=nb>command</span> <span class=k>for</span> pipes.
</span></span><span class=line><span class=cl> tee          tee <span class=nb>command</span> <span class=k>for</span> pipes.
</span></span><span class=line><span class=cl> profiler     Async Profiler. https://github.com/jvm-profiling-tools/async-profiler
</span></span><span class=line><span class=cl> vmtool       jvm tool
</span></span><span class=line><span class=cl> stop         Stop/Shutdown Arthas server and <span class=nb>exit</span> the console.
</span></span><span class=line><span class=cl> jfr          Java Flight Recorder Command
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>help</span> dashboard
</span></span><span class=line><span class=cl> USAGE:
</span></span><span class=line><span class=cl>   dashboard <span class=o>[</span>-h<span class=o>]</span> <span class=o>[</span>-i &lt;value&gt;<span class=o>]</span> <span class=o>[</span>-n &lt;value&gt;<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> SUMMARY:
</span></span><span class=line><span class=cl>   Overview of target jvm<span class=err>&#39;</span>s thread, memory, gc, vm, tomcat info.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> EXAMPLES:
</span></span><span class=line><span class=cl>   dashboard
</span></span><span class=line><span class=cl>   dashboard -n <span class=m>10</span>
</span></span><span class=line><span class=cl>   dashboard -i <span class=m>2000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> WIKI:
</span></span><span class=line><span class=cl>   https://arthas.aliyun.com/doc/dashboard
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> OPTIONS:
</span></span><span class=line><span class=cl> -h, --help                              this <span class=nb>help</span>
</span></span><span class=line><span class=cl> -i, --interval &lt;value&gt;                  The interval <span class=o>(</span>in ms<span class=o>)</span> between two executions, default is <span class=m>5000</span> ms.
</span></span><span class=line><span class=cl> -n, --number-of-execution &lt;value&gt;       The number of <span class=nb>times</span> this <span class=nb>command</span> will be executed.
</span></span></code></pre></td></tr></table></div></div><h3 id=cls>cls</h3><p>æ¸…ç©ºå½“å‰å±å¹•åŒºåŸŸã€‚</p><h3 id=session>session</h3><p>æŸ¥çœ‹å½“å‰ä¼šè¯çš„ä¿¡æ¯ï¼Œæ˜¾ç¤ºå½“å‰ç»‘å®šçš„ pid ä»¥åŠä¼šè¯ idã€‚</p><blockquote><p><strong>æç¤º</strong></p><p>å¦‚æœé…ç½®äº† tunnel serverï¼Œä¼šè¿½åŠ æ‰“å° ä»£ç† idã€tunnel æœåŠ¡å™¨çš„ url ä»¥åŠè¿æ¥çŠ¶æ€ã€‚</p><p>å¦‚æœä½¿ç”¨äº† staturl åšç»Ÿè®¡ï¼Œä¼šè¿½åŠ æ˜¾ç¤º statUrl åœ°å€ã€‚</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ session
</span></span><span class=line><span class=cl> Name        Value
</span></span><span class=line><span class=cl>--------------------------------------------------
</span></span><span class=line><span class=cl> JAVA_PID    <span class=m>96956</span>
</span></span><span class=line><span class=cl> SESSION_ID  14219aff-0255-4e7d-aaa8-244061bd8277
</span></span></code></pre></td></tr></table></div></div><h3 id=reset>reset</h3><blockquote><p><strong>æç¤º</strong></p><p>é‡ç½®å¢å¼ºç±»ï¼Œå°†è¢« Arthas å¢å¼ºè¿‡çš„ç±»å…¨éƒ¨è¿˜åŸï¼ŒArthas æœåŠ¡ç«¯ stop æ—¶ä¼šé‡ç½®æ‰€æœ‰å¢å¼ºè¿‡çš„ç±»</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># è¿˜åŸæŒ‡å®šç±»</span>
</span></span><span class=line><span class=cl>reset Test
</span></span><span class=line><span class=cl><span class=c1># è¿˜åŸæ‰€æœ‰ç±»</span>
</span></span><span class=line><span class=cl>reset
</span></span></code></pre></td></tr></table></div></div><h3 id=version>version</h3><p>è¾“å‡ºå½“å‰ç›®æ ‡ Java è¿›ç¨‹æ‰€åŠ è½½çš„ Arthas ç‰ˆæœ¬å·</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ version
</span></span><span class=line><span class=cl>3.7.2
</span></span></code></pre></td></tr></table></div></div><h3 id=history>history</h3><p>æ‰“å°å‘½ä»¤å†å²ã€‚</p><blockquote><p><strong>æç¤º</strong></p><p>å†å²æŒ‡ä»¤ä¼šé€šè¿‡ä¸€ä¸ªåå« history çš„æ–‡ä»¶æŒä¹…åŒ–ï¼Œæ‰€ä»¥ history æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ arthas æœåŠ¡å™¨çš„æ‰€æœ‰å†å²å‘½ä»¤ï¼Œè€Œä¸ä»…åªæ˜¯å½“å‰æ¬¡ä¼šè¯ä½¿ç”¨è¿‡çš„å‘½ä»¤ã€‚</p></blockquote><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>[c:]</td><td>æ¸…ç©ºå†å²æŒ‡ä»¤</td></tr><tr><td style=text-align:right>[n:]</td><td>æ˜¾ç¤ºæœ€è¿‘æ‰§è¡Œçš„ n æ¡æŒ‡ä»¤</td></tr></tbody></table></div><h3 id=quit-stop>quit-stop</h3><p>é€€å‡ºå½“å‰ Arthas å®¢æˆ·ç«¯ï¼Œå…¶ä»– Arthas å®¢æˆ·ç«¯ä¸å—å½±å“ã€‚ç­‰åŒäº exitã€logoutã€q ä¸‰ä¸ªæŒ‡ä»¤ã€‚</p><blockquote><p><strong>æç¤º</strong></p><p>åªæ˜¯é€€å‡ºå½“å‰ Arthas å®¢æˆ·ç«¯ï¼ŒArthas çš„æœåŠ¡å™¨ç«¯å¹¶æ²¡æœ‰å…³é—­ï¼Œæ‰€åšçš„ä¿®æ”¹ä¹Ÿä¸ä¼šè¢«é‡ç½®ã€‚</p></blockquote><h3 id=keymap>keymap</h3><p><code>keymap</code> å‘½ä»¤è¾“å‡ºå½“å‰çš„å¿«æ·é”®æ˜ å°„è¡¨ï¼š</p><div class=table-wrapper><table><thead><tr><th>å¿«æ·é”®</th><th>å¿«æ·é”®è¯´æ˜</th><th>å‘½ä»¤åç§°</th><th>å‘½ä»¤è¯´æ˜</th></tr></thead><tbody><tr><td>&ldquo;\C-a&rdquo;</td><td>ctrl + a</td><td>beginning-of-line</td><td>è·³åˆ°è¡Œé¦–</td></tr><tr><td>&ldquo;\C-e&rdquo;</td><td>ctrl + e</td><td>end-of-line</td><td>è·³åˆ°è¡Œå°¾</td></tr><tr><td>&ldquo;\C-f&rdquo;</td><td>ctrl + f</td><td>forward-word</td><td>å‘å‰ç§»åŠ¨ä¸€ä¸ªå•è¯</td></tr><tr><td>&ldquo;\C-b&rdquo;</td><td>ctrl + b</td><td>backward-word</td><td>å‘åç§»åŠ¨ä¸€ä¸ªå•è¯</td></tr><tr><td>&ldquo;\e[D&rdquo;</td><td>é”®ç›˜å·¦æ–¹å‘é”®</td><td>backward-char</td><td>å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>&ldquo;\e[C&rdquo;</td><td>é”®ç›˜å³æ–¹å‘é”®</td><td>forward-char</td><td>å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>&ldquo;\e[B&rdquo;</td><td>é”®ç›˜ä¸‹æ–¹å‘é”®</td><td>next-history</td><td>ä¸‹ç¿»æ˜¾ç¤ºä¸‹ä¸€ä¸ªå‘½ä»¤</td></tr><tr><td>&ldquo;\e[A&rdquo;</td><td>é”®ç›˜ä¸Šæ–¹å‘é”®</td><td>previous-history</td><td>ä¸Šç¿»æ˜¾ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤</td></tr><tr><td>&ldquo;\C-h&rdquo;</td><td>ctrl + h</td><td>backward-delete-char</td><td>å‘ååˆ é™¤ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>&ldquo;\C-?&rdquo;</td><td>ctrl + shift + /</td><td>backward-delete-char</td><td>å‘ååˆ é™¤ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>&ldquo;\C-u&rdquo;</td><td>ctrl + u</td><td>undo</td><td>æ’¤é”€ä¸Šä¸€ä¸ªå‘½ä»¤ï¼Œç›¸å½“äºæ¸…ç©ºå½“å‰è¡Œ</td></tr><tr><td>&ldquo;\C-d&rdquo;</td><td>ctrl + d</td><td>delete-char</td><td>åˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨å­—ç¬¦</td></tr><tr><td>&ldquo;\C-k&rdquo;</td><td>ctrl + k</td><td>kill-line</td><td>åˆ é™¤å½“å‰å…‰æ ‡åˆ°è¡Œå°¾çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td>&ldquo;\C-i&rdquo;</td><td>ctrl + i</td><td>complete</td><td>è‡ªåŠ¨è¡¥å…¨ï¼Œç›¸å½“äºæ•² TAB</td></tr><tr><td>&ldquo;\C-j&rdquo;</td><td>ctrl + j</td><td>accept-line</td><td>ç»“æŸå½“å‰è¡Œï¼Œç›¸å½“äºæ•²å›è½¦</td></tr><tr><td>&ldquo;\C-m&rdquo;</td><td>ctrl + m</td><td>accept-line</td><td>ç»“æŸå½“å‰è¡Œï¼Œç›¸å½“äºæ•²å›è½¦</td></tr><tr><td>&ldquo;\C-w&rdquo;</td><td>-</td><td>backward-delete-word</td><td>-</td></tr><tr><td>&ldquo;\C-x\e[3~&rdquo;</td><td>-</td><td>backward-kill-line</td><td>-</td></tr><tr><td>&ldquo;\e\C-?&rdquo;</td><td>-</td><td>backward-kill-word</td><td>-</td></tr></tbody></table></div><ul><li>ä»»ä½•æ—¶å€™ tab é”®ï¼Œä¼šæ ¹æ®å½“å‰çš„è¾“å…¥ç»™å‡ºæç¤º</li><li>å‘½ä»¤åæ•² - æˆ– &ndash; ï¼Œç„¶åæŒ‰ tab é”®ï¼Œå¯ä»¥å±•ç¤ºå‡ºæ­¤å‘½ä»¤å…·ä½“çš„é€‰é¡¹</li></ul><h4 id=è‡ªå®šä¹‰å¿«æ·é”®>è‡ªå®šä¹‰å¿«æ·é”®</h4><p>åœ¨å½“å‰ç”¨æˆ·ç›®å½•ä¸‹æ–°å»º <code>$USER_HOME/.arthas/conf/inputrc</code> æ–‡ä»¶ï¼ŒåŠ å…¥è‡ªå®šä¹‰é…ç½®ã€‚</p><h4 id=åå°å¼‚æ­¥å‘½ä»¤ç›¸å…³å¿«æ·é”®>åå°å¼‚æ­¥å‘½ä»¤ç›¸å…³å¿«æ·é”®</h4><p>ctrl + c: ç»ˆæ­¢å½“å‰å‘½ä»¤
ctrl + z: æŒ‚èµ·å½“å‰å‘½ä»¤ï¼Œåç»­å¯ä»¥ bg/fg é‡æ–°æ”¯æŒæ­¤å‘½ä»¤ï¼Œæˆ– kill æ‰
ctrl + a: å›åˆ°è¡Œé¦–
ctrl + e: å›åˆ°è¡Œå°¾</p><h3 id=cat>cat</h3><blockquote><p><strong>æç¤º</strong></p><p>æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œå’Œ linux é‡Œçš„ cat å‘½ä»¤ç±»ä¼¼ã€‚</p></blockquote><h3 id=echo>echo</h3><blockquote><p><strong>æç¤º</strong></p><p>æ‰“å°å‚æ•°ï¼Œå’Œ linux é‡Œçš„ echo å‘½ä»¤ç±»ä¼¼ã€‚</p></blockquote><h3 id=grep>grep</h3><blockquote><p><strong>æç¤º</strong></p><p>ç±»ä¼¼ä¼ ç»Ÿçš„ grep å‘½ä»¤ã€‚</p></blockquote><h3 id=tee>tee</h3><blockquote><p><strong>æç¤º</strong></p><p>ç±»ä¼¼ä¼ ç»Ÿçš„ tee å‘½ä»¤, ç”¨äºè¯»å–æ ‡å‡†è¾“å…¥çš„æ•°æ®ï¼Œå¹¶å°†å…¶å†…å®¹è¾“å‡ºæˆæ–‡ä»¶ã€‚</p><p>tee æŒ‡ä»¤ä¼šä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å–æ•°æ®ï¼Œå°†å…¶å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ï¼ŒåŒæ—¶ä¿å­˜æˆæ–‡ä»¶ã€‚</p></blockquote><h3 id=pwd>pwd</h3><blockquote><p><strong>æç¤º</strong></p><p>è¿”å›å½“å‰çš„å·¥ä½œç›®å½•ï¼Œå’Œ linux å‘½ä»¤ç±»ä¼¼</p></blockquote><h3 id=plaintext>plaintext</h3><h3 id=wc>wc</h3><h3 id=options>options</h3><blockquote><p><strong>æç¤º</strong></p><p>å…¨å±€å¼€å…³</p></blockquote><div class=table-wrapper><table><thead><tr><th>åç§°</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>unsafe</td><td>false</td><td>æ˜¯å¦æ”¯æŒå¯¹ç³»ç»Ÿçº§åˆ«çš„ç±»è¿›è¡Œå¢å¼ºï¼Œæ‰“å¼€è¯¥å¼€å…³å¯èƒ½å¯¼è‡´æŠŠ JVM ææŒ‚ï¼Œè¯·æ…é‡é€‰æ‹©ï¼</td></tr><tr><td>dump</td><td>false</td><td>æ˜¯å¦æ”¯æŒè¢«å¢å¼ºäº†çš„ç±» dump åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ‰“å¼€å¼€å…³ï¼Œclass æ–‡ä»¶ä¼šè¢« dump åˆ°/${application working dir}/arthas-class-dump/ç›®å½•ä¸‹ï¼Œå…·ä½“ä½ç½®è¯¦è§æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>batch-re-transform</td><td>true</td><td>æ˜¯å¦æ”¯æŒæ‰¹é‡å¯¹åŒ¹é…åˆ°çš„ç±»æ‰§è¡Œ retransform æ“ä½œ</td></tr><tr><td>json-format</td><td>false</td><td>æ˜¯å¦æ”¯æŒ json åŒ–çš„è¾“å‡º</td></tr><tr><td>disable-sub-class</td><td>false</td><td>æ˜¯å¦ç¦ç”¨å­ç±»åŒ¹é…ï¼Œé»˜è®¤åœ¨åŒ¹é…ç›®æ ‡ç±»çš„æ—¶å€™ä¼šé»˜è®¤åŒ¹é…åˆ°å…¶å­ç±»ï¼Œå¦‚æœæƒ³ç²¾ç¡®åŒ¹é…ï¼Œå¯ä»¥å…³é—­æ­¤å¼€å…³</td></tr><tr><td>support-default-method</td><td>true</td><td>æ˜¯å¦æ”¯æŒåŒ¹é…åˆ° default methodï¼Œ é»˜è®¤ä¼šæŸ¥æ‰¾ interfaceï¼ŒåŒ¹é…é‡Œé¢çš„ default methodã€‚å‚è€ƒ #1105 åœ¨æ–°çª—å£æ‰“å¼€</td></tr><tr><td>save-result</td><td>false</td><td>æ˜¯å¦æ‰“å¼€æ‰§è¡Œç»“æœå­˜æ—¥å¿—åŠŸèƒ½ï¼Œæ‰“å¼€ä¹‹åæ‰€æœ‰å‘½ä»¤çš„è¿è¡Œç»“æœéƒ½å°†ä¿å­˜åˆ°~/logs/arthas-cache/result.log ä¸­</td></tr><tr><td>job-timeout</td><td>1d</td><td>å¼‚æ­¥åå°ä»»åŠ¡çš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œä»»åŠ¡è‡ªåŠ¨åœæ­¢ï¼›æ¯”å¦‚è®¾ç½® 1d, 2h, 3m, 25sï¼Œåˆ†åˆ«ä»£è¡¨å¤©ã€å°æ—¶ã€åˆ†ã€ç§’</td></tr><tr><td>print-parent-fields</td><td>true</td><td>æ˜¯å¦æ‰“å°åœ¨ parent class é‡Œçš„ filed</td></tr><tr><td>verbose</td><td>false</td><td>æ˜¯å¦æ‰“å°æ›´å¤šè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>strict</td><td>true</td><td>æ˜¯å¦å¯ç”¨ strict æ¨¡å¼</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æ‰€æœ‰çš„ options</span>
</span></span><span class=line><span class=cl>options
</span></span><span class=line><span class=cl><span class=c1># è·å– option çš„å€¼</span>
</span></span><span class=line><span class=cl>options json-format
</span></span><span class=line><span class=cl><span class=c1># è®¾ç½®æŒ‡å®šçš„ option</span>
</span></span><span class=line><span class=cl>options save-result <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>æç¤º</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ <code>json-format</code> ä¸º falseï¼Œå¦‚æœå¸Œæœ› <code>watch</code>/<code>tt</code> ç­‰å‘½ä»¤ç»“æœä»¥ json æ ¼å¼è¾“å‡ºï¼Œåˆ™å¯ä»¥è®¾ç½® <code>json-format</code> ä¸º trueã€‚</p></blockquote><h4 id=æ‰“å¼€-unsafe-å¼€å…³æ”¯æŒ-jdk-package-ä¸‹çš„ç±»>æ‰“å¼€ unsafe å¼€å…³ï¼Œæ”¯æŒ jdk package ä¸‹çš„ç±»</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>watch</code>/<code>trace</code>/<code>tt</code>/<code>trace</code>/<code>monitor</code> ç­‰å‘½ä»¤ä¸æ”¯æŒ <code>java.\*</code> package ä¸‹çš„ç±»ã€‚å¯ä»¥è®¾ç½® <code>unsafe</code> ä¸º trueï¼Œåˆ™å¯ä»¥å¢å¼ºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>options unsafe <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=å…³é—­-strict-æ¨¡å¼å…è®¸åœ¨-ognl-è¡¨è¾¾å¼é‡Œè®¾ç½®å¯¹è±¡å±æ€§>å…³é—­ strict æ¨¡å¼ï¼Œå…è®¸åœ¨ ognl è¡¨è¾¾å¼é‡Œè®¾ç½®å¯¹è±¡å±æ€§</h4><blockquote><p><strong>æç¤º</strong></p><p>since 3.6.0</p></blockquote><p>å¯¹äºæ–°ç”¨æˆ·ï¼Œåœ¨ç¼–å†™ ognl è¡¨è¾¾å¼æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¯¯ç”¨ã€‚</p><p>æ¯”å¦‚å¯¹äº <code>Student</code>ï¼Œåˆ¤æ–­å¹´é¾„ç­‰äº 18 æ—¶ï¼Œå¯èƒ½æ¡ä»¶è¡¨è¾¾å¼ä¼šè¯¯å†™ä¸º <code>target.age=18</code>ï¼Œè¿™ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šæ˜¯æŠŠå½“å‰å¯¹è±¡çš„ <code>age</code> è®¾ç½®ä¸º 18 äº†ã€‚æ­£ç¡®çš„å†™æ³•æ˜¯ <code>target.age==18</code>ã€‚</p><p>ä¸ºäº†é˜²æ­¢å‡ºç°ç±»ä¼¼ä¸Šé¢çš„è¯¯ç”¨ï¼ŒArthas é»˜è®¤å¯ç”¨ <code>strict</code> æ¨¡å¼ï¼Œåœ¨ <code>ognl</code> è¡¨è¾¾å¼é‡Œï¼Œç¦æ­¢æ›´æ–°å¯¹è±¡çš„ Property æˆ–è€…è°ƒç”¨ <code>setter</code> å‡½æ•°ã€‚</p><p>ä»¥ <code>MathGame</code> ä¸ºä¾‹ï¼Œä¼šå‡ºç°ä»¥ä¸‹çš„é”™è¯¯æç¤ºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s1>&#39;target&#39;</span> <span class=s1>&#39;target.illegalArgumentCount=1&#39;</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>20</span> ms, listenerId: <span class=m>6</span>
</span></span><span class=line><span class=cl>watch failed, condition is: target.illegalArgumentCount<span class=o>=</span>1, express is: target, By default, strict mode is true, not allowed to <span class=nb>set</span> object properties. Want to <span class=nb>set</span> object properties, execute <span class=sb>`</span>options strict <span class=nb>false</span><span class=sb>`</span>, visit /Users/lucaschen/logs/arthas/arthas.log <span class=k>for</span> more details.
</span></span></code></pre></td></tr></table></div></div><p>ç”¨æˆ·å¦‚æœç¡®å®šè¦åœ¨ <code>ognl</code> è¡¨è¾¾å¼é‡Œæ›´æ–°å¯¹è±¡ï¼Œå¯ä»¥æ‰§è¡Œ <code>options strict false</code>ï¼Œå…³é—­ strict æ¨¡å¼ã€‚</p><h2 id=ç³»ç»Ÿå‘½ä»¤>ç³»ç»Ÿå‘½ä»¤</h2><h3 id=dashboard>dashboard</h3><blockquote><p><strong>æç¤º</strong></p></blockquote><p>å½“å‰ç³»ç»Ÿçš„å®æ—¶æ•°æ®é¢æ¿ï¼ŒæŒ‰ ctrl+c é€€å‡ºã€‚</p><p>å½“è¿è¡Œåœ¨ Ali-tomcat æ—¶ï¼Œä¼šæ˜¾ç¤ºå½“å‰ tomcat çš„å®æ—¶ä¿¡æ¯ï¼Œå¦‚ HTTP è¯·æ±‚çš„ qps, rt, é”™è¯¯æ•°, çº¿ç¨‹æ± ä¿¡æ¯ç­‰ç­‰ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>[i:]</td><td>åˆ·æ–°å®æ—¶æ•°æ®çš„æ—¶é—´é—´éš” (ms)ï¼Œé»˜è®¤ 5000ms</td></tr><tr><td style=text-align:right>[n:]</td><td>åˆ·æ–°å®æ—¶æ•°æ®çš„æ¬¡æ•°</td></tr></tbody></table></div><p><img src=/post/arthas/dashboard.png width=1209 height=920 srcset="/post/arthas/dashboard_hu_bb153b684e218245.png 480w, /post/arthas/dashboard_hu_612f3b3392d45954.png 1024w" loading=lazy alt=dashboard class=gallery-image data-flex-grow=131 data-flex-basis=315px></p><h4 id=æ•°æ®è¯´æ˜>æ•°æ®è¯´æ˜</h4><ul><li>ID: Java çº§åˆ«çš„çº¿ç¨‹ IDï¼Œæ³¨æ„è¿™ä¸ª ID ä¸èƒ½è·Ÿ jstack ä¸­çš„ nativeID ä¸€ä¸€å¯¹åº”ã€‚</li><li>NAME: çº¿ç¨‹å</li><li>GROUP: çº¿ç¨‹ç»„å</li><li>PRIORITY: çº¿ç¨‹ä¼˜å…ˆçº§, 1~10 ä¹‹é—´çš„æ•°å­—ï¼Œè¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜</li><li>STATE: çº¿ç¨‹çš„çŠ¶æ€</li><li>CPU%: çº¿ç¨‹çš„ cpu ä½¿ç”¨ç‡ã€‚æ¯”å¦‚é‡‡æ ·é—´éš” 1000msï¼ŒæŸä¸ªçº¿ç¨‹çš„å¢é‡ cpu æ—¶é—´ä¸º 100msï¼Œåˆ™ cpu ä½¿ç”¨ç‡=100/1000=10%</li><li>DELTA_TIME: ä¸Šæ¬¡é‡‡æ ·ä¹‹åçº¿ç¨‹è¿è¡Œå¢é‡ CPU æ—¶é—´ï¼Œæ•°æ®æ ¼å¼ä¸º<code>ç§’</code></li><li>TIME: çº¿ç¨‹è¿è¡Œæ€» CPU æ—¶é—´ï¼Œæ•°æ®æ ¼å¼ä¸º<code>åˆ†:ç§’</code></li><li>INTERRUPTED: çº¿ç¨‹å½“å‰çš„ä¸­æ–­ä½çŠ¶æ€</li><li>DAEMON: æ˜¯å¦æ˜¯ daemon çº¿ç¨‹</li></ul><h4 id=jvm-å†…éƒ¨çº¿ç¨‹>JVM å†…éƒ¨çº¿ç¨‹</h4><p>Java 8 ä¹‹åæ”¯æŒè·å– JVM å†…éƒ¨çº¿ç¨‹ CPU æ—¶é—´ï¼Œè¿™äº›çº¿ç¨‹åªæœ‰åç§°å’Œ CPU æ—¶é—´ï¼Œæ²¡æœ‰ ID åŠçŠ¶æ€ç­‰ä¿¡æ¯ï¼ˆæ˜¾ç¤º ID ä¸º-1ï¼‰ã€‚ é€šè¿‡å†…éƒ¨çº¿ç¨‹å¯ä»¥è§‚æµ‹åˆ° JVM æ´»åŠ¨ï¼Œå¦‚ GCã€JIT ç¼–è¯‘ç­‰å ç”¨ CPU æƒ…å†µï¼Œæ–¹ä¾¿äº†è§£ JVM æ•´ä½“è¿è¡ŒçŠ¶å†µã€‚</p><ul><li>å½“ JVM å †(heap)/å…ƒæ•°æ®(metaspace)ç©ºé—´ä¸è¶³æˆ– OOM æ—¶ï¼Œå¯ä»¥çœ‹åˆ° GC çº¿ç¨‹çš„ CPU å ç”¨ç‡æ˜æ˜¾é«˜äºå…¶ä»–çš„çº¿ç¨‹ã€‚</li><li>å½“æ‰§è¡Œ <code>trace/watch/tt/redefine</code> ç­‰å‘½ä»¤åï¼Œå¯ä»¥çœ‹åˆ° JIT çº¿ç¨‹æ´»åŠ¨å˜å¾—æ›´é¢‘ç¹ã€‚å› ä¸º JVM çƒ­æ›´æ–° class å­—èŠ‚ç æ—¶æ¸…é™¤äº†æ­¤ class ç›¸å…³çš„ JIT ç¼–è¯‘ç»“æœï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ã€‚</li></ul><p>JVM å†…éƒ¨çº¿ç¨‹åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</p><ul><li>JIT ç¼–è¯‘çº¿ç¨‹: å¦‚ <code>C1 CompilerThread0</code>, <code>C2 CompilerThread0</code></li><li>GC çº¿ç¨‹: å¦‚ <code>GC Thread0</code>, <code>G1 Young RemSet Sampling</code></li><li>å…¶å®ƒå†…éƒ¨çº¿ç¨‹: å¦‚ <code>VM Periodic Task Thread</code>, <code>VM Thread</code>, <code>Service Thread</code></li></ul><h3 id=thread>thread</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹å½“å‰çº¿ç¨‹ä¿¡æ¯ï¼ŒæŸ¥çœ‹çº¿ç¨‹çš„å †æ ˆ</p></blockquote><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>id</td><td>çº¿ç¨‹ id</td></tr><tr><td style=text-align:right>[n:]</td><td>æŒ‡å®šæœ€å¿™çš„å‰ N ä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ</td></tr><tr><td style=text-align:right>[b]</td><td>æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹</td></tr><tr><td style=text-align:right>[i &lt;value>]</td><td>æŒ‡å®š cpu ä½¿ç”¨ç‡ç»Ÿè®¡çš„é‡‡æ ·é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤å€¼ä¸º 200</td></tr><tr><td style=text-align:right>[&ndash;all]</td><td>æ˜¾ç¤ºæ‰€æœ‰åŒ¹é…çš„çº¿ç¨‹</td></tr></tbody></table></div><p>è¿™é‡Œçš„ cpu ä½¿ç”¨ç‡ä¸ linux å‘½ä»¤ <code>top -H -p &lt;pid></code> çš„çº¿ç¨‹ <code>%CPU</code> ç±»ä¼¼ï¼Œä¸€æ®µé‡‡æ ·é—´éš”æ—¶é—´å†…ï¼Œå½“å‰ JVM é‡Œå„ä¸ªçº¿ç¨‹çš„å¢é‡ cpu æ—¶é—´ä¸é‡‡æ ·é—´éš”æ—¶é—´çš„æ¯”ä¾‹ã€‚</p><p>å·¥ä½œåŸç†è¯´æ˜ï¼š</p><ul><li>é¦–å…ˆç¬¬ä¸€æ¬¡é‡‡æ ·ï¼Œè·å–æ‰€æœ‰çº¿ç¨‹çš„ CPU æ—¶é—´(è°ƒç”¨çš„æ˜¯ <code>java.lang.management.ThreadMXBean#getThreadCpuTime()</code> åŠ <code>sun.management.HotspotThreadMBean.getInternalThreadCpuTimes()</code> æ¥å£)</li><li>ç„¶åç¡çœ ç­‰å¾…ä¸€ä¸ªé—´éš”æ—¶é—´ï¼ˆé»˜è®¤ä¸º 200msï¼Œå¯ä»¥é€šè¿‡ <code>-i</code> æŒ‡å®šé—´éš”æ—¶é—´ï¼‰</li><li>å†æ¬¡ç¬¬äºŒæ¬¡é‡‡æ ·ï¼Œè·å–æ‰€æœ‰çº¿ç¨‹çš„ CPU æ—¶é—´ï¼Œå¯¹æ¯”ä¸¤æ¬¡é‡‡æ ·æ•°æ®ï¼Œè®¡ç®—å‡ºæ¯ä¸ªçº¿ç¨‹çš„å¢é‡ CPU æ—¶é—´</li><li>çº¿ç¨‹ CPU ä½¿ç”¨ç‡ = çº¿ç¨‹å¢é‡ CPU æ—¶é—´ / é‡‡æ ·é—´éš”æ—¶é—´ * 100%</li></ul><blockquote><p><strong>æ³¨æ„</strong></p><p>æ³¨æ„ï¼š è¿™ä¸ªç»Ÿè®¡ä¹Ÿä¼šäº§ç”Ÿä¸€å®šçš„å¼€é”€ï¼ˆJDK è¿™ä¸ªæ¥å£æœ¬èº«å¼€é”€æ¯”è¾ƒå¤§ï¼‰ï¼Œå› æ­¤ä¼šçœ‹åˆ° as çš„çº¿ç¨‹å ç”¨ä¸€å®šçš„ç™¾åˆ†æ¯”ï¼Œä¸ºäº†é™ä½ç»Ÿè®¡è‡ªèº«çš„å¼€é”€å¸¦æ¥çš„å½±å“ï¼Œå¯ä»¥æŠŠé‡‡æ ·é—´éš”æ‹‰é•¿ä¸€äº›ï¼Œæ¯”å¦‚ 5000 æ¯«ç§’ã€‚</p><p><strong>æç¤º</strong></p><p>å¦å¤–ä¸€ç§æŸ¥çœ‹ Java è¿›ç¨‹çš„çº¿ç¨‹ cpu ä½¿ç”¨ç‡æ–¹æ³•ï¼šå¯ä»¥ä½¿ç”¨ show-busy-java-threads è¿™ä¸ªè„šæœ¬</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># ä¸€é”®å±•ç¤ºå½“å‰æœ€å¿™çš„å‰ N ä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ</span>
</span></span><span class=line><span class=cl>thread -n <span class=m>3</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>æ²¡æœ‰çº¿ç¨‹ IDï¼ŒåŒ…å« <code>[Internal]</code>è¡¨ç¤ºä¸º JVM å†…éƒ¨çº¿ç¨‹ï¼Œå‚è€ƒ <a class=link href=#dashboard>dashboard</a> å‘½ä»¤çš„ä»‹ç»ã€‚</li><li><code>cpuUsage</code> ä¸ºé‡‡æ ·é—´éš”æ—¶é—´å†…çº¿ç¨‹çš„ CPU ä½¿ç”¨ç‡ï¼Œä¸ <a class=link href=#dashboard>dashboard</a> å‘½ä»¤çš„æ•°æ®ä¸€è‡´ã€‚</li><li><code>deltaTime</code> ä¸ºé‡‡æ ·é—´éš”æ—¶é—´å†…çº¿ç¨‹çš„å¢é‡ CPU æ—¶é—´ï¼Œå°äº 1ms æ—¶è¢«å–æ•´æ˜¾ç¤ºä¸º 0msã€‚</li><li><code>time</code> çº¿ç¨‹è¿è¡Œæ€» CPU æ—¶é—´ã€‚</li></ul><p>æ³¨æ„ï¼šçº¿ç¨‹æ ˆä¸ºç¬¬äºŒé‡‡æ ·ç»“æŸæ—¶è·å–ï¼Œä¸èƒ½è¡¨æ˜é‡‡æ ·é—´éš”æ—¶é—´å†…è¯¥çº¿ç¨‹éƒ½æ˜¯åœ¨å¤„ç†ç›¸åŒçš„ä»»åŠ¡ã€‚å»ºè®®é—´éš”æ—¶é—´ä¸è¦å¤ªé•¿ï¼Œå¯èƒ½é—´éš”æ—¶é—´è¶Šå¤§è¶Šä¸å‡†ç¡®ã€‚ å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µå°è¯•æŒ‡å®šä¸åŒçš„é—´éš”æ—¶é—´ï¼Œè§‚å¯Ÿè¾“å‡ºç»“æœã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># å½“æ²¡æœ‰å‚æ•°æ—¶ï¼Œæ˜¾ç¤ºç¬¬ä¸€é¡µçº¿ç¨‹çš„ä¿¡æ¯</span>
</span></span><span class=line><span class=cl><span class=c1># é»˜è®¤æŒ‰ç…§ CPU å¢é‡æ—¶é—´é™åºæ’åˆ—ï¼Œåªæ˜¾ç¤ºç¬¬ä¸€é¡µæ•°æ®ã€‚</span>
</span></span><span class=line><span class=cl>thread
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ˜¾ç¤ºæ‰€æœ‰åŒ¹é…çº¿ç¨‹ä¿¡æ¯ï¼Œæœ‰æ—¶éœ€è¦è·å–å…¨éƒ¨ JVM çš„çº¿ç¨‹æ•°æ®è¿›è¡Œåˆ†æã€‚</span>
</span></span><span class=line><span class=cl>thread --all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># thread id, æ˜¾ç¤ºæŒ‡å®šçº¿ç¨‹çš„è¿è¡Œå †æ ˆ</span>
</span></span><span class=line><span class=cl>thread <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># thread -b, æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹</span>
</span></span><span class=line><span class=cl><span class=c1># æœ‰æ—¶å€™æˆ‘ä»¬å‘ç°åº”ç”¨å¡ä½äº†ï¼Œ é€šå¸¸æ˜¯ç”±äºæŸä¸ªçº¿ç¨‹æ‹¿ä½äº†æŸä¸ªé”ï¼Œ å¹¶ä¸”å…¶ä»–çº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™æŠŠé”é€ æˆçš„ã€‚ ä¸ºäº†æ’æŸ¥è¿™ç±»é—®é¢˜ï¼Œ arthas æä¾›äº† thread -bï¼Œ ä¸€é”®æ‰¾å‡ºé‚£ä¸ªç½ªé­ç¥¸é¦–</span>
</span></span><span class=line><span class=cl><span class=c1># **æ³¨æ„**</span>
</span></span><span class=line><span class=cl><span class=c1># æ³¨æ„ï¼Œ ç›®å‰åªæ”¯æŒæ‰¾å‡º synchronized å…³é”®å­—é˜»å¡ä½çš„çº¿ç¨‹ï¼Œ å¦‚æœæ˜¯java.util.concurrent.Lockï¼Œ ç›®å‰è¿˜ä¸æ”¯æŒ</span>
</span></span><span class=line><span class=cl>thread -b
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># thread -i, æŒ‡å®šé‡‡æ ·æ—¶é—´é—´éš”</span>
</span></span><span class=line><span class=cl><span class=c1># ç»Ÿè®¡æœ€è¿‘ 1000ms å†…çš„çº¿ç¨‹ CPU æ—¶é—´</span>
</span></span><span class=line><span class=cl>thread -i <span class=m>1000</span>
</span></span><span class=line><span class=cl><span class=c1># åˆ—å‡º 1000ms å†…æœ€å¿™çš„ 3 ä¸ªçº¿ç¨‹æ ˆ</span>
</span></span><span class=line><span class=cl>thread -n <span class=m>3</span> -i <span class=m>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># thread --state ï¼ŒæŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„çº¿ç¨‹</span>
</span></span><span class=line><span class=cl><span class=c1># NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED</span>
</span></span><span class=line><span class=cl>thread --state WAITING
</span></span></code></pre></td></tr></table></div></div><h3 id=jvm>jvm</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹å½“å‰ JVM ä¿¡æ¯</p></blockquote><p>THREAD ç›¸å…³:</p><ul><li>COUNT: JVM å½“å‰æ´»è·ƒçš„çº¿ç¨‹æ•°</li><li>DAEMON-COUNT: JVM å½“å‰æ´»è·ƒçš„å®ˆæŠ¤çº¿ç¨‹æ•°</li><li>PEAK-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ›¾ç»æ´»ç€çš„æœ€å¤§çº¿ç¨‹æ•°</li><li>STARTED-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ€»å…±å¯åŠ¨è¿‡çš„çº¿ç¨‹æ¬¡æ•°</li><li>DEADLOCK-COUNT: JVM å½“å‰æ­»é”çš„çº¿ç¨‹æ•°</li></ul><p>æ–‡ä»¶æè¿°ç¬¦ç›¸å…³:</p><ul><li>MAX-FILE-DESCRIPTOR-COUNTï¼šJVM è¿›ç¨‹æœ€å¤§å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</li><li>OPEN-FILE-DESCRIPTOR-COUNTï¼šJVM å½“å‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</li></ul><h3 id=sysprop>sysprop</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§(System Property)</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æ‰€æœ‰å±æ€§</span>
</span></span><span class=line><span class=cl>sysprop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹å•ä¸ªå±æ€§, æ”¯æŒé€šè¿‡TABé”®è‡ªåŠ¨è¡¥å…¨</span>
</span></span><span class=line><span class=cl>sysprop java.version
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹å•ä¸ªå±æ€§</span>
</span></span><span class=line><span class=cl>sysprop user.country CN
</span></span></code></pre></td></tr></table></div></div><h3 id=sysenv>sysenv</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹å½“å‰ JVM çš„ç¯å¢ƒå±æ€§(System Environment Variables)</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡</span>
</span></span><span class=line><span class=cl>sysenv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹å•ä¸ªç¯å¢ƒå˜é‡, æ”¯æŒé€šè¿‡TABé”®è‡ªåŠ¨è¡¥å…¨</span>
</span></span><span class=line><span class=cl>sysenv java.version
</span></span></code></pre></td></tr></table></div></div><h3 id=vmoption>vmoption</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹ï¼Œæ›´æ–° VM è¯Šæ–­ç›¸å…³çš„å‚æ•°</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æ‰€æœ‰çš„ option</span>
</span></span><span class=line><span class=cl>vmoption
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æŒ‡å®šçš„ option</span>
</span></span><span class=line><span class=cl>vmoption PrintGC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ›´æ–°æŒ‡å®šçš„ option</span>
</span></span><span class=line><span class=cl>vmoption PrintGCDetails <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=vmtool>vmtool</h3><blockquote><p><strong>æç¤º</strong></p><p>@since 3.5.1</p></blockquote><p><code>vmtool</code> åˆ©ç”¨ <code>JVMTI</code> æ¥å£ï¼Œå®ç°æŸ¥è¯¢å†…å­˜å¯¹è±¡ï¼Œå¼ºåˆ¶ GC ç­‰åŠŸèƒ½ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># è·å–å¯¹è±¡</span>
</span></span><span class=line><span class=cl><span class=c1># é€šè¿‡ --limitå‚æ•°ï¼Œå¯ä»¥é™åˆ¶è¿”å›å€¼æ•°é‡ï¼Œé¿å…è·å–è¶…å¤§æ•°æ®æ—¶å¯¹ JVM é€ æˆå‹åŠ›ã€‚é»˜è®¤å€¼æ˜¯ 10ã€‚</span>
</span></span><span class=line><span class=cl>vmtool --action getInstances --className java.lang.String --limit <span class=m>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‡å®š classloader name</span>
</span></span><span class=line><span class=cl>vmtool --action getInstances --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader --className org.springframework.context.ApplicationContext
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‡å®š classloader hash</span>
</span></span><span class=line><span class=cl><span class=c1>#å¯ä»¥é€šè¿‡scå‘½ä»¤æŸ¥æ‰¾åˆ°åŠ è½½ class çš„ classloaderã€‚</span>
</span></span><span class=line><span class=cl>sc -d org.springframework.context.ApplicationContext
</span></span><span class=line><span class=cl> class-info        org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext
</span></span><span class=line><span class=cl> code-source       file:/private/tmp/demo-arthas-spring-boot.jar!/BOOT-INF/lib/spring-boot-1.5.13.RELEASE.jar!/
</span></span><span class=line><span class=cl> name              org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl> class-loader      +-org.springframework.boot.loader.LaunchedURLClassLoader@19469ea2
</span></span><span class=line><span class=cl>                     +-sun.misc.Launcher<span class=nv>$AppClassLoader</span>@75b84c92
</span></span><span class=line><span class=cl>                       +-sun.misc.Launcher<span class=nv>$ExtClassLoader</span>@4f023edb
</span></span><span class=line><span class=cl> classLoaderHash   19469ea2
</span></span><span class=line><span class=cl><span class=c1># ç„¶åç”¨-c/--classloader å‚æ•°æŒ‡å®šï¼š</span>
</span></span><span class=line><span class=cl>vmtool --action getInstances -c 19469ea2 --className org.springframework.context.ApplicationContext
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‡å®šè¿”å›ç»“æœå±•å¼€å±‚æ•°</span>
</span></span><span class=line><span class=cl><span class=c1># getInstances action è¿”å›ç»“æœç»‘å®šåˆ°instanceså˜é‡ä¸Šï¼Œå®ƒæ˜¯æ•°ç»„ã€‚</span>
</span></span><span class=line><span class=cl><span class=c1># é€šè¿‡ -x/--expand å‚æ•°å¯ä»¥æŒ‡å®šç»“æœçš„å±•å¼€å±‚æ¬¡ï¼Œé»˜è®¤å€¼æ˜¯ 1ã€‚</span>
</span></span><span class=line><span class=cl>vmtool --action getInstances -c 19469ea2 --className org.springframework.context.ApplicationContext -x <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰§è¡Œè¡¨è¾¾å¼</span>
</span></span><span class=line><span class=cl><span class=c1># getInstances action è¿”å›ç»“æœç»‘å®šåˆ°instanceså˜é‡ä¸Šï¼Œå®ƒæ˜¯æ•°ç»„ã€‚å¯ä»¥é€šè¿‡--expresså‚æ•°æ‰§è¡ŒæŒ‡å®šçš„è¡¨è¾¾å¼ã€‚</span>
</span></span><span class=line><span class=cl>vmtool --action getInstances --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader --className org.springframework.context.ApplicationContext --express <span class=s1>&#39;instances[0].getBeanDefinitionNames()&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¼ºåˆ¶ GC</span>
</span></span><span class=line><span class=cl><span class=c1># å¯ä»¥ç»“åˆ vmoption å‘½ä»¤åŠ¨æ€æ‰“å¼€PrintGCå¼€å…³</span>
</span></span><span class=line><span class=cl>vmtool --action forceGc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># interrupt æŒ‡å®šçº¿ç¨‹</span>
</span></span><span class=line><span class=cl><span class=c1># thread id é€šè¿‡-tå‚æ•°æŒ‡å®šï¼Œå¯ä»¥ä½¿ç”¨ thread å‘½ä»¤è·å–ã€‚</span>
</span></span><span class=line><span class=cl>vmtool --action interruptThread -t <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=perfcounter>perfcounter</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹å½“å‰ JVM çš„ Perf Counter ä¿¡æ¯</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>perfcounter
</span></span><span class=line><span class=cl><span class=c1># å¯ä»¥ç”¨-då‚æ•°æ‰“å°æ›´å¤šä¿¡æ¯ï¼š</span>
</span></span><span class=line><span class=cl>perfcounter -d
</span></span></code></pre></td></tr></table></div></div><p>jdk9 ä»¥ä¸Šçš„åº”ç”¨,å¦‚æœæ²¡æœ‰æ‰“å°å‡ºä¿¡æ¯ï¼Œåº”ç”¨åœ¨å¯åŠ¨æ—¶ï¼ŒåŠ ä¸‹é¢çš„å‚æ•°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>--add-opens java.base/jdk.internal.perf<span class=o>=</span>ALL-UNNAMED --add-exports java.base/jdk.internal.perf<span class=o>=</span>ALL-UNNAMED --add-opens java.management/sun.management.counter.perf<span class=o>=</span>ALL-UNNAMED --add-opens java.management/sun.management.counter<span class=o>=</span>ALL-UNNAMED
</span></span></code></pre></td></tr></table></div></div><h3 id=logger>logger</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹ logger ä¿¡æ¯ï¼Œæ›´æ–° logger level</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æ›´æ–° logger level</span>
</span></span><span class=line><span class=cl>logger --name ROOT --level debug
</span></span></code></pre></td></tr></table></div></div><h3 id=getstatic>getstatic</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># é€šè¿‡ getstatic å‘½ä»¤å¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹ç±»çš„é™æ€å±æ€§ã€‚ä½¿ç”¨æ–¹æ³•ä¸º `getstatic class_name field_name`</span>
</span></span><span class=line><span class=cl>getstatic demo.MathGame random
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ³¨æ„ hashcode æ˜¯å˜åŒ–çš„ï¼Œéœ€è¦å…ˆæŸ¥çœ‹å½“å‰çš„ ClassLoader ä¿¡æ¯ï¼Œä½¿ç”¨sc -d &lt;ClassName&gt;æå–å¯¹åº” ClassLoader çš„ hashcodeã€‚</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœä½ ä½¿ç”¨-cï¼Œä½ éœ€è¦æ‰‹åŠ¨è¾“å…¥ hashcodeï¼š-c &lt;hashcode&gt;</span>
</span></span><span class=line><span class=cl>getstatic -c 3d4eac69 demo.MathGame random
</span></span><span class=line><span class=cl><span class=c1># å¯¹äºåªæœ‰å”¯ä¸€å®ä¾‹çš„ ClassLoader å¯ä»¥é€šè¿‡--classLoaderClassæŒ‡å®š class nameï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼š</span>
</span></span><span class=line><span class=cl>getstatic --classLoaderClass sun.misc.Launcher<span class=nv>$AppClassLoader</span> demo.MathGame random
</span></span></code></pre></td></tr></table></div></div><h3 id=ognl>ognl</h3><blockquote><p><strong>æç¤º</strong></p><p>æ‰§è¡Œ ognl è¡¨è¾¾å¼</p></blockquote><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>express</td><td>æ‰§è¡Œçš„è¡¨è¾¾å¼</td></tr><tr><td style=text-align:right>[c:]</td><td>æ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ hashcodeï¼Œé»˜è®¤å€¼æ˜¯ SystemClassLoader</td></tr><tr><td style=text-align:right>[classLoaderClass:]</td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td style=text-align:right>[x]</td><td>ç»“æœå¯¹è±¡çš„å±•å¼€å±‚æ¬¡ï¼Œé»˜è®¤å€¼ 1</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># è°ƒç”¨é™æ€å‡½æ•°ï¼š</span>
</span></span><span class=line><span class=cl>ognl <span class=s1>&#39;@java.lang.System@out.println(&#34;hello&#34;)&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># è·å–é™æ€ç±»çš„é™æ€å­—æ®µï¼š</span>
</span></span><span class=line><span class=cl>ognl <span class=s1>&#39;@demo.MathGame@random&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># æ‰§è¡Œå¤šè¡Œè¡¨è¾¾å¼ï¼Œèµ‹å€¼ç»™ä¸´æ—¶å˜é‡ï¼Œè¿”å›ä¸€ä¸ª Listï¼š</span>
</span></span><span class=line><span class=cl>$ ognl <span class=s1>&#39;#value1=@System@getProperty(&#34;java.home&#34;), #value2=@System@getProperty(&#34;java.runtime.name&#34;), {#value1, #value2}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>arthas ä¸­çš„ç‰¹æ®Šç”¨æ³•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ç¬¬ä¸€ä¸ªå‚æ•°ï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0]&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ç¬¬ä¸€ä¸ªå‚æ•°çš„ sizeï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0].size()&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†ç»“æœæŒ‰ name å±æ€§æŠ•å½±ï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0].{ #this.name }&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‰æ¡ä»¶è¿‡æ»¤ï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0].{? #this.name == null }.size() &gt; 0&#34;</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¿‡æ»¤åç»Ÿè®¡ï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0].{? #this.age &gt; 10 }.size()&#34;</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ¤æ–­å­—ç¬¦ä¸²ç›¸ç­‰</span>
</span></span><span class=line><span class=cl>watch com.demo.Test <span class=nb>test</span> <span class=s1>&#39;params[0]==&#34;xyz&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ¤æ–­ long å‹</span>
</span></span><span class=line><span class=cl>watch com.demo.Test <span class=nb>test</span> <span class=s1>&#39;params[0]==123456789L&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å­è¡¨è¾¾å¼æ±‚å€¼ï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0].{? #this.age &gt; 10 }.size().(#this &gt; 20 ? #this - 10 : #this + 10)&#34;</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é€‰æ‹©ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶ï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0].{^ #this.name != null}&#34;</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é€‰æ‹©æœ€åä¸€ä¸ªæ»¡è¶³æ¡ä»¶ï¼š</span>
</span></span><span class=line><span class=cl>watch com.taobao.container.Test <span class=nb>test</span> <span class=s2>&#34;params[0].{</span>$<span class=s2> #this.name != null}&#34;</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åŒ¹é…çº¿ç¨‹ &amp; æ­£åˆ™å¤šä¸ªç±»å¤šä¸ªæ–¹æ³•</span>
</span></span><span class=line><span class=cl>trace -E <span class=s1>&#39;io\.netty\.channel\.nio\.NioEventLoop|io\.netty\.util\.concurrent\.SingleThreadEventExecutor&#39;</span>  <span class=s1>&#39;select|processSelectedKeys|runAllTasks&#39;</span> <span class=s1>&#39;@Thread@currentThread().getName().contains(&#34;IO-HTTP-WORKER-IOPool&#34;)&amp;&amp;#cost&gt;500&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=mbean>mbean</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹ Mbean çš„ä¿¡æ¯</p></blockquote><p>è¿™ä¸ªå‘½ä»¤å¯ä»¥ä¾¿æ·çš„æŸ¥çœ‹æˆ–ç›‘æ§ Mbean çš„å±æ€§ä¿¡æ¯ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>name-pattern</td><td>åç§°è¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right>attribute-pattern</td><td>å±æ€§åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right>[m]</td><td>æŸ¥çœ‹å…ƒä¿¡æ¯</td></tr><tr><td style=text-align:right>[i:]</td><td>åˆ·æ–°å±æ€§å€¼çš„æ—¶é—´é—´éš” (ms)</td></tr><tr><td style=text-align:right>[n:]</td><td>åˆ·æ–°å±æ€§å€¼çš„æ¬¡æ•°</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…ã€‚ä»…å¯¹å±æ€§åæœ‰æ•ˆ</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ—å‡ºæ‰€æœ‰ Mbean çš„åç§°ï¼š</span>
</span></span><span class=line><span class=cl>mbean
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ Mbean çš„å…ƒä¿¡æ¯ï¼š</span>
</span></span><span class=line><span class=cl>mbean -m java.lang:type<span class=o>=</span>Threading
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ mbean å±æ€§ä¿¡æ¯ï¼š</span>
</span></span><span class=line><span class=cl>mbean java.lang:type<span class=o>=</span>Threading
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># mbean çš„ name æ”¯æŒé€šé…ç¬¦åŒ¹é…ï¼š</span>
</span></span><span class=line><span class=cl><span class=c1># æ³¨æ„ï¼šObjectName çš„åŒ¹é…è§„åˆ™ä¸æ­£å¸¸çš„é€šé…ç¬¦å­˜åœ¨å·®å¼‚ï¼Œè¯¦ç»†å‚è§ï¼š[javax.management.ObjectName](https://docs.oracle.com/javase/8/docs/api/javax/management/ObjectName.html?is-external=true)</span>
</span></span><span class=line><span class=cl>mbean java.lang:type<span class=o>=</span>Th*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é€šé…ç¬¦åŒ¹é…ç‰¹å®šçš„å±æ€§å­—æ®µï¼š</span>
</span></span><span class=line><span class=cl>mbean java.lang:type<span class=o>=</span>Threading *Count
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ -E å‘½ä»¤åˆ‡æ¢ä¸ºæ­£åˆ™åŒ¹é…ï¼š</span>
</span></span><span class=line><span class=cl>mbean -E java.lang:type<span class=o>=</span>Threading PeakThreadCount<span class=p>|</span>ThreadCount<span class=p>|</span>DaemonThreadCount
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ -i å‘½ä»¤å®æ—¶ç›‘æ§ï¼š</span>
</span></span><span class=line><span class=cl>mbean -i <span class=m>1000</span> java.lang:type<span class=o>=</span>Threading *Count
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®æ—¶ç›‘æ§ä½¿ç”¨ -iï¼Œä½¿ç”¨ -n å‘½ä»¤æ‰§è¡Œå‘½ä»¤çš„æ¬¡æ•°ï¼ˆé»˜è®¤ä¸º 100 æ¬¡ï¼‰ï¼š</span>
</span></span><span class=line><span class=cl>mbean -i <span class=m>1000</span> -n <span class=m>50</span> java.lang:type<span class=o>=</span>Threading *Count
</span></span></code></pre></td></tr></table></div></div><h3 id=heapdump>heapdump</h3><blockquote><p><strong>æç¤º</strong></p><p>dump java heap, ç±»ä¼¼ jmap å‘½ä»¤çš„ heap dump åŠŸèƒ½ã€‚</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># dump åˆ°æŒ‡å®šæ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆæ–‡ä»¶åœ¨arthas-outputç›®å½•ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨ä¸‹è½½ï¼š http://localhost:8563/arthas-output/</span>
</span></span><span class=line><span class=cl>heapdump arthas-output/dump.hprof
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åª dump live å¯¹è±¡</span>
</span></span><span class=line><span class=cl>heapdump --live /tmp/dump.hprof
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># dump åˆ°ä¸´æ—¶æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>heapdump
</span></span></code></pre></td></tr></table></div></div><h2 id=ç±»å‘½ä»¤>ç±»å‘½ä»¤</h2><h3 id=sc>sc</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯</p></blockquote><p>â€œSearch-Classâ€ çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Class ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤æ”¯æŒçš„å‚æ•°æœ‰ <code>[d]</code>ã€<code>[E]</code>ã€<code>[f]</code> å’Œ <code>[x:]</code>ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right>[d]</td><td>è¾“å‡ºå½“å‰ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªç±»æ‰€åŠ è½½çš„åŸå§‹æ–‡ä»¶æ¥æºã€ç±»çš„å£°æ˜ã€åŠ è½½çš„ ClassLoader ç­‰è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœä¸€ä¸ªç±»è¢«å¤šä¸ª ClassLoader æ‰€åŠ è½½ï¼Œåˆ™ä¼šå‡ºç°å¤šæ¬¡</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td style=text-align:right>[f]</td><td>è¾“å‡ºå½“å‰ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼ˆéœ€è¦é…åˆå‚æ•°-d ä¸€èµ·ä½¿ç”¨ï¼‰</td></tr><tr><td style=text-align:right>[x:]</td><td>æŒ‡å®šè¾“å‡ºé™æ€å˜é‡æ—¶å±æ€§çš„éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 0ï¼Œå³ç›´æ¥ä½¿ç”¨ toString è¾“å‡º</td></tr><tr><td style=text-align:right>[c:]</td><td>æŒ‡å®š class çš„ ClassLoader çš„ hashcode</td></tr><tr><td style=text-align:right>[classLoaderClass:]</td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td style=text-align:right>[n:]</td><td>å…·æœ‰è¯¦ç»†ä¿¡æ¯çš„åŒ¹é…ç±»çš„æœ€å¤§æ•°é‡ï¼ˆé»˜è®¤ä¸º 100ï¼‰</td></tr><tr><td style=text-align:right>[cs &lt;arg>]</td><td>æŒ‡å®š class çš„ ClassLoader#toString() è¿”å›å€¼ã€‚é•¿æ ¼å¼[classLoaderStr &lt;arg>]</td></tr></tbody></table></div><blockquote><p><em>æç¤º</em></p><p>class-pattern æ”¯æŒå…¨é™å®šåï¼Œå¦‚ <code>com.taobao.test.AAA</code>ï¼Œä¹Ÿæ”¯æŒ <code>com/taobao/test/AAA</code> è¿™æ ·çš„æ ¼å¼ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬ä»å¼‚å¸¸å †æ ˆé‡Œé¢æŠŠç±»åæ‹·è´è¿‡æ¥çš„æ—¶å€™ï¼Œä¸éœ€è¦åœ¨æ‰‹åŠ¨æŠŠ <code>/</code> æ›¿æ¢ä¸º <code>.</code> å•¦ã€‚</p><p>sc é»˜è®¤å¼€å¯äº†å­ç±»åŒ¹é…åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å½“å‰ç±»çš„å­ç±»ä¹Ÿä¼šè¢«æœç´¢å‡ºæ¥ï¼Œæƒ³è¦ç²¾ç¡®çš„åŒ¹é…ï¼Œè¯·æ‰“å¼€ <code>options disable-sub-class true</code> å¼€å…³</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æ¨¡ç³Šæœç´¢</span>
</span></span><span class=line><span class=cl>sc demo.*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰“å°ç±»çš„è¯¦ç»†ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>sc -d demo.MathGame
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰“å°å‡ºç±»çš„ Field ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>sc -d -f demo.MathGame
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é€šè¿‡ ClassLoader#toString æŸ¥æ‰¾ç±»ï¼ˆå‰æï¼šæœ‰ä¸€ä¸ª toString()è¿”å›å€¼æ˜¯apoçš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½çš„ç±»ä¸­åŒ…å« `demo.MathGame`, `demo.MyBar`, `demo.MyFoo3` ä¸ªç±»ï¼‰</span>
</span></span><span class=line><span class=cl>sc -cs apo *demo*
</span></span></code></pre></td></tr></table></div></div><h3 id=sm>sm</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯</p></blockquote><p>â€œSearch-Methodâ€ çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½äº† Class ä¿¡æ¯çš„æ–¹æ³•ä¿¡æ¯ã€‚</p><p><code>sm</code> å‘½ä»¤åªèƒ½çœ‹åˆ°ç”±å½“å‰ç±»æ‰€å£°æ˜ (declaring) çš„æ–¹æ³•ï¼Œçˆ¶ç±»åˆ™æ— æ³•çœ‹åˆ°ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right>[d]</td><td>å±•ç¤ºæ¯ä¸ªæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td style=text-align:right>[c:]</td><td>æŒ‡å®š class çš„ ClassLoader çš„ hashcode</td></tr><tr><td style=text-align:right>[classLoaderClass:]</td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td style=text-align:right>[n:]</td><td>å…·æœ‰è¯¦ç»†ä¿¡æ¯çš„åŒ¹é…ç±»çš„æœ€å¤§æ•°é‡ï¼ˆé»˜è®¤ä¸º 100ï¼‰</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sm java.lang.String
</span></span><span class=line><span class=cl>sm -d java.lang.String toString
</span></span></code></pre></td></tr></table></div></div><h3 id=jad>jad</h3><blockquote><p><strong>æç¤º</strong></p><p>åç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç </p></blockquote><p><code>jad</code> å‘½ä»¤å°† JVM ä¸­å®é™…è¿è¡Œçš„ class çš„ byte code åç¼–è¯‘æˆ java ä»£ç ï¼Œä¾¿äºä½ ç†è§£ä¸šåŠ¡é€»è¾‘ï¼›å¦‚éœ€æ‰¹é‡ä¸‹è½½æŒ‡å®šåŒ…çš„ç›®å½•çš„ class å­—èŠ‚ç å¯ä»¥å‚è€ƒ dumpã€‚</p><ul><li>åœ¨ Arthas Console ä¸Šï¼Œåç¼–è¯‘å‡ºæ¥çš„æºç æ˜¯å¸¦è¯­æ³•é«˜äº®çš„ï¼Œé˜…è¯»æ›´æ–¹ä¾¿</li><li>å½“ç„¶ï¼Œåç¼–è¯‘å‡ºæ¥çš„ java ä»£ç å¯èƒ½ä¼šå­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œä½†ä¸å½±å“ä½ è¿›è¡Œé˜…è¯»ç†è§£</li></ul><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right>[c:]</td><td>ç±»æ‰€å± ClassLoader çš„ hashcode</td></tr><tr><td style=text-align:right>[classLoaderClass:]</td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åç¼–è¯‘java.lang.String</span>
</span></span><span class=line><span class=cl>jad java.lang.String
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åç¼–è¯‘æ—¶åªæ˜¾ç¤ºæºä»£ç </span>
</span></span><span class=line><span class=cl><span class=c1># é»˜è®¤æƒ…å†µä¸‹ï¼Œåç¼–è¯‘ç»“æœé‡Œä¼šå¸¦æœ‰ ClassLoader ä¿¡æ¯ï¼Œé€šè¿‡ --source-only é€‰é¡¹ï¼Œå¯ä»¥åªæ‰“å°æºä»£ç ã€‚æ–¹ä¾¿å’Œ mc/retransform å‘½ä»¤ç»“åˆä½¿ç”¨</span>
</span></span><span class=line><span class=cl>jad --source-only demo.MathGame
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åç¼–è¯‘æŒ‡å®šçš„å‡½æ•°</span>
</span></span><span class=line><span class=cl>jad demo.MathGame main
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åç¼–è¯‘æ—¶ä¸æ˜¾ç¤ºè¡Œå·</span>
</span></span><span class=line><span class=cl><span class=c1># --lineNumber å‚æ•°é»˜è®¤å€¼ä¸º trueï¼Œæ˜¾ç¤ºæŒ‡å®šä¸º false åˆ™ä¸æ‰“å°è¡Œå·ã€‚</span>
</span></span><span class=line><span class=cl>jad demo.MathGame main --lineNumber <span class=nb>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åç¼–è¯‘æ—¶æŒ‡å®š ClassLoader</span>
</span></span><span class=line><span class=cl><span class=c1># å½“æœ‰å¤šä¸ª ClassLoader éƒ½åŠ è½½äº†è¿™ä¸ªç±»æ—¶ï¼Œjad å‘½ä»¤ä¼šè¾“å‡ºå¯¹åº” ClassLoader å®ä¾‹çš„ hashcodeï¼Œç„¶åä½ åªéœ€è¦é‡æ–°æ‰§è¡Œ jad å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨å‚æ•° -c &lt;hashcode&gt; å°±å¯ä»¥åç¼–è¯‘æŒ‡å®š ClassLoader åŠ è½½çš„é‚£ä¸ªç±»äº†ï¼›</span>
</span></span><span class=line><span class=cl>jad org.apache.log4j.Logger
</span></span><span class=line><span class=cl><span class=c1># å¯¹äºåªæœ‰å”¯ä¸€å®ä¾‹çš„ ClassLoader è¿˜å¯ä»¥é€šè¿‡--classLoaderClassæŒ‡å®š class nameï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼š</span>
</span></span><span class=line><span class=cl><span class=c1># --classLoaderClass çš„å€¼æ˜¯ ClassLoader çš„ç±»åï¼Œåªæœ‰åŒ¹é…åˆ°å”¯ä¸€çš„ ClassLoader å®ä¾‹æ—¶æ‰èƒ½å·¥ä½œï¼Œç›®çš„æ˜¯æ–¹ä¾¿è¾“å…¥é€šç”¨å‘½ä»¤ï¼Œè€Œ-c &lt;hashcode&gt;æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=mc-retransform>mc-retransform</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; **æç¤º**
</span></span><span class=line><span class=cl>&gt;
</span></span><span class=line><span class=cl>&gt; åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œretransform jvm å·²åŠ è½½çš„ç±»ã€‚
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># retransform æŒ‡å®šçš„ .class æ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=c1># åŠ è½½æŒ‡å®šçš„ .class æ–‡ä»¶ï¼Œç„¶åè§£æå‡º class nameï¼Œå† retransform jvm ä¸­å·²åŠ è½½çš„å¯¹åº”çš„ç±»ã€‚æ¯åŠ è½½ä¸€ä¸ª .class æ–‡ä»¶ï¼Œåˆ™ä¼šè®°å½•ä¸€ä¸ª retransform entry.</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœå¤šæ¬¡æ‰§è¡Œ retransform åŠ è½½åŒä¸€ä¸ª class æ–‡ä»¶ï¼Œåˆ™ä¼šæœ‰å¤šæ¡ retransform entry.</span>
</span></span><span class=line><span class=cl>retransform /tmp/Test.class
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ retransform entry</span>
</span></span><span class=line><span class=cl><span class=c1># TransformCount ç»Ÿè®¡åœ¨ ClassFileTransformer#transform å‡½æ•°é‡Œå°è¯•è¿”å› entry å¯¹åº”çš„ .class æ–‡ä»¶çš„æ¬¡æ•°ï¼Œä½†å¹¶ä¸è¡¨æ˜ transform ä¸€å®šæˆåŠŸã€‚</span>
</span></span><span class=line><span class=cl>retransform -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤æŒ‡å®š retransform entry</span>
</span></span><span class=line><span class=cl><span class=c1># éœ€è¦æŒ‡å®š idï¼š</span>
</span></span><span class=line><span class=cl>retransform -d <span class=m>1</span>                    <span class=c1># delete retransform entry</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤æ‰€æœ‰ retransform entry</span>
</span></span><span class=line><span class=cl>retransform --deleteAll             <span class=c1># delete all retransform entries</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ˜¾å¼è§¦å‘ retransform</span>
</span></span><span class=line><span class=cl><span class=c1># æ³¨æ„ï¼šå¯¹äºåŒä¸€ä¸ªç±»ï¼Œå½“å­˜åœ¨å¤šä¸ª retransform entry æ—¶ï¼Œå¦‚æœæ˜¾å¼è§¦å‘ retransform ï¼Œåˆ™æœ€åæ·»åŠ çš„ entry ç”Ÿæ•ˆ(id æœ€å¤§çš„)ã€‚</span>
</span></span><span class=line><span class=cl>retransform --classPattern demo.*   <span class=c1># triger retransform classes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>retransform -c 327a647b /tmp/Test.class /tmp/Test<span class=se>\$</span>Inner.class
</span></span><span class=line><span class=cl>retransform --classLoaderClass <span class=s1>&#39;sun.misc.Launcher$AppClassLoader&#39;</span> /tmp/Test.class
</span></span></code></pre></td></tr></table></div></div><h4 id=å¦‚æœå¯¹æŸä¸ªç±»æ‰§è¡Œ-retransform-ä¹‹åæƒ³æ¶ˆé™¤å½±å“åˆ™éœ€è¦>å¦‚æœå¯¹æŸä¸ªç±»æ‰§è¡Œ retransform ä¹‹åï¼Œæƒ³æ¶ˆé™¤å½±å“ï¼Œåˆ™éœ€è¦</h4><ul><li>åˆ é™¤è¿™ä¸ªç±»å¯¹åº”çš„ retransform entry</li><li>é‡æ–°è§¦å‘ retransform</li></ul><blockquote><p><strong>æç¤º</strong></p><p>å¦‚æœä¸æ¸…é™¤æ‰æ‰€æœ‰çš„ retransform entryï¼Œå¹¶é‡æ–°è§¦å‘ retransform ï¼Œåˆ™ arthas stop æ—¶ï¼Œretransform è¿‡çš„ç±»ä»ç„¶ç”Ÿæ•ˆã€‚</p></blockquote><h4 id=ç»“åˆ-jadmc-å‘½ä»¤ä½¿ç”¨>ç»“åˆ jad/mc å‘½ä»¤ä½¿ç”¨</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mc /tmp/UserController.java -d /tmp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>retransform /tmp/com/example/demo/arthas/user/UserController.class
</span></span></code></pre></td></tr></table></div></div><ul><li>jad å‘½ä»¤åç¼–è¯‘ï¼Œç„¶åå¯ä»¥ç”¨å…¶å®ƒç¼–è¯‘å™¨ï¼Œæ¯”å¦‚ vim æ¥ä¿®æ”¹æºç </li><li>mc å‘½ä»¤æ¥å†…å­˜ç¼–è¯‘ä¿®æ”¹è¿‡çš„ä»£ç </li><li>ç”¨ retransform å‘½ä»¤åŠ è½½æ–°çš„å­—èŠ‚ç </li></ul><h4 id=ä¸Šä¼ -class-æ–‡ä»¶åˆ°æœåŠ¡å™¨çš„æŠ€å·§>ä¸Šä¼  .class æ–‡ä»¶åˆ°æœåŠ¡å™¨çš„æŠ€å·§</h4><p>ä½¿ç”¨ mc å‘½ä»¤æ¥ç¼–è¯‘ jad çš„åç¼–è¯‘çš„ä»£ç æœ‰å¯èƒ½å¤±è´¥ã€‚å¯ä»¥åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç ï¼Œç¼–è¯‘å¥½åå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šã€‚æœ‰çš„æœåŠ¡å™¨ä¸å…è®¸ç›´æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ base64 å‘½ä»¤æ¥ç»•è¿‡ã€‚</p><ol><li>åœ¨æœ¬åœ°å…ˆè½¬æ¢.class æ–‡ä»¶ä¸º base64ï¼Œå†ä¿å­˜ä¸º result.txt</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>base64 &lt; Test.class &gt; result.txt
</span></span></code></pre></td></tr></table></div></div><ol start=2><li><p>åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ–°å»ºå¹¶ç¼–è¾‘ result.txtï¼Œå¤åˆ¶æœ¬åœ°çš„å†…å®¹ï¼Œç²˜è´´å†ä¿å­˜</p></li><li><p>æŠŠæœåŠ¡å™¨ä¸Šçš„ result.txt è¿˜åŸä¸º.class</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>base64 -d &lt; result.txt &gt; Test.class
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>ç”¨ md5 å‘½ä»¤è®¡ç®—å“ˆå¸Œå€¼ï¼Œæ ¡éªŒæ˜¯å¦ä¸€è‡´</li></ol><hr><p>retransform çš„é™åˆ¶</p><ul><li>ä¸å…è®¸æ–°å¢åŠ  field/method</li><li>æ­£åœ¨è·‘çš„å‡½æ•°ï¼Œæ²¡æœ‰é€€å‡ºä¸èƒ½ç”Ÿæ•ˆï¼Œæ¯”å¦‚ä¸‹é¢æ–°å¢åŠ çš„ <code>System.out.println</code>ï¼Œåªæœ‰ <code>run()</code> å‡½æ•°é‡Œçš„ä¼šç”Ÿæ•ˆ</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MathGame</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MathGame</span><span class=w> </span><span class=n>game</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MathGame</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>game</span><span class=p>.</span><span class=na>run</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// è¿™ä¸ªä¸ç”Ÿæ•ˆï¼Œå› ä¸ºä»£ç ä¸€ç›´è·‘åœ¨ whileé‡Œ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;in loop&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// è¿™ä¸ªç”Ÿæ•ˆï¼Œå› ä¸ºrun()å‡½æ•°æ¯æ¬¡éƒ½å¯ä»¥å®Œæ•´ç»“æŸ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;call run()&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>int</span><span class=w> </span><span class=n>number</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=na>nextInt</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>primeFactors</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>primeFactors</span><span class=p>(</span><span class=n>number</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>print</span><span class=p>(</span><span class=n>number</span><span class=p>,</span><span class=w> </span><span class=n>primeFactors</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;illegalArgumentCount:%3d, &#34;</span><span class=p>,</span><span class=w> </span><span class=n>illegalArgumentCount</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=mc-redefine>mc-redefine</h3><blockquote><p><strong>æç¤º</strong></p><p>æ¨èä½¿ç”¨ <a class=link href=#mc-retransform>retransform</a> å‘½ä»¤</p></blockquote><h3 id=dump>dump</h3><blockquote><p><strong>æç¤º</strong></p><p>dump å·²åŠ è½½ç±»çš„ bytecode åˆ°ç‰¹å®šç›®å½•</p></blockquote><p>dump å‘½ä»¤å°† JVM ä¸­å®é™…è¿è¡Œçš„ class çš„ byte code dump åˆ°æŒ‡å®šç›®å½•ï¼Œé€‚ç”¨åœºæ™¯æ‰¹é‡ä¸‹è½½æŒ‡å®šåŒ…ç›®å½•çš„ class å­—èŠ‚ç ï¼›å¦‚éœ€åç¼–è¯‘å•ä¸€ç±»ã€å®æ—¶æŸ¥çœ‹ç±»ä¿¡æ¯ï¼Œå¯å‚è€ƒ <a class=link href=#jad>jad</a>ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right>[c:]</td><td>ç±»æ‰€å± ClassLoader çš„ hashcode</td></tr><tr><td style=text-align:right>[classLoaderClass:]</td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td style=text-align:right>[d:]</td><td>è®¾ç½®ç±»æ–‡ä»¶çš„ç›®æ ‡ç›®å½•</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>dump java.lang.String
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dump demo.*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dump -d /tmp/output java.lang.String
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‡å®š classLoader</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœä½ ä½¿ç”¨ -cï¼Œä½ éœ€è¦æ‰‹åŠ¨è¾“å…¥ hashcodeï¼š-c &lt;hashcode&gt;</span>
</span></span><span class=line><span class=cl>dump -c 3d4eac69 demo.*
</span></span><span class=line><span class=cl><span class=c1># å¯¹äºåªæœ‰å”¯ä¸€å®ä¾‹çš„ ClassLoader å¯ä»¥é€šè¿‡--classLoaderClassæŒ‡å®š class nameï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼š</span>
</span></span><span class=line><span class=cl>dump --classLoaderClass sun.misc.Launcher<span class=nv>$AppClassLoader</span> demo.*
</span></span></code></pre></td></tr></table></div></div><h3 id=classloader>classloader</h3><blockquote><p><strong>æç¤º</strong></p><p>æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯</p></blockquote><p><code>classloader</code> å‘½ä»¤å°† JVM ä¸­æ‰€æœ‰çš„ classloader çš„ä¿¡æ¯ç»Ÿè®¡å‡ºæ¥ï¼Œå¹¶å¯ä»¥å±•ç¤ºç»§æ‰¿æ ‘ï¼Œurls ç­‰ã€‚</p><p>å¯ä»¥è®©æŒ‡å®šçš„ classloader å» getResourcesï¼Œæ‰“å°å‡ºæ‰€æœ‰æŸ¥æ‰¾åˆ°çš„ resources çš„ urlã€‚å¯¹äº <code>ResourceNotFoundException</code> æ¯”è¾ƒæœ‰ç”¨ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>[l]</td><td>æŒ‰ç±»åŠ è½½å®ä¾‹è¿›è¡Œç»Ÿè®¡</td></tr><tr><td style=text-align:right>[t]</td><td>æ‰“å°æ‰€æœ‰ ClassLoader çš„ç»§æ‰¿æ ‘</td></tr><tr><td style=text-align:right>[a]</td><td>åˆ—å‡ºæ‰€æœ‰ ClassLoader åŠ è½½çš„ç±»ï¼Œè¯·è°¨æ…ä½¿ç”¨</td></tr><tr><td style=text-align:right>[c:]</td><td>ClassLoader çš„ hashcode</td></tr><tr><td style=text-align:right>[classLoaderClass:]</td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td style=text-align:right>[c: r:]</td><td>ç”¨ ClassLoader å»æŸ¥æ‰¾ resource</td></tr><tr><td style=text-align:right>[c: load:]</td><td>ç”¨ ClassLoader å»åŠ è½½æŒ‡å®šçš„ç±»</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># æŒ‰ç±»åŠ è½½ç±»å‹æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>classloader
</span></span><span class=line><span class=cl><span class=c1># æŒ‰ç±»åŠ è½½å®ä¾‹æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>classloader -l
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ ClassLoader çš„ç»§æ‰¿æ ‘</span>
</span></span><span class=line><span class=cl>classloader -t
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ URLClassLoader å®é™…çš„ urls</span>
</span></span><span class=line><span class=cl>classloader -c 3d4eac69
</span></span><span class=line><span class=cl><span class=c1># æ³¨æ„ hashcode æ˜¯å˜åŒ–çš„ï¼Œéœ€è¦å…ˆæŸ¥çœ‹å½“å‰çš„ ClassLoader ä¿¡æ¯ï¼Œæå–å¯¹åº” ClassLoader çš„ hashcodeã€‚</span>
</span></span><span class=line><span class=cl><span class=c1># å¯¹äºåªæœ‰å”¯ä¸€å®ä¾‹çš„ ClassLoader å¯ä»¥é€šè¿‡ class name æŒ‡å®šï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼š</span>
</span></span><span class=line><span class=cl>classloader --classLoaderClass sun.misc.Launcher<span class=nv>$AppClassLoader</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ ClassLoader å»æŸ¥æ‰¾ resource</span>
</span></span><span class=line><span class=cl>classloader -c 3d4eac69  -r META-INF/MANIFEST.MF
</span></span><span class=line><span class=cl><span class=c1># ä¹Ÿå¯ä»¥å°è¯•æŸ¥æ‰¾ç±»çš„ class æ–‡ä»¶ï¼š</span>
</span></span><span class=line><span class=cl>classloader -c 1b6d3586 -r java/lang/String.class
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ ClassLoader å»åŠ è½½ç±»</span>
</span></span><span class=line><span class=cl>classloader -c 3d4eac69 --load demo.MathGame
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç»Ÿè®¡ ClassLoader å®é™…ä½¿ç”¨ URL å’Œæœªä½¿ç”¨çš„ URL</span>
</span></span><span class=line><span class=cl>classloader --url-stat
</span></span><span class=line><span class=cl><span class=c1># æ³¨æ„ï¼ŒåŸºäº JVM ç›®å‰å·²åŠ è½½çš„æ‰€æœ‰ç±»ç»Ÿè®¡ï¼Œä¸ä»£è¡¨ Unused URLs å¯ä»¥ä»åº”ç”¨ä¸­åˆ æ‰ã€‚å› ä¸ºå¯èƒ½å°†æ¥éœ€è¦ä» Unused URLs é‡ŒåŠ è½½ç±»ï¼Œæˆ–è€…éœ€è¦åŠ è½½ resourcesã€‚</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å¢å¼ºå‘½ä»¤>å¢å¼ºå‘½ä»¤</h2><h3 id=monitor>monitor</h3><blockquote><p><strong>æç¤º</strong></p><p>æ–¹æ³•æ‰§è¡Œç›‘æ§</p></blockquote><p>å¯¹åŒ¹é… <code>class-pattern</code>ï¼<code>method-pattern</code>ï¼<code>condition-express</code> çš„ç±»ã€æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œç›‘æ§ã€‚</p><p><code>monitor</code> å‘½ä»¤æ˜¯ä¸€ä¸ªéå®æ—¶è¿”å›å‘½ä»¤.</p><p>å®æ—¶è¿”å›å‘½ä»¤æ˜¯è¾“å…¥ä¹‹åç«‹å³è¿”å›ï¼Œè€Œéå®æ—¶è¿”å›çš„å‘½ä»¤ï¼Œåˆ™æ˜¯ä¸æ–­çš„ç­‰å¾…ç›®æ ‡ Java è¿›ç¨‹è¿”å›ä¿¡æ¯ï¼Œç›´åˆ°ç”¨æˆ·è¾“å…¥ <code>Ctrl+C</code> ä¸ºæ­¢ã€‚</p><p>æœåŠ¡ç«¯æ˜¯ä»¥ä»»åŠ¡çš„å½¢å¼åœ¨åå°è·‘ä»»åŠ¡ï¼Œæ¤å…¥çš„ä»£ç éšç€ä»»åŠ¡çš„ä¸­æ­¢è€Œä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä»»åŠ¡å…³é—­åï¼Œä¸ä¼šå¯¹åŸæœ‰æ€§èƒ½äº§ç”Ÿå¤ªå¤§å½±å“ï¼Œè€Œä¸”åŸåˆ™ä¸Šï¼Œä»»ä½• Arthas å‘½ä»¤ä¸ä¼šå¼•èµ·åŸæœ‰ä¸šåŠ¡é€»è¾‘çš„æ”¹å˜ã€‚</p><p>ç›‘æ§ç»´åº¦ï¼š</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>ç›‘æ§é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right>timestamp</td><td>æ—¶é—´æˆ³</td></tr><tr><td style=text-align:right>class</td><td>Java ç±»</td></tr><tr><td style=text-align:right>method</td><td>æ–¹æ³•ï¼ˆæ„é€ æ–¹æ³•ã€æ™®é€šæ–¹æ³•ï¼‰</td></tr><tr><td style=text-align:right>total</td><td>è°ƒç”¨æ¬¡æ•°</td></tr><tr><td style=text-align:right>success</td><td>æˆåŠŸæ¬¡æ•°</td></tr><tr><td style=text-align:right>fail</td><td>å¤±è´¥æ¬¡æ•°</td></tr><tr><td style=text-align:right>rt</td><td>å¹³å‡ RT</td></tr><tr><td style=text-align:right>fail-rate</td><td>å¤±è´¥ç‡</td></tr></tbody></table></div><p>å‚æ•°ï¼š</p><p>æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªå‘½åå‚æ•° <code>[c:]</code>ï¼Œæ„æ€æ˜¯ç»Ÿè®¡å‘¨æœŸï¼ˆcycle of outputï¼‰ï¼Œæ‹¥æœ‰ä¸€ä¸ªæ•´å‹çš„å‚æ•°å€¼</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td style=text-align:right>[c:]</td><td>ç»Ÿè®¡å‘¨æœŸï¼Œé»˜è®¤å€¼ä¸º 120 ç§’</td></tr><tr><td style=text-align:right>[b]</td><td>åœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰è®¡ç®— condition-express</td></tr><tr><td style=text-align:right>[m &lt;arg>]</td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º[maxMatch &lt;arg>]ã€‚</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ monitor -c <span class=m>5</span> demo.MathGame primeFactors
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>94</span> ms.
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2018-12-03 19:06:38  demo.MathGame  primeFactors  <span class=m>5</span>      <span class=m>1</span>        <span class=m>4</span>     1.15        80.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2018-12-03 19:06:43  demo.MathGame  primeFactors  <span class=m>5</span>      <span class=m>3</span>        <span class=m>2</span>     42.29       40.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2018-12-03 19:06:48  demo.MathGame  primeFactors  <span class=m>5</span>      <span class=m>3</span>        <span class=m>2</span>     67.92       40.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2018-12-03 19:06:53  demo.MathGame  primeFactors  <span class=m>5</span>      <span class=m>2</span>        <span class=m>3</span>     0.25        60.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2018-12-03 19:06:58  demo.MathGame  primeFactors  <span class=m>1</span>      <span class=m>1</span>        <span class=m>0</span>     0.45        0.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2018-12-03 19:07:03  demo.MathGame  primeFactors  <span class=m>2</span>      <span class=m>2</span>        <span class=m>0</span>     3182.72     0.00%
</span></span></code></pre></td></tr></table></div></div><h4 id=æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ monitor -c <span class=m>1</span> -m <span class=m>1</span> demo.MathGame primeFactors
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count:1 , method count:1<span class=o>)</span> cost in <span class=m>384</span> ms, listenerId: 6.
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2022-12-25 21:12:58  demo.MathGame  primeFactors  <span class=m>1</span>      <span class=m>1</span>        <span class=m>0</span>     0.18        0.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method        total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2022-12-25 21:12:59  demo.MathGame  primeFactors  <span class=m>0</span>      <span class=m>0</span>        <span class=m>0</span>     0.00       0.00%
</span></span></code></pre></td></tr></table></div></div><h4 id=è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å>è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœ(æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>monitor -c <span class=m>5</span> demo.MathGame primeFactors <span class=s2>&#34;params[0] &lt;= 2&#34;</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>19</span> ms, listenerId: <span class=m>5</span>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:36  demo.MathGame  primeFactors    <span class=m>5</span>       <span class=m>3</span>       <span class=m>2</span>      0.09       40.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:41  demo.MathGame  primeFactors    <span class=m>5</span>       <span class=m>2</span>       <span class=m>3</span>      0.11       60.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:46  demo.MathGame  primeFactors    <span class=m>5</span>       <span class=m>1</span>       <span class=m>4</span>      0.06       80.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:51  demo.MathGame  primeFactors    <span class=m>5</span>       <span class=m>1</span>       <span class=m>4</span>      0.12       80.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:56  demo.MathGame  primeFactors    <span class=m>5</span>       <span class=m>3</span>       <span class=m>2</span>      0.15       40.00%
</span></span></code></pre></td></tr></table></div></div><h4 id=è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å‰>è®¡ç®—æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤ç»Ÿè®¡ç»“æœ(æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹å‰)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>monitor -b -c <span class=m>5</span> com.test.testes.MathGame primeFactors <span class=s2>&#34;params[0] &lt;= 2&#34;</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>21</span> ms, listenerId: <span class=m>4</span>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:41:57  demo.MathGame  primeFactors    <span class=m>1</span>       <span class=m>0</span>        <span class=m>1</span>      0.10      100.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:02  demo.MathGame  primeFactors    <span class=m>3</span>       <span class=m>0</span>        <span class=m>3</span>      0.06      100.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:07  demo.MathGame  primeFactors    <span class=m>2</span>       <span class=m>0</span>        <span class=m>2</span>      0.06      100.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:12  demo.MathGame  primeFactors    <span class=m>1</span>       <span class=m>0</span>        <span class=m>1</span>      0.05      100.00%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> timestamp            class          method         total  success  fail  avg-rt<span class=o>(</span>ms<span class=o>)</span>  fail-rate
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 2020-09-02 09:42:17  demo.MathGame  primeFactors    <span class=m>2</span>       <span class=m>0</span>        <span class=m>2</span>      0.10      100.00%
</span></span></code></pre></td></tr></table></div></div><h3 id=watch>watch</h3><blockquote><p><strong>æç¤º</strong></p><p>å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹</p></blockquote><p>è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šå‡½æ•°çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼š<code>è¿”å›å€¼</code>ã€<code>æŠ›å‡ºå¼‚å¸¸</code>ã€<code>å…¥å‚</code>ï¼Œé€šè¿‡ç¼–å†™ OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚</p><p>watch çš„å‚æ•°æ¯”è¾ƒå¤šï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½åœ¨ 4 ä¸ªä¸åŒçš„åœºæ™¯è§‚å¯Ÿå¯¹è±¡</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>method-pattern</em></td><td>å‡½æ•°åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>express</em></td><td>è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œé»˜è®¤å€¼ï¼š{params, target, returnObj}</td></tr><tr><td style=text-align:right><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td style=text-align:right>[b]</td><td>åœ¨<strong>å‡½æ•°è°ƒç”¨ä¹‹å‰</strong>è§‚å¯Ÿ</td></tr><tr><td style=text-align:right>[e]</td><td>åœ¨<strong>å‡½æ•°å¼‚å¸¸ä¹‹å</strong>è§‚å¯Ÿ</td></tr><tr><td style=text-align:right>[s]</td><td>åœ¨<strong>å‡½æ•°è¿”å›ä¹‹å</strong>è§‚å¯Ÿ</td></tr><tr><td style=text-align:right>[f]</td><td>åœ¨<strong>å‡½æ•°ç»“æŸä¹‹å</strong>(æ­£å¸¸è¿”å›å’Œå¼‚å¸¸è¿”å›)è§‚å¯Ÿ</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td style=text-align:right>[x:]</td><td>æŒ‡å®šè¾“å‡ºç»“æœçš„å±æ€§éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§å€¼æ˜¯ 4</td></tr><tr><td style=text-align:right>[m &lt;arg>]</td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º[maxMatch &lt;arg>]ã€‚</td></tr></tbody></table></div><p>è¿™é‡Œé‡ç‚¹è¦è¯´æ˜çš„æ˜¯è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œè§‚å¯Ÿè¡¨è¾¾å¼çš„æ„æˆä¸»è¦ç”± ognl è¡¨è¾¾å¼ç»„æˆï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™ <code>"{params,returnObj}"</code>ï¼Œåªè¦æ˜¯ä¸€ä¸ªåˆæ³•çš„ ognl è¡¨è¾¾å¼ï¼Œéƒ½èƒ½è¢«æ­£å¸¸æ”¯æŒã€‚</p><p>è§‚å¯Ÿçš„ç»´åº¦ä¹Ÿæ¯”è¾ƒå¤šï¼Œä¸»è¦ä½“ç°åœ¨å‚æ•° <code>advice</code> çš„æ•°æ®ç»“æ„ä¸Šã€‚<code>Advice</code> å‚æ•°æœ€ä¸»è¦æ˜¯å°è£…äº†é€šçŸ¥èŠ‚ç‚¹çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¯·å‚è€ƒ<a class=link href=#%e8%a1%a8%e8%be%be%e5%bc%8f%e6%a0%b8%e5%bf%83%e5%8f%98%e9%87%8f>è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</a>ä¸­å…³äºè¯¥èŠ‚ç‚¹çš„æè¿°ã€‚</p><ul><li>watch å‘½ä»¤å®šä¹‰äº† 4 ä¸ªè§‚å¯Ÿäº‹ä»¶ç‚¹ï¼Œå³ <code>-b</code> å‡½æ•°è°ƒç”¨å‰ï¼Œ<code>-e</code> å‡½æ•°å¼‚å¸¸åï¼Œ<code>-s</code> å‡½æ•°è¿”å›åï¼Œ<code>-f</code> å‡½æ•°ç»“æŸå</li><li>4 ä¸ªè§‚å¯Ÿäº‹ä»¶ç‚¹ <code>-b</code>ã€<code>-e</code>ã€<code>-s</code> é»˜è®¤å…³é—­ï¼Œ<code>-f</code> é»˜è®¤æ‰“å¼€ï¼Œå½“æŒ‡å®šè§‚å¯Ÿç‚¹è¢«æ‰“å¼€åï¼Œåœ¨ç›¸åº”äº‹ä»¶ç‚¹ä¼šå¯¹è§‚å¯Ÿè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼å¹¶è¾“å‡º</li><li>è¿™é‡Œè¦æ³¨æ„ <code>å‡½æ•°å…¥å‚</code> å’Œ <code>å‡½æ•°å‡ºå‚</code> çš„åŒºåˆ«ï¼Œæœ‰å¯èƒ½åœ¨ä¸­é—´è¢«ä¿®æ”¹å¯¼è‡´å‰åä¸ä¸€è‡´ï¼Œé™¤äº† <code>-b</code> äº‹ä»¶ç‚¹ <code>params</code> ä»£è¡¨å‡½æ•°å…¥å‚å¤–ï¼Œå…¶ä½™äº‹ä»¶éƒ½ä»£è¡¨å‡½æ•°å‡ºå‚</li><li>å½“ä½¿ç”¨ -b æ—¶ï¼Œç”±äºè§‚å¯Ÿäº‹ä»¶ç‚¹æ˜¯åœ¨å‡½æ•°è°ƒç”¨å‰ï¼Œæ­¤æ—¶è¿”å›å€¼æˆ–å¼‚å¸¸å‡ä¸å­˜åœ¨</li><li>åœ¨ watch å‘½ä»¤çš„ç»“æœé‡Œï¼Œä¼šæ‰“å°å‡º <code>location</code> ä¿¡æ¯ã€‚<code>location</code> æœ‰ä¸‰ç§å¯èƒ½å€¼ï¼š<code>AtEnter</code>ï¼Œ<code>AtExit</code>ï¼Œ<code>AtExceptionExit</code>ã€‚å¯¹åº”å‡½æ•°å…¥å£ï¼Œå‡½æ•°æ­£å¸¸ returnï¼Œå‡½æ•°æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h4 id=è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°this-å¯¹è±¡å’Œè¿”å›å€¼>è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°ã€this å¯¹è±¡å’Œè¿”å›å€¼</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œé»˜è®¤å€¼æ˜¯{params, target, returnObj}</span>
</span></span><span class=line><span class=cl>$ watch demo.MathGame primeFactors -x <span class=m>2</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>32</span> ms, listenerId: <span class=m>5</span>
</span></span><span class=line><span class=cl><span class=nv>method</span><span class=o>=</span>demo.MathGame.primeFactors <span class=nv>location</span><span class=o>=</span>AtExceptionExit
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2021-08-31 15:22:57<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.220625ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>-179173<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=nv>random</span><span class=o>=</span>@Random<span class=o>[</span>java.util.Random@31cefde0<span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=nv>illegalArgumentCount</span><span class=o>=</span>@Integer<span class=o>[</span>44<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    null,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>method</span><span class=o>=</span>demo.MathGame.primeFactors <span class=nv>location</span><span class=o>=</span>AtExit
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2021-08-31 15:22:58<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>1.020982ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>1<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=nv>random</span><span class=o>=</span>@Random<span class=o>[</span>java.util.Random@31cefde0<span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=nv>illegalArgumentCount</span><span class=o>=</span>@Integer<span class=o>[</span>44<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>2<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>2<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>26947<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ä¸Šé¢çš„ç»“æœé‡Œï¼Œè¯´æ˜å‡½æ•°è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡ç»“æœæ˜¯ <code>location=AtExceptionExit</code>ï¼Œè¯´æ˜å‡½æ•°æŠ›å‡ºå¼‚å¸¸äº†ï¼Œå› æ­¤ <code>returnObj</code> æ˜¯ null</li><li>åœ¨ç¬¬äºŒæ¬¡ç»“æœé‡Œæ˜¯ <code>location=AtExit</code>ï¼Œè¯´æ˜å‡½æ•°æ­£å¸¸è¿”å›ï¼Œå› æ­¤å¯ä»¥çœ‹åˆ° <code>returnObj</code> ç»“æœæ˜¯ä¸€ä¸ª ArrayList</li></ul><h4 id=æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡-1>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors -m <span class=m>1</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>302</span> ms, listenerId: <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=nv>method</span><span class=o>=</span>demo.MathGame.primeFactors <span class=nv>location</span><span class=o>=</span>AtExceptionExit
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2022-12-25 19:58:41<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.222419ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span><span class=nv>isEmpty</span><span class=o>=</span>false<span class=p>;</span><span class=nv>size</span><span class=o>=</span>1<span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>demo.MathGame@3bf400<span class=o>]</span>,
</span></span><span class=line><span class=cl>    null,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>method</span><span class=o>=</span>demo.MathGame.primeFactors <span class=nv>location</span><span class=o>=</span>AtExceptionExit
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2022-12-25 19:58:51<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.046928ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span><span class=nv>isEmpty</span><span class=o>=</span>false<span class=p>;</span><span class=nv>size</span><span class=o>=</span>1<span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>demo.MathGame@3bf400<span class=o>]</span>,
</span></span><span class=line><span class=cl>    null,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=è§‚å¯Ÿå‡½æ•°è°ƒç”¨å…¥å£çš„å‚æ•°å’Œè¿”å›å€¼>è§‚å¯Ÿå‡½æ•°è°ƒç”¨å…¥å£çš„å‚æ•°å’Œè¿”å›å€¼</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s2>&#34;{params,returnObj}&#34;</span> -x <span class=m>2</span> -b
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>50</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:23:23<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.0353ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>-1077465243<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    null,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># å¯¹æ¯”å‰ä¸€ä¸ªä¾‹å­ï¼Œè¿”å›å€¼ä¸ºç©ºï¼ˆäº‹ä»¶ç‚¹ä¸ºå‡½æ•°æ‰§è¡Œå‰ï¼Œå› æ­¤è·å–ä¸åˆ°è¿”å›å€¼ï¼‰</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=åŒæ—¶è§‚å¯Ÿå‡½æ•°è°ƒç”¨å‰å’Œå‡½æ•°è¿”å›å>åŒæ—¶è§‚å¯Ÿå‡½æ•°è°ƒç”¨å‰å’Œå‡½æ•°è¿”å›å</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s2>&#34;{params,target,returnObj}&#34;</span> -x <span class=m>2</span> -b -s -n <span class=m>2</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>46</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:29:54<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.01696ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>1<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=nv>random</span><span class=o>=</span>@Random<span class=o>[</span>java.util.Random@522b408a<span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=nv>illegalArgumentCount</span><span class=o>=</span>@Integer<span class=o>[</span>13038<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    null,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:29:54<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>4.277392ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>1<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=nv>random</span><span class=o>=</span>@Random<span class=o>[</span>java.util.Random@522b408a<span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=nv>illegalArgumentCount</span><span class=o>=</span>@Integer<span class=o>[</span>13038<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>2<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>2<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>2<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>5<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>5<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>73<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>241<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>439<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>å‚æ•°é‡Œ <code>-n 2</code>ï¼Œè¡¨ç¤ºåªæ‰§è¡Œä¸¤æ¬¡</li><li>è¿™é‡Œè¾“å‡ºç»“æœä¸­ï¼Œç¬¬ä¸€æ¬¡è¾“å‡ºçš„æ˜¯å‡½æ•°è°ƒç”¨å‰çš„è§‚å¯Ÿè¡¨è¾¾å¼çš„ç»“æœï¼Œç¬¬äºŒæ¬¡è¾“å‡ºçš„æ˜¯å‡½æ•°è¿”å›åçš„è¡¨è¾¾å¼çš„ç»“æœ</li><li>ç»“æœçš„è¾“å‡ºé¡ºåºå’Œäº‹ä»¶å‘ç”Ÿçš„å…ˆåé¡ºåºä¸€è‡´ï¼Œå’Œå‘½ä»¤ä¸­ <code>-s</code> <code>-b</code> çš„é¡ºåºæ— å…³</li></ul><h4 id=è°ƒæ•´-x-çš„å€¼è§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼>è°ƒæ•´-x çš„å€¼ï¼Œè§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s2>&#34;{params,target}&#34;</span> -x <span class=m>3</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>58</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:34:19<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.587833ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>1<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=nv>random</span><span class=o>=</span>@Random<span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=nv>serialVersionUID</span><span class=o>=</span>@Long<span class=o>[</span>3905348978240129619<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>seed</span><span class=o>=</span>@AtomicLong<span class=o>[</span>3133719055989<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>multiplier</span><span class=o>=</span>@Long<span class=o>[</span>25214903917<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>addend</span><span class=o>=</span>@Long<span class=o>[</span>11<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>mask</span><span class=o>=</span>@Long<span class=o>[</span>281474976710655<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>DOUBLE_UNIT</span><span class=o>=</span>@Double<span class=o>[</span>1.1102230246251565E-16<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>BadBound</span><span class=o>=</span>@String<span class=o>[</span>bound must be positive<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>BadRange</span><span class=o>=</span>@String<span class=o>[</span>bound must be greater than origin<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>BadSize</span><span class=o>=</span>@String<span class=o>[</span>size must be non-negative<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>seedUniquifier</span><span class=o>=</span>@AtomicLong<span class=o>[</span>-3282039941672302964<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>nextNextGaussian</span><span class=o>=</span>@Double<span class=o>[</span>0.0<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>haveNextNextGaussian</span><span class=o>=</span>@Boolean<span class=o>[</span>false<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>serialPersistentFields</span><span class=o>=</span>@ObjectStreamField<span class=o>[][</span><span class=nv>isEmpty</span><span class=o>=</span>false<span class=p>;</span><span class=nv>size</span><span class=o>=</span>3<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>unsafe</span><span class=o>=</span>@Unsafe<span class=o>[</span>sun.misc.Unsafe@2eaa1027<span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=nv>seedOffset</span><span class=o>=</span>@Long<span class=o>[</span>24<span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=nv>illegalArgumentCount</span><span class=o>=</span>@Integer<span class=o>[</span>13159<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>-x</code> è¡¨ç¤ºéå†æ·±åº¦ï¼Œå¯ä»¥è°ƒæ•´æ¥æ‰“å°å…·ä½“çš„å‚æ•°å’Œç»“æœå†…å®¹ï¼Œé»˜è®¤å€¼æ˜¯ 1ã€‚</li><li><code>-x</code> æœ€å¤§å€¼æ˜¯ 4ï¼Œé˜²æ­¢å±•å¼€ç»“æœå ç”¨å¤ªå¤šå†…å­˜ã€‚ç”¨æˆ·å¯ä»¥åœ¨ <code>ognl</code> è¡¨è¾¾å¼é‡ŒæŒ‡å®šæ›´å…·ä½“çš„ fieldã€‚</li></ul><h4 id=æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­>æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s2>&#34;{params[0],target}&#34;</span> <span class=s2>&#34;params[0]&lt;0&#34;</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>68</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:36:04<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.530255ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Integer<span class=o>[</span>-18178089<span class=o>]</span>,
</span></span><span class=line><span class=cl>    @MathGame<span class=o>[</span>demo.MathGame@41cf53f9<span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># åªæœ‰æ»¡è¶³æ¡ä»¶çš„è°ƒç”¨ï¼Œæ‰ä¼šæœ‰å“åº”ã€‚</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=è§‚å¯Ÿå¼‚å¸¸ä¿¡æ¯çš„ä¾‹å­>è§‚å¯Ÿå¼‚å¸¸ä¿¡æ¯çš„ä¾‹å­</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s2>&#34;{params[0],throwExp}&#34;</span> -e -x <span class=m>2</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>62</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:38:00<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>1.414993ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Integer<span class=o>[</span>-1120397038<span class=o>]</span>,
</span></span><span class=line><span class=cl>    java.lang.IllegalArgumentException: number is: -1120397038, need &gt;<span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>	at demo.MathGame.primeFactors<span class=o>(</span>MathGame.java:46<span class=o>)</span>
</span></span><span class=line><span class=cl>	at demo.MathGame.run<span class=o>(</span>MathGame.java:24<span class=o>)</span>
</span></span><span class=line><span class=cl>	at demo.MathGame.main<span class=o>(</span>MathGame.java:16<span class=o>)</span>
</span></span><span class=line><span class=cl>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>-e</code>è¡¨ç¤ºæŠ›å‡ºå¼‚å¸¸æ—¶æ‰è§¦å‘</li><li>express ä¸­ï¼Œè¡¨ç¤ºå¼‚å¸¸ä¿¡æ¯çš„å˜é‡æ˜¯ <code>throwExp</code></li></ul><h4 id=æŒ‰ç…§è€—æ—¶è¿›è¡Œè¿‡æ»¤>æŒ‰ç…§è€—æ—¶è¿›è¡Œè¿‡æ»¤</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s1>&#39;{params, returnObj}&#39;</span> <span class=s1>&#39;#cost&gt;200&#39;</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>66</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:40:28<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>2112.168897ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>1<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>5<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>428379493<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>#cost>200</code> (å•ä½æ˜¯ ms)è¡¨ç¤ºåªæœ‰å½“è€—æ—¶å¤§äº 200ms æ—¶æ‰ä¼šè¾“å‡ºï¼Œè¿‡æ»¤æ‰æ‰§è¡Œæ—¶é—´å°äº 200ms çš„è°ƒç”¨</li></ul><h4 id=è§‚å¯Ÿå½“å‰å¯¹è±¡ä¸­çš„å±æ€§>è§‚å¯Ÿå½“å‰å¯¹è±¡ä¸­çš„å±æ€§</h4><p>å¦‚æœæƒ³æŸ¥çœ‹å‡½æ•°è¿è¡Œå‰åï¼Œå½“å‰å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ target å…³é”®å­—ï¼Œä»£è¡¨å½“å‰å¯¹è±¡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s1>&#39;target&#39;</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>52</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 19:41:52<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.477882ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@MathGame<span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=nv>random</span><span class=o>=</span>@Random<span class=o>[</span>java.util.Random@522b408a<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=nv>illegalArgumentCount</span><span class=o>=</span>@Integer<span class=o>[</span>13355<span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åä½¿ç”¨ target.field_name è®¿é—®å½“å‰å¯¹è±¡çš„æŸä¸ªå±æ€§</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch demo.MathGame primeFactors <span class=s1>&#39;target.illegalArgumentCount&#39;</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>67</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 20:04:34<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>131.303498ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@Integer<span class=o>[</span>8<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-03 20:04:35<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.961441ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@Integer<span class=o>[</span>8<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=è·å–ç±»çš„é™æ€å­—æ®µè°ƒç”¨ç±»çš„é™æ€å‡½æ•°çš„ä¾‹å­>è·å–ç±»çš„é™æ€å­—æ®µã€è°ƒç”¨ç±»çš„é™æ€å‡½æ•°çš„ä¾‹å­</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>watch demo.MathGame * <span class=s1>&#39;{params,@demo.MathGame@random.nextInt(100)}&#39;</span> -v -n <span class=m>1</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=o>[</span>arthas@6527<span class=o>]</span>$ watch demo.MathGame * <span class=s1>&#39;{params,@demo.MathGame@random.nextInt(100)}&#39;</span> -n <span class=m>1</span> -x <span class=m>2</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 5<span class=o>)</span> cost in <span class=m>34</span> ms, listenerId: <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2021-01-05 21:35:20<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.173966ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>    @Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>-138282<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    @Integer<span class=o>[</span>89<span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„è¿™é‡Œä½¿ç”¨ <code>Thread.currentThread().getContextClassLoader()</code> åŠ è½½,ä½¿ç”¨ç²¾ç¡® <code>classloader</code> ognl æ›´å¥½ã€‚</p><h4 id=æ’é™¤æ‰æŒ‡å®šçš„ç±»>æ’é™¤æ‰æŒ‡å®šçš„ç±»</h4><blockquote><p><strong>æç¤º</strong></p><p>watch/trace/monitor/stack/tt å‘½ä»¤éƒ½æ”¯æŒ <code>--exclude-class-pattern</code> å‚æ•°</p></blockquote><p>ä½¿ç”¨ <code>--exclude-class-pattern</code> å‚æ•°å¯ä»¥æ’é™¤æ‰æŒ‡å®šçš„ç±»ï¼Œæ¯”å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>watch javax.servlet.Filter * --exclude-class-pattern com.demo.TestFilter
</span></span></code></pre></td></tr></table></div></div><h4 id=ä¸åŒ¹é…å­ç±»>ä¸åŒ¹é…å­ç±»</h4><p>é»˜è®¤æƒ…å†µä¸‹ watch/trace/monitor/stack/tt å‘½ä»¤éƒ½ä¼šåŒ¹é…å­ç±»ã€‚å¦‚æœæƒ³ä¸åŒ¹é…ï¼Œå¯ä»¥é€šè¿‡å…¨å±€å‚æ•°å…³æ‰ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>options disable-sub-class <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ä½¿ç”¨--v-å‚æ•°æ‰“å°æ›´å¤šä¿¡æ¯>ä½¿ç”¨ -v å‚æ•°æ‰“å°æ›´å¤šä¿¡æ¯</h4><blockquote><p><strong>æç¤º</strong></p><p>watch/trace/monitor/stack/tt å‘½ä»¤éƒ½æ”¯æŒ <code>-v</code> å‚æ•°</p></blockquote><p>å½“å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œæ²¡æœ‰è¾“å‡ºç»“æœã€‚æœ‰ä¸¤ç§å¯èƒ½ï¼š</p><ol><li>åŒ¹é…åˆ°çš„å‡½æ•°æ²¡æœ‰è¢«æ‰§è¡Œ</li><li>æ¡ä»¶è¡¨è¾¾å¼ç»“æœæ˜¯ false</li></ol><p>ä½†ç”¨æˆ·åŒºåˆ†ä¸å‡ºæ˜¯å“ªç§æƒ…å†µã€‚</p><p>ä½¿ç”¨ -v é€‰é¡¹ï¼Œåˆ™ä¼šæ‰“å° Condition express çš„å…·ä½“å€¼å’Œæ‰§è¡Œç»“æœï¼Œæ–¹ä¾¿ç¡®è®¤ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ watch -v -x <span class=m>2</span> demo.MathGame print <span class=s1>&#39;params&#39;</span> <span class=s1>&#39;params[0] &gt; 100000&#39;</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>29</span> ms, listenerId: <span class=m>11</span>
</span></span><span class=line><span class=cl>Condition express: params<span class=o>[</span>0<span class=o>]</span> &gt; <span class=m>100000</span> , result: <span class=nb>false</span>
</span></span><span class=line><span class=cl>Condition express: params<span class=o>[</span>0<span class=o>]</span> &gt; <span class=m>100000</span> , result: <span class=nb>false</span>
</span></span><span class=line><span class=cl>Condition express: params<span class=o>[</span>0<span class=o>]</span> &gt; <span class=m>100000</span> , result: <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2020-12-02 22:38:56<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.060843ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>    @Integer<span class=o>[</span>200033<span class=o>]</span>,
</span></span><span class=line><span class=cl>    @ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>200033<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl>Condition express: params<span class=o>[</span>0<span class=o>]</span> &gt; <span class=m>100000</span> , result: <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2020-12-02 22:38:57<span class=p>;</span> <span class=o>[</span><span class=nv>cost</span><span class=o>=</span>0.052877ms<span class=o>]</span> <span class=nv>result</span><span class=o>=</span>@Object<span class=o>[][</span>
</span></span><span class=line><span class=cl>    @Integer<span class=o>[</span>123047<span class=o>]</span>,
</span></span><span class=line><span class=cl>    @ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>29<span class=o>]</span>,
</span></span><span class=line><span class=cl>        @Integer<span class=o>[</span>4243<span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=trace>trace</h3><blockquote><p><strong>æç¤º</strong></p><p>æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶</p></blockquote><p><code>trace</code> å‘½ä»¤èƒ½ä¸»åŠ¨æœç´¢ <code>class-pattern</code>ï¼<code>method-pattern</code> å¯¹åº”çš„æ–¹æ³•è°ƒç”¨è·¯å¾„ï¼Œæ¸²æŸ“å’Œç»Ÿè®¡æ•´ä¸ªè°ƒç”¨é“¾è·¯ä¸Šçš„æ‰€æœ‰æ€§èƒ½å¼€é”€å’Œè¿½è¸ªè°ƒç”¨é“¾è·¯ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td style=text-align:right>[n:]</td><td>å‘½ä»¤æ‰§è¡Œæ¬¡æ•°</td></tr><tr><td style=text-align:right>#cost</td><td>æ–¹æ³•æ‰§è¡Œè€—æ—¶</td></tr><tr><td style=text-align:right>[m &lt;arg>]</td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º[maxMatch &lt;arg>]ã€‚</td></tr></tbody></table></div><p>è¿™é‡Œé‡ç‚¹è¦è¯´æ˜çš„æ˜¯æ¡ä»¶è¡¨è¾¾å¼ï¼Œæ¡ä»¶è¡¨è¾¾å¼çš„æ„æˆä¸»è¦ç”± <code>ognl</code> è¡¨è¾¾å¼ç»„æˆï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™ <code>"params[0]&lt;0"</code>ï¼Œåªè¦æ˜¯ä¸€ä¸ªåˆæ³•çš„ ognl è¡¨è¾¾å¼ï¼Œéƒ½èƒ½è¢«æ­£å¸¸æ”¯æŒã€‚</p><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åªæƒ³çœ‹åˆ°æŸä¸ªæ–¹æ³•çš„ rt å¤§äºæŸä¸ªæ—¶é—´ä¹‹åçš„ trace ç»“æœï¼Œç°åœ¨ Arthas å¯ä»¥æŒ‰ç…§æ–¹æ³•æ‰§è¡Œçš„è€—æ—¶æ¥è¿›è¡Œè¿‡æ»¤äº†ï¼Œä¾‹å¦‚ <code>trace \*StringUtils isBlank '#cost>100'</code> è¡¨ç¤ºå½“æ‰§è¡Œæ—¶é—´è¶…è¿‡ 100ms çš„æ—¶å€™ï¼Œæ‰ä¼šè¾“å‡º trace çš„ç»“æœã€‚</p><blockquote><p><strong>æç¤º</strong></p><p>watch/stack/trace è¿™ä¸ªä¸‰ä¸ªå‘½ä»¤éƒ½æ”¯æŒ <code>#cost</code></p></blockquote><p>æ³¨æ„äº‹é¡¹:</p><ul><li>trace èƒ½æ–¹ä¾¿çš„å¸®åŠ©ä½ å®šä½å’Œå‘ç°å›  RT é«˜è€Œå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ç¼ºé™·ï¼Œä½†å…¶æ¯æ¬¡åªèƒ½è·Ÿè¸ªä¸€çº§æ–¹æ³•çš„è°ƒç”¨é“¾è·¯ã€‚</li><li>3.3.0 ç‰ˆæœ¬åï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ Trace åŠŸèƒ½ï¼Œä¸æ–­å¢åŠ æ–°çš„åŒ¹é…ç±»ï¼Œå‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ã€‚</li><li>ç›®å‰ä¸æ”¯æŒ trace java.lang.Thread getName ï¼Œè€ƒè™‘åˆ°ä¸æ˜¯éå¸¸å¿…è¦åœºæ™¯ï¼Œä¸”ä¿®å¤æœ‰ä¸€å®šéš¾åº¦ï¼Œå› æ­¤å½“å‰æš‚ä¸ä¿®å¤</li></ul><h4 id=trace-å‡½æ•°>trace å‡½æ•°</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ trace demo.MathGame run
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>28</span> ms.
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2019-12-04 00:45:08<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>0.617465ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.078946ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#24 [throws Exception]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2019-12-04 00:45:09<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>1.276874ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.03752ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#24 [throws Exception]</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“æœé‡Œçš„ <code>#24</code>ï¼Œè¡¨ç¤ºåœ¨ run å‡½æ•°é‡Œï¼Œåœ¨æºæ–‡ä»¶çš„ç¬¬ 24 è¡Œè°ƒç”¨äº†<code>primeFactors()</code>å‡½æ•°ã€‚</p><h4 id=æŒ‡å®š-class-åŒ¹é…çš„æœ€å¤§æ•°é‡>æŒ‡å®š Class åŒ¹é…çš„æœ€å¤§æ•°é‡</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ trace demo.MathGame run -m <span class=m>1</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>412</span> ms, listenerId: <span class=m>4</span>
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2022-12-25 21:00:00<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@b4aac2
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>0.762093ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>30.21% 0.230241ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#46 [throws Exception]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2022-12-25 21:00:10<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@b4aac2
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>0.315298ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>13.95% 0.043995ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#46 [throws Exception]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=trace-æ¬¡æ•°é™åˆ¶>trace æ¬¡æ•°é™åˆ¶</h4><p>å¦‚æœæ–¹æ³•è°ƒç”¨çš„æ¬¡æ•°å¾ˆå¤šï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ <code>-n</code> å‚æ•°æŒ‡å®šæ•æ‰ç»“æœçš„æ¬¡æ•°ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­é‡Œï¼Œæ•æ‰åˆ°ä¸€æ¬¡è°ƒç”¨å°±é€€å‡ºå‘½ä»¤ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>trace demo.MathGame run -n <span class=m>1</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>20</span> ms.
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2019-12-04 00:45:53<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>0.549379ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.059839ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#24</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.232887ms<span class=o>]</span> demo.MathGame:print<span class=o>()</span> <span class=c1>#25</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Command execution <span class=nb>times</span> exceed limit: 1, so <span class=nb>command</span> will exit. You can <span class=nb>set</span> it with -n option.
</span></span></code></pre></td></tr></table></div></div><h4 id=åŒ…å«-jdk-çš„å‡½æ•°>åŒ…å« jdk çš„å‡½æ•°</h4><ul><li><code>--skipJDKMethod &lt;value></code> skip jdk method trace, default value true.</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œtrace ä¸ä¼šåŒ…å« jdk é‡Œçš„å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœå¸Œæœ› trace jdk é‡Œçš„å‡½æ•°ï¼Œéœ€è¦æ˜¾å¼è®¾ç½® <code>--skipJDKMethod false</code>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ trace --skipJDKMethod <span class=nb>false</span> demo.MathGame run
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>60</span> ms.
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2019-12-04 00:44:41<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>1.357742ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.028624ms<span class=o>]</span> java.util.Random:nextInt<span class=o>()</span> <span class=c1>#23</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.045534ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#24 [throws Exception]</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.005372ms<span class=o>]</span> java.lang.StringBuilder:&lt;init&gt;<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.012257ms<span class=o>]</span> java.lang.Integer:valueOf<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.234537ms<span class=o>]</span> java.lang.String:format<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span><span class=nv>min</span><span class=o>=</span>0.004539ms,max<span class=o>=</span>0.005778ms,total<span class=o>=</span>0.010317ms,count<span class=o>=</span>2<span class=o>]</span> java.lang.StringBuilder:append<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.013777ms<span class=o>]</span> java.lang.Exception:getMessage<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.004935ms<span class=o>]</span> java.lang.StringBuilder:toString<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.06941ms<span class=o>]</span> java.io.PrintStream:println<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2019-12-04 00:44:42<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>3.030432ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.010473ms<span class=o>]</span> java.util.Random:nextInt<span class=o>()</span> <span class=c1>#23</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.023715ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#24 [throws Exception]</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.005198ms<span class=o>]</span> java.lang.StringBuilder:&lt;init&gt;<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.006405ms<span class=o>]</span> java.lang.Integer:valueOf<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.178583ms<span class=o>]</span> java.lang.String:format<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span><span class=nv>min</span><span class=o>=</span>0.011636ms,max<span class=o>=</span>0.838077ms,total<span class=o>=</span>0.849713ms,count<span class=o>=</span>2<span class=o>]</span> java.lang.StringBuilder:append<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.008747ms<span class=o>]</span> java.lang.Exception:getMessage<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.019768ms<span class=o>]</span> java.lang.StringBuilder:toString<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.076457ms<span class=o>]</span> java.io.PrintStream:println<span class=o>()</span> <span class=c1>#28</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤>æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ trace demo.MathGame run <span class=s1>&#39;#cost &gt; 10&#39;</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>41</span> ms.
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2018-12-04 01:12:02<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>12.033735ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.006783ms<span class=o>]</span> java.util.Random:nextInt<span class=o>()</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>11.852594ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.05447ms<span class=o>]</span> demo.MathGame:print<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>åªä¼šå±•ç¤ºè€—æ—¶å¤§äº 10ms çš„è°ƒç”¨è·¯å¾„ï¼Œæœ‰åŠ©äºåœ¨æ’æŸ¥é—®é¢˜çš„æ—¶å€™ï¼Œåªå…³æ³¨å¼‚å¸¸æƒ…å†µ</p></blockquote><ul><li>æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Œæ²¡é”™ï¼Œåœ¨ JProfiler ç­‰æ”¶è´¹è½¯ä»¶ä¸­ä½ æ›¾ç»è§è¯†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œè¿™é‡Œä½ å°†å¯ä»¥é€šè¿‡å‘½ä»¤å°±èƒ½æ‰“å°å‡ºæŒ‡å®šè°ƒç”¨è·¯å¾„ã€‚ å‹æƒ…æé†’ä¸‹ï¼Œ<code>trace</code> åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æœ¬èº«æ˜¯ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œåœ¨ç»Ÿè®¡çš„æŠ¥å‘Šä¸­å¹¶æœªåƒ JProfiler ä¸€æ ·é¢„å…ˆå‡å»å…¶è‡ªèº«çš„ç»Ÿè®¡å¼€é”€ã€‚æ‰€ä»¥è¿™ç»Ÿè®¡å‡ºæ¥æœ‰äº›è®¸çš„ä¸å‡†ï¼Œæ¸²æŸ“è·¯å¾„ä¸Šè°ƒç”¨çš„ç±»ã€æ–¹æ³•è¶Šå¤šï¼Œæ€§èƒ½åå·®è¶Šå¤§ã€‚ä½†è¿˜æ˜¯èƒ½è®©ä½ çœ‹æ¸…ä¸€äº›äº‹æƒ…çš„ã€‚</li><li>[12.033735ms] çš„å«ä¹‰ï¼Œ<code>12.033735</code> çš„å«ä¹‰æ˜¯ï¼šå½“å‰èŠ‚ç‚¹åœ¨å½“å‰æ­¥éª¤çš„è€—æ—¶ï¼Œå•ä½ä¸ºæ¯«ç§’</li><li>[0,0,0ms,11]xxx:yyy() [throws Exception]ï¼Œå¯¹è¯¥æ–¹æ³•ä¸­ç›¸åŒçš„æ–¹æ³•è°ƒç”¨è¿›è¡Œäº†åˆå¹¶ï¼Œ<code>0,0,0ms,11</code> è¡¨ç¤ºæ–¹æ³•è°ƒç”¨è€—æ—¶ï¼Œ<code>min,max,total,count</code>ï¼›<code>throws Exception</code> è¡¨æ˜è¯¥æ–¹æ³•è°ƒç”¨ä¸­å­˜åœ¨å¼‚å¸¸è¿”å›</li><li>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç»Ÿè®¡ä¸å‡†ç¡®çš„é—®é¢˜ï¼Œå°±æ˜¯æ‰€æœ‰æ–¹æ³•è€—æ—¶åŠ èµ·æ¥å¯èƒ½ä¼šå°äºè¯¥ç›‘æµ‹æ–¹æ³•çš„æ€»è€—æ—¶ï¼Œè¿™ä¸ªæ˜¯ç”±äº Arthas æœ¬èº«çš„é€»è¾‘ä¼šæœ‰ä¸€å®šçš„è€—æ—¶</li></ul><h4 id=trace-å¤šä¸ªç±»æˆ–è€…å¤šä¸ªå‡½æ•°>trace å¤šä¸ªç±»æˆ–è€…å¤šä¸ªå‡½æ•°</h4><p>trace å‘½ä»¤åªä¼š trace åŒ¹é…åˆ°çš„å‡½æ•°é‡Œçš„å­è°ƒç”¨ï¼Œå¹¶ä¸ä¼šå‘ä¸‹ trace å¤šå±‚ã€‚å› ä¸º trace æ˜¯ä»£ä»·æ¯”è¾ƒè´µçš„ï¼Œå¤šå±‚ trace å¯èƒ½ä¼šå¯¼è‡´æœ€ç»ˆè¦ trace çš„ç±»å’Œå‡½æ•°éå¸¸å¤šã€‚</p><p>å¯ä»¥ç”¨æ­£åˆ™è¡¨åŒ¹é…è·¯å¾„ä¸Šçš„å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œä¸€å®šç¨‹åº¦ä¸Šè¾¾åˆ°å¤šå±‚ trace çš„æ•ˆæœã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>trace -E com.test.ClassA<span class=p>|</span>org.test.ClassB method1<span class=p>|</span>method2<span class=p>|</span>method3
</span></span></code></pre></td></tr></table></div></div><h4 id=trace-æ—¶é—´ä¸å‡†ç¡®>trace æ—¶é—´ä¸å‡†ç¡®</h4><p>æ¯”å¦‚ä¸‹é¢çš„ç»“æœé‡Œï¼š<code>0.705196</code> > <code>(0.152743 + 0.145825)</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ trace demo.MathGame run -n <span class=m>1</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>66</span> ms, listenerId: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2021-02-08 11:27:36<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@232204a1
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>0.705196ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.152743ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#24</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.145825ms<span class=o>]</span> demo.MathGame:print<span class=o>()</span> <span class=c1>#25</span>
</span></span></code></pre></td></tr></table></div></div><p>é‚£ä¹ˆå…¶å®ƒçš„æ—¶é—´æ¶ˆè€—åœ¨å“ªäº›åœ°æ–¹ï¼Ÿ</p><ol><li>æ²¡æœ‰è¢« trace åˆ°çš„å‡½æ•°ã€‚æ¯”å¦‚ <code>java.\*</code> ä¸‹çš„å‡½æ•°è°ƒç”¨é»˜è®¤ä¼šå¿½ç•¥æ‰ã€‚é€šè¿‡å¢åŠ  <code>--skipJDKMethod false</code> å‚æ•°å¯ä»¥æ‰“å°å‡ºæ¥ã€‚</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ trace demo.MathGame run --skipJDKMethod <span class=nb>false</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>35</span> ms, listenerId: <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=sb>`</span>---ts<span class=o>=</span>2021-02-08 11:27:48<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@232204a1
</span></span><span class=line><span class=cl>    <span class=sb>`</span>---<span class=o>[</span>0.810591ms<span class=o>]</span> demo.MathGame:run<span class=o>()</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.034568ms<span class=o>]</span> java.util.Random:nextInt<span class=o>()</span> <span class=c1>#23</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.119367ms<span class=o>]</span> demo.MathGame:primeFactors<span class=o>()</span> <span class=c1>#24 [throws Exception]</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.017407ms<span class=o>]</span> java.lang.StringBuilder:&lt;init&gt;<span class=o>()</span> <span class=c1>#28</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.127922ms<span class=o>]</span> java.lang.String:format<span class=o>()</span> <span class=c1>#57</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span><span class=nv>min</span><span class=o>=</span>0.01419ms,max<span class=o>=</span>0.020221ms,total<span class=o>=</span>0.034411ms,count<span class=o>=</span>2<span class=o>]</span> java.lang.StringBuilder:append<span class=o>()</span> <span class=c1>#57</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.021911ms<span class=o>]</span> java.lang.Exception:getMessage<span class=o>()</span> <span class=c1>#57</span>
</span></span><span class=line><span class=cl>        +---<span class=o>[</span>0.015643ms<span class=o>]</span> java.lang.StringBuilder:toString<span class=o>()</span> <span class=c1>#57</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span>---<span class=o>[</span>0.086622ms<span class=o>]</span> java.io.PrintStream:println<span class=o>()</span> <span class=c1>#57</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>éå‡½æ•°è°ƒç”¨çš„æŒ‡ä»¤æ¶ˆè€—ã€‚æ¯”å¦‚ i++, getfield ç­‰æŒ‡ä»¤ã€‚</li><li>åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒJVM å¯èƒ½å‡ºç°åœé¡¿ï¼Œæ¯”å¦‚ GCï¼Œè¿›å…¥åŒæ­¥å—ç­‰ã€‚</li></ol><h3 id=stack>stack</h3><blockquote><p><strong>æç¤º</strong></p><p>è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„</p></blockquote><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªæ–¹æ³•è¢«æ‰§è¡Œï¼Œä½†è¿™ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„è·¯å¾„éå¸¸å¤šï¼Œæˆ–è€…ä½ æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯ä»é‚£é‡Œè¢«æ‰§è¡Œäº†ï¼Œæ­¤æ—¶ä½ éœ€è¦çš„æ˜¯ stack å‘½ä»¤ã€‚</p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td style=text-align:right><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td style=text-align:right>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td style=text-align:right>[n:]</td><td>æ‰§è¡Œæ¬¡æ•°é™åˆ¶</td></tr><tr><td style=text-align:right>[m &lt;arg>]</td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º[maxMatch &lt;arg>]ã€‚</td></tr></tbody></table></div><p>è¿™é‡Œé‡ç‚¹è¦è¯´æ˜çš„æ˜¯è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œè§‚å¯Ÿè¡¨è¾¾å¼çš„æ„æˆä¸»è¦ç”± <code>ognl</code> è¡¨è¾¾å¼ç»„æˆï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™ <code>"{params,returnObj}"</code>ï¼Œåªè¦æ˜¯ä¸€ä¸ªåˆæ³•çš„ ognl è¡¨è¾¾å¼ï¼Œéƒ½èƒ½è¢«æ­£å¸¸æ”¯æŒã€‚</p><p>è§‚å¯Ÿçš„ç»´åº¦ä¹Ÿæ¯”è¾ƒå¤šï¼Œä¸»è¦ä½“ç°åœ¨å‚æ•° <code>advice</code> çš„æ•°æ®ç»“æ„ä¸Šã€‚<code>Advice</code> å‚æ•°æœ€ä¸»è¦æ˜¯å°è£…äº†é€šçŸ¥èŠ‚ç‚¹çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><h4 id=stack---run>stack - run</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ stack demo.MathGame primeFactors
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>36</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-04 01:32:19<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    @demo.MathGame.run<span class=o>()</span>
</span></span><span class=line><span class=cl>        at demo.MathGame.main<span class=o>(</span>MathGame.java:16<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡-2>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ stack demo.MathGame primeFactors -m <span class=m>1</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count:1 , method count:1<span class=o>)</span> cost in <span class=m>561</span> ms, listenerId: 5.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2022-12-25 21:07:07<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@b4aac2
</span></span><span class=line><span class=cl>    @demo.MathGame.primeFactors<span class=o>()</span>
</span></span><span class=line><span class=cl>        at demo.MathGame.run<span class=o>(</span>MathGame.java:46<span class=o>)</span>
</span></span><span class=line><span class=cl>        at demo.MathGame.main<span class=o>(</span>MathGame.java:38<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æ®æ¡ä»¶è¡¨è¾¾å¼æ¥è¿‡æ»¤>æ®æ¡ä»¶è¡¨è¾¾å¼æ¥è¿‡æ»¤</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ stack demo.MathGame primeFactors <span class=s1>&#39;params[0]&lt;0&#39;</span> -n <span class=m>2</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>30</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-04 01:34:27<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    @demo.MathGame.run<span class=o>()</span>
</span></span><span class=line><span class=cl>        at demo.MathGame.main<span class=o>(</span>MathGame.java:16<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-04 01:34:30<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    @demo.MathGame.run<span class=o>()</span>
</span></span><span class=line><span class=cl>        at demo.MathGame.main<span class=o>(</span>MathGame.java:16<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Command execution <span class=nb>times</span> exceed limit: 2, so <span class=nb>command</span> will exit. You can <span class=nb>set</span> it with -n option.
</span></span></code></pre></td></tr></table></div></div><h4 id=æ®æ‰§è¡Œæ—¶é—´æ¥è¿‡æ»¤>æ®æ‰§è¡Œæ—¶é—´æ¥è¿‡æ»¤</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ stack demo.MathGame primeFactors <span class=s1>&#39;#cost&gt;5&#39;</span>
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>35</span> ms.
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span>2018-12-04 01:35:58<span class=p>;</span><span class=nv>thread_name</span><span class=o>=</span>main<span class=p>;</span><span class=nv>id</span><span class=o>=</span>1<span class=p>;</span><span class=nv>is_daemon</span><span class=o>=</span>false<span class=p>;</span><span class=nv>priority</span><span class=o>=</span>5<span class=p>;</span><span class=nv>TCCL</span><span class=o>=</span>sun.misc.Launcher<span class=nv>$AppClassLoader</span>@3d4eac69
</span></span><span class=line><span class=cl>    @demo.MathGame.run<span class=o>()</span>
</span></span><span class=line><span class=cl>        at demo.MathGame.main<span class=o>(</span>MathGame.java:16<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=tt>tt</h3><blockquote><p><strong>æç¤º</strong></p><p>æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹</p></blockquote><p><code>watch</code> è™½ç„¶å¾ˆæ–¹ä¾¿å’Œçµæ´»ï¼Œä½†éœ€è¦æå‰æƒ³æ¸…æ¥šè§‚å¯Ÿè¡¨è¾¾å¼çš„æ‹¼å†™ï¼Œè¿™å¯¹æ’æŸ¥é—®é¢˜è€Œè¨€è¦æ±‚å¤ªé«˜ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šé—®é¢˜å‡ºè‡ªäºä½•æ–¹ï¼Œåªèƒ½é è››ä¸é©¬è¿¹è¿›è¡ŒçŒœæµ‹ã€‚</p><p>è¿™ä¸ªæ—¶å€™å¦‚æœèƒ½è®°å½•ä¸‹å½“æ—¶æ–¹æ³•è°ƒç”¨çš„æ‰€æœ‰å…¥å‚å’Œè¿”å›å€¼ã€æŠ›å‡ºçš„å¼‚å¸¸ä¼šå¯¹æ•´ä¸ªé—®é¢˜çš„æ€è€ƒä¸åˆ¤æ–­éå¸¸æœ‰å¸®åŠ©ã€‚</p><p>äºæ˜¯ä¹ï¼ŒTimeTunnel å‘½ä»¤å°±è¯ç”Ÿäº†ã€‚</p><p>æ³¨æ„äº‹é¡¹:</p><ul><li>tt å‘½ä»¤çš„å®ç°æ˜¯ï¼šæŠŠå‡½æ•°çš„å…¥å‚/è¿”å›å€¼ç­‰ï¼Œä¿å­˜åˆ°ä¸€ä¸ª <code>Map&lt;Integer, TimeFragment></code> é‡Œï¼Œé»˜è®¤çš„å¤§å°æ˜¯ 100ã€‚</li><li>tt ç›¸å…³åŠŸèƒ½åœ¨ä½¿ç”¨å®Œä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œå¦åˆ™é•¿æ—¶é—´å¯èƒ½å¯¼è‡´ OOMã€‚é€€å‡º arthas ä¸ä¼šè‡ªåŠ¨æ¸…é™¤ tt çš„ç¼“å­˜ mapã€‚</li></ul><h4 id=è®°å½•è°ƒç”¨>è®°å½•è°ƒç”¨</h4><p>å¯¹äºä¸€ä¸ªæœ€åŸºæœ¬çš„ä½¿ç”¨æ¥è¯´ï¼Œå°±æ˜¯è®°å½•ä¸‹å½“å‰æ–¹æ³•çš„æ¯æ¬¡è°ƒç”¨ç¯å¢ƒç°åœºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tt -t demo.MathGame primeFactors
</span></span><span class=line><span class=cl>Press Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class-cnt:1 , method-cnt:1<span class=o>)</span> cost in <span class=m>66</span> ms.
</span></span><span class=line><span class=cl> INDEX   TIMESTAMP            COST<span class=o>(</span>ms<span class=o>)</span>  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD
</span></span><span class=line><span class=cl>-------------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> <span class=m>1000</span>    2018-12-04 11:15:38  1.096236  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1001</span>    2018-12-04 11:15:39  0.191848  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1002</span>    2018-12-04 11:15:40  0.069523  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1003</span>    2018-12-04 11:15:41  0.186073  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1004</span>    2018-12-04 11:15:42  17.76437  <span class=nb>true</span>    <span class=nb>false</span>    0x4b67cf4d     MathGame
</span></span></code></pre></td></tr></table></div></div><h4 id=æŒ‡å®š-class-æœ€å¤§åŒ¹é…æ•°é‡-3>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tt -t -m <span class=m>1</span> demo.MathGame primeFactors
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count:1 , method count:1<span class=o>)</span> cost in <span class=m>130</span> ms, listenerId: 1.
</span></span><span class=line><span class=cl> INDEX   TIMESTAMP            COST<span class=o>(</span>ms<span class=o>)</span>  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD
</span></span><span class=line><span class=cl>-------------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> <span class=m>1000</span>    2022-12-25 19:41:45  2.629929  <span class=nb>true</span>    <span class=nb>false</span>    0x3bf400       MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1001</span>    2022-12-25 19:41:55  0.146161  <span class=nb>false</span>   <span class=nb>true</span>     0x3bf400       MathGame
</span></span></code></pre></td></tr></table></div></div><ul><li><p>å‘½ä»¤å‚æ•°è§£æ</p><ul><li><p><code>-t</code>
<code>tt</code> å‘½ä»¤æœ‰å¾ˆå¤šä¸ªä¸»å‚æ•°ï¼Œ<code>-t</code> å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚è¿™ä¸ªå‚æ•°çš„è¡¨æ˜å¸Œæœ›è®°å½•ä¸‹ç±» *Test çš„ print æ–¹æ³•çš„æ¯æ¬¡æ‰§è¡Œæƒ…å†µã€‚</p></li><li><p><code>-n 3</code>
å½“ä½ æ‰§è¡Œä¸€ä¸ªè°ƒç”¨é‡ä¸é«˜çš„æ–¹æ³•æ—¶å¯èƒ½ä½ è¿˜èƒ½æœ‰è¶³å¤Ÿçš„æ—¶é—´ç”¨ <code>CTRL+C</code> ä¸­æ–­ tt å‘½ä»¤è®°å½•çš„è¿‡ç¨‹ï¼Œä½†å¦‚æœé‡åˆ°è°ƒç”¨é‡éå¸¸å¤§çš„æ–¹æ³•ï¼Œç¬é—´å°±èƒ½å°†ä½ çš„ JVM å†…å­˜æ’‘çˆ†ã€‚</p><p>æ­¤æ—¶ä½ å¯ä»¥é€šè¿‡ <code>-n</code> å‚æ•°æŒ‡å®šä½ éœ€è¦è®°å½•çš„æ¬¡æ•°ï¼Œå½“è¾¾åˆ°è®°å½•æ¬¡æ•°æ—¶ Arthas ä¼šä¸»åŠ¨ä¸­æ–­ tt å‘½ä»¤çš„è®°å½•è¿‡ç¨‹ï¼Œé¿å…äººå·¥æ“ä½œæ— æ³•åœæ­¢çš„æƒ…å†µã€‚</p><ul><li><code>-m 1</code>
é€šè¿‡ <code>-m</code> å‚æ•°æŒ‡å®š Class åŒ¹é…çš„æœ€å¤§æ•°é‡ï¼Œé˜²æ­¢åŒ¹é…åˆ°çš„ Class æ•°é‡å¤ªå¤šå¯¼è‡´ JVM æŒ‚èµ·ï¼Œé»˜è®¤å€¼æ˜¯ 50</li></ul></li></ul></li><li><p>è¡¨æ ¼å­—æ®µè¯´æ˜</p><div class=table-wrapper><table><thead><tr><th>è¡¨æ ¼å­—æ®µ</th><th>å­—æ®µè§£é‡Š</th></tr></thead><tbody><tr><td>INDEX</td><td>æ—¶é—´ç‰‡æ®µè®°å½•ç¼–å·ï¼Œæ¯ä¸€ä¸ªç¼–å·ä»£è¡¨ç€ä¸€æ¬¡è°ƒç”¨ï¼Œåç»­ tt è¿˜æœ‰å¾ˆå¤šå‘½ä»¤éƒ½æ˜¯åŸºäºæ­¤ç¼–å·æŒ‡å®šè®°å½•æ“ä½œï¼Œéå¸¸é‡è¦ã€‚</td></tr><tr><td>TIMESTAMP</td><td>æ–¹æ³•æ‰§è¡Œçš„æœ¬æœºæ—¶é—´ï¼Œè®°å½•äº†è¿™ä¸ªæ—¶é—´ç‰‡æ®µæ‰€å‘ç”Ÿçš„æœ¬æœºæ—¶é—´</td></tr><tr><td>COST(ms)</td><td>æ–¹æ³•æ‰§è¡Œçš„è€—æ—¶</td></tr><tr><td>IS-RET</td><td>æ–¹æ³•æ˜¯å¦ä»¥æ­£å¸¸è¿”å›çš„å½¢å¼ç»“æŸ</td></tr><tr><td>IS-EXP</td><td>æ–¹æ³•æ˜¯å¦ä»¥æŠ›å¼‚å¸¸çš„å½¢å¼ç»“æŸ</td></tr><tr><td>OBJECT</td><td>æ‰§è¡Œå¯¹è±¡çš„ hashCode()ï¼Œæ³¨æ„ï¼Œæ›¾ç»æœ‰äººè¯¯è®¤ä¸ºæ˜¯å¯¹è±¡åœ¨ JVM ä¸­çš„å†…å­˜åœ°å€ï¼Œä½†å¾ˆé—æ†¾ä»–ä¸æ˜¯ã€‚ä½†ä»–èƒ½å¸®åŠ©ä½ ç®€å•çš„æ ‡è®°å½“å‰æ‰§è¡Œæ–¹æ³•çš„ç±»å®ä½“</td></tr><tr><td>CLASS</td><td>æ‰§è¡Œçš„ç±»å</td></tr><tr><td>METHOD</td><td>æ‰§è¡Œçš„æ–¹æ³•å</td></tr></tbody></table></div></li><li><p>æ¡ä»¶è¡¨è¾¾å¼
ä¸çŸ¥é“å¤§å®¶æ˜¯å¦æœ‰åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»¥ä¸‹å›°æƒ‘</p><ul><li>Arthas ä¼¼ä¹å¾ˆéš¾åŒºåˆ†å‡ºé‡è½½çš„æ–¹æ³•</li><li>æˆ‘åªéœ€è¦è§‚å¯Ÿç‰¹å®šå‚æ•°ï¼Œä½†æ˜¯ tt å´å…¨éƒ¨éƒ½ç»™æˆ‘è®°å½•äº†ä¸‹æ¥</li></ul><p>æ¡ä»¶è¡¨è¾¾å¼ä¹Ÿæ˜¯ç”¨ OGNL æ¥ç¼–å†™ï¼Œæ ¸å¿ƒçš„åˆ¤æ–­å¯¹è±¡ä¾ç„¶æ˜¯ Advice å¯¹è±¡ã€‚é™¤äº† tt å‘½ä»¤ä¹‹å¤–ï¼Œwatchã€traceã€stack å‘½ä»¤ä¹Ÿéƒ½æ”¯æŒæ¡ä»¶è¡¨è¾¾å¼ã€‚</p></li><li><p>è§£å†³æ–¹æ³•é‡è½½</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>  tt -t *Test print params.length<span class=o>==</span><span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡åˆ¶å®šå‚æ•°ä¸ªæ•°çš„å½¢å¼è§£å†³ä¸åŒçš„æ–¹æ³•ç­¾åï¼Œå¦‚æœå‚æ•°ä¸ªæ•°ä¸€æ ·ï¼Œä½ è¿˜å¯ä»¥è¿™æ ·å†™</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tt -t *Test print <span class=s1>&#39;params[1] instanceof Integer&#39;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>è§£å†³æŒ‡å®šå‚æ•°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tt -t *Test print params<span class=o>[</span>0<span class=o>]</span>.mobile<span class=o>==</span><span class=s2>&#34;13989838402&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>æ„æˆæ¡ä»¶è¡¨è¾¾å¼çš„ <code>Advice</code> å¯¹è±¡</p><p>å‰è¾¹çœ‹åˆ°äº†å¾ˆå¤šæ¡ä»¶è¡¨è¾¾å¼ä¸­ï¼Œéƒ½ä½¿ç”¨äº† params[0]ï¼Œæœ‰å…³è¿™ä¸ªå˜é‡çš„ä»‹ç»ï¼Œè¯·å‚è€ƒè¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</p></li></ul><h4 id=æ£€ç´¢è°ƒç”¨è®°å½•>æ£€ç´¢è°ƒç”¨è®°å½•</h4><p>å½“ä½ ç”¨ tt è®°å½•äº†ä¸€å¤§ç‰‡çš„æ—¶é—´ç‰‡æ®µä¹‹åï¼Œä½ å¸Œæœ›èƒ½ä»ä¸­ç­›é€‰å‡ºè‡ªå·±éœ€è¦çš„æ—¶é—´ç‰‡æ®µï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±éœ€è¦å¯¹ç°æœ‰è®°å½•è¿›è¡Œæ£€ç´¢ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰è¿™äº›è®°å½•</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tt -l
</span></span><span class=line><span class=cl> INDEX   TIMESTAMP            COST<span class=o>(</span>ms<span class=o>)</span>  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD
</span></span><span class=line><span class=cl>-------------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> <span class=m>1000</span>    2018-12-04 11:15:38  1.096236  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1001</span>    2018-12-04 11:15:39  0.191848  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1002</span>    2018-12-04 11:15:40  0.069523  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1003</span>    2018-12-04 11:15:41  0.186073  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1004</span>    2018-12-04 11:15:42  17.76437  <span class=nb>true</span>    <span class=nb>false</span>    0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl>                              <span class=m>9</span>
</span></span><span class=line><span class=cl> <span class=m>1005</span>    2018-12-04 11:15:43  0.4776    <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>row-cnt:6<span class=o>)</span> cost in <span class=m>4</span> ms.
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘éœ€è¦ç­›é€‰å‡º <code>primeFactors</code> æ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tt -s <span class=s1>&#39;method.name==&#34;primeFactors&#34;&#39;</span>
</span></span><span class=line><span class=cl> INDEX   TIMESTAMP            COST<span class=o>(</span>ms<span class=o>)</span>  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD
</span></span><span class=line><span class=cl>-------------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> <span class=m>1000</span>    2018-12-04 11:15:38  1.096236  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1001</span>    2018-12-04 11:15:39  0.191848  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1002</span>    2018-12-04 11:15:40  0.069523  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1003</span>    2018-12-04 11:15:41  0.186073  <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl> <span class=m>1004</span>    2018-12-04 11:15:42  17.76437  <span class=nb>true</span>    <span class=nb>false</span>    0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl>                              <span class=m>9</span>
</span></span><span class=line><span class=cl> <span class=m>1005</span>    2018-12-04 11:15:43  0.4776    <span class=nb>false</span>   <span class=nb>true</span>     0x4b67cf4d     MathGame                       primeFactors
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>row-cnt:6<span class=o>)</span> cost in <span class=m>607</span> ms.
</span></span></code></pre></td></tr></table></div></div><p>ä½ éœ€è¦ä¸€ä¸ª <code>-s</code> å‚æ•°ã€‚åŒæ ·çš„ï¼Œæœç´¢è¡¨è¾¾å¼çš„æ ¸å¿ƒå¯¹è±¡ä¾æ—§æ˜¯ Advice å¯¹è±¡ã€‚</p><h4 id=æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯>æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯</h4><p>å¯¹äºå…·ä½“ä¸€ä¸ªæ—¶é—´ç‰‡çš„ä¿¡æ¯è€Œè¨€ï¼Œä½ å¯ä»¥é€šè¿‡ <code>-i</code> å‚æ•°åè¾¹è·Ÿç€å¯¹åº”çš„ <code>INDEX</code> ç¼–å·æŸ¥çœ‹åˆ°ä»–çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tt -i <span class=m>1003</span>
</span></span><span class=line><span class=cl> INDEX            <span class=m>1003</span>
</span></span><span class=line><span class=cl> GMT-CREATE       2018-12-04 11:15:41
</span></span><span class=line><span class=cl> COST<span class=o>(</span>ms<span class=o>)</span>         0.186073
</span></span><span class=line><span class=cl> OBJECT           0x4b67cf4d
</span></span><span class=line><span class=cl> CLASS            demo.MathGame
</span></span><span class=line><span class=cl> METHOD           primeFactors
</span></span><span class=line><span class=cl> IS-RETURN        <span class=nb>false</span>
</span></span><span class=line><span class=cl> IS-EXCEPTION     <span class=nb>true</span>
</span></span><span class=line><span class=cl> PARAMETERS<span class=o>[</span>0<span class=o>]</span>    @Integer<span class=o>[</span>-564322413<span class=o>]</span>
</span></span><span class=line><span class=cl> THROW-EXCEPTION  java.lang.IllegalArgumentException: number is: -564322413, need &gt;<span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>                      at demo.MathGame.primeFactors<span class=o>(</span>MathGame.java:46<span class=o>)</span>
</span></span><span class=line><span class=cl>                      at demo.MathGame.run<span class=o>(</span>MathGame.java:24<span class=o>)</span>
</span></span><span class=line><span class=cl>                      at demo.MathGame.main<span class=o>(</span>MathGame.java:16<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>row-cnt:1<span class=o>)</span> cost in <span class=m>11</span> ms.
</span></span></code></pre></td></tr></table></div></div><h4 id=é‡åšä¸€æ¬¡è°ƒç”¨>é‡åšä¸€æ¬¡è°ƒç”¨</h4><p>å½“ä½ ç¨ç¨åšäº†ä¸€äº›è°ƒæ•´ä¹‹åï¼Œä½ å¯èƒ½éœ€è¦å‰ç«¯ç³»ç»Ÿé‡æ–°è§¦å‘ä¸€æ¬¡ä½ çš„è°ƒç”¨ï¼Œæ­¤æ—¶å¾—æ±‚çˆ·çˆ·å‘Šå¥¶å¥¶çš„éœ€è¦å‰ç«¯é…åˆè”è°ƒçš„åŒå­¦å†æ¬¡å‘èµ·ä¸€æ¬¡è°ƒç”¨ã€‚è€Œæœ‰äº›åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªè°ƒç”¨ä¸æ˜¯è¿™ä¹ˆå¥½è§¦å‘çš„ã€‚</p><p><code>tt</code> å‘½ä»¤ç”±äºä¿å­˜äº†å½“æ—¶è°ƒç”¨çš„æ‰€æœ‰ç°åœºä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±ä¸»åŠ¨å¯¹ä¸€ä¸ª <code>INDEX</code> ç¼–å·çš„æ—¶é—´ç‰‡è‡ªä¸»å‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œä»è€Œè§£æ”¾ä½ çš„æ²Ÿé€šæˆæœ¬ã€‚æ­¤æ—¶ä½ éœ€è¦ <code>-p</code> å‚æ•°ã€‚é€šè¿‡ <code>--replay-times</code> æŒ‡å®š è°ƒç”¨æ¬¡æ•°ï¼Œé€šè¿‡ <code>--replay-interval</code> æŒ‡å®šå¤šæ¬¡è°ƒç”¨é—´éš”(å•ä½ ms, é»˜è®¤ 1000ms)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tt -i <span class=m>1004</span> -p
</span></span><span class=line><span class=cl> RE-INDEX       <span class=m>1004</span>
</span></span><span class=line><span class=cl> GMT-REPLAY     2018-12-04 11:26:00
</span></span><span class=line><span class=cl> OBJECT         0x4b67cf4d
</span></span><span class=line><span class=cl> CLASS          demo.MathGame
</span></span><span class=line><span class=cl> METHOD         primeFactors
</span></span><span class=line><span class=cl> PARAMETERS<span class=o>[</span>0<span class=o>]</span>  @Integer<span class=o>[</span>946738738<span class=o>]</span>
</span></span><span class=line><span class=cl> IS-RETURN      <span class=nb>true</span>
</span></span><span class=line><span class=cl> IS-EXCEPTION   <span class=nb>false</span>
</span></span><span class=line><span class=cl> COST<span class=o>(</span>ms<span class=o>)</span>         0.186073
</span></span><span class=line><span class=cl> RETURN-OBJ     @ArrayList<span class=o>[</span>
</span></span><span class=line><span class=cl>                    @Integer<span class=o>[</span>2<span class=o>]</span>,
</span></span><span class=line><span class=cl>                    @Integer<span class=o>[</span>11<span class=o>]</span>,
</span></span><span class=line><span class=cl>                    @Integer<span class=o>[</span>17<span class=o>]</span>,
</span></span><span class=line><span class=cl>                    @Integer<span class=o>[</span>2531387<span class=o>]</span>,
</span></span><span class=line><span class=cl>                <span class=o>]</span>
</span></span><span class=line><span class=cl>Time fragment<span class=o>[</span>1004<span class=o>]</span> successfully replayed.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>row-cnt:1<span class=o>)</span> cost in <span class=m>14</span> ms.
</span></span></code></pre></td></tr></table></div></div><p>ä½ ä¼šå‘ç°ç»“æœè™½ç„¶ä¸€æ ·ï¼Œä½†è°ƒç”¨çš„è·¯å¾„å‘ç”Ÿäº†å˜åŒ–ï¼Œç”±åŸæ¥çš„ç¨‹åºå‘èµ·å˜æˆäº† Arthas è‡ªå·±çš„å†…éƒ¨çº¿ç¨‹å‘èµ·çš„è°ƒç”¨äº†ã€‚</p><h4 id=è§‚å¯Ÿè¡¨è¾¾å¼>è§‚å¯Ÿè¡¨è¾¾å¼</h4><p><code>-w, --watch-express</code> è§‚å¯Ÿæ—¶ç©ºéš§é“ä½¿ç”¨ <code>ognl</code> è¡¨è¾¾å¼</p><ul><li><p>ä½¿ç”¨è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡ä¸­æ‰€æœ‰å˜é‡ä½œä¸ºå·²çŸ¥æ¡ä»¶ç¼–å†™è¡¨è¾¾å¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>arthas@10718<span class=o>]</span>$ tt -t demo.MathGame run -n <span class=m>5</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>56</span> ms, listenerId: <span class=m>1</span>
</span></span><span class=line><span class=cl>INDEX      TIMESTAMP                   COST<span class=o>(</span>ms<span class=o>)</span>     IS-RET     IS-EXP      OBJECT              CLASS                                     METHOD
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=m>1000</span>       2021-01-08 21:54:17         0.901091     <span class=nb>true</span>       <span class=nb>false</span>       0x7699a589          MathGame                                  run
</span></span><span class=line><span class=cl><span class=o>[</span>arthas@10718<span class=o>]</span>$ tt -w <span class=s1>&#39;target.illegalArgumentCount&#39;</span>  -x <span class=m>1</span> -i <span class=m>1000</span>
</span></span><span class=line><span class=cl>@Integer<span class=o>[</span>60<span class=o>]</span>
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>row-cnt:1<span class=o>)</span> cost in <span class=m>7</span> ms.
</span></span></code></pre></td></tr></table></div></div></li><li><p>è·å–ç±»çš„é™æ€å­—æ®µã€è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>arthas@10718<span class=o>]</span>$ tt -t demo.MathGame run -n <span class=m>5</span>
</span></span><span class=line><span class=cl>Press Q or Ctrl+C to abort.
</span></span><span class=line><span class=cl>Affect<span class=o>(</span>class count: <span class=m>1</span> , method count: 1<span class=o>)</span> cost in <span class=m>56</span> ms, listenerId: <span class=m>1</span>
</span></span><span class=line><span class=cl>INDEX      TIMESTAMP                   COST<span class=o>(</span>ms<span class=o>)</span>     IS-RET     IS-EXP      OBJECT              CLASS                                     METHOD
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=m>1000</span>       2021-01-08 21:54:17         0.901091     <span class=nb>true</span>       <span class=nb>false</span>       0x7699a589          MathGame                                  run
</span></span><span class=line><span class=cl><span class=o>[</span>arthas@10718<span class=o>]</span>$ tt -w <span class=s1>&#39;@demo.MathGame@random.nextInt(100)&#39;</span>  -x <span class=m>1</span> -i <span class=m>1000</span>
</span></span><span class=line><span class=cl>@Integer<span class=o>[</span>46<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„è¿™é‡Œä½¿ç”¨ <code>com.taobao.arthas.core.advisor.Advice#getLoader</code> åŠ è½½,ä½¿ç”¨ç²¾ç¡® <code>classloader</code> ognl æ›´å¥½ã€‚</p></li><li><p>éœ€è¦å¼ºè°ƒçš„ç‚¹</p><ol><li>ThreadLocal ä¿¡æ¯ä¸¢å¤±</li></ol><p>å¾ˆå¤šæ¡†æ¶å·å·çš„å°†ä¸€äº›ç¯å¢ƒå˜é‡ä¿¡æ¯å¡åˆ°äº†å‘èµ·è°ƒç”¨çº¿ç¨‹çš„ ThreadLocal ä¸­ï¼Œç”±äºè°ƒç”¨çº¿ç¨‹å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™äº› ThreadLocal çº¿ç¨‹ä¿¡æ¯æ— æ³•é€šè¿‡ Arthas ä¿å­˜ï¼Œæ‰€ä»¥è¿™äº›ä¿¡æ¯å°†ä¼šä¸¢å¤±ã€‚</p><p>ä¸€äº›å¸¸è§çš„ CASE æ¯”å¦‚ï¼šé¹°çœ¼çš„ TraceId ç­‰ã€‚</p><ol start=2><li>å¼•ç”¨çš„å¯¹è±¡</li></ol><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œtt å‘½ä»¤æ˜¯å°†å½“å‰ç¯å¢ƒçš„å¯¹è±¡å¼•ç”¨ä¿å­˜èµ·æ¥ï¼Œä½†ä»…ä»…ä¹Ÿåªèƒ½ä¿å­˜ä¸€ä¸ªå¼•ç”¨è€Œå·²ã€‚å¦‚æœæ–¹æ³•å†…éƒ¨å¯¹å…¥å‚è¿›è¡Œäº†å˜æ›´ï¼Œæˆ–è€…è¿”å›çš„å¯¹è±¡ç»è¿‡äº†åç»­çš„å¤„ç†ï¼Œé‚£ä¹ˆåœ¨ tt æŸ¥çœ‹çš„æ—¶å€™å°†æ— æ³•çœ‹åˆ°å½“æ—¶æœ€å‡†ç¡®çš„å€¼ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ watch å‘½ä»¤å­˜åœ¨çš„æ„ä¹‰ã€‚</p></li></ul><h4 id=é€šè¿‡ç´¢å¼•åˆ é™¤æŒ‡å®šçš„-tt-è®°å½•>é€šè¿‡ç´¢å¼•åˆ é™¤æŒ‡å®šçš„ tt è®°å½•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tt -d <span class=m>1001</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æ¸…é™¤æ‰€æœ‰çš„-tt-è®°å½•>æ¸…é™¤æ‰€æœ‰çš„ tt è®°å½•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tt --delete-all
</span></span></code></pre></td></tr></table></div></div><h3 id=profiler>profiler</h3><blockquote><p><strong>æç¤º</strong></p><p>ä½¿ç”¨ async-profiler ç”Ÿæˆç«ç„°å›¾</p></blockquote><p><code>profiler</code> å‘½ä»¤æ”¯æŒç”Ÿæˆåº”ç”¨çƒ­ç‚¹çš„ç«ç„°å›¾ã€‚æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¸æ–­çš„é‡‡æ ·ï¼Œç„¶åæŠŠæ”¶é›†åˆ°çš„é‡‡æ ·ç»“æœç”Ÿæˆç«ç„°å›¾ã€‚</p><p><code>profiler</code> å‘½ä»¤åŸºæœ¬è¿è¡Œç»“æ„æ˜¯ <code>profiler action [actionArg]</code></p><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>action</em></td><td>è¦æ‰§è¡Œçš„æ“ä½œ</td></tr><tr><td style=text-align:right><em>actionArg</em></td><td>å±æ€§åæ¨¡å¼</td></tr><tr><td style=text-align:right>[i:]</td><td>é‡‡æ ·é—´éš”ï¼ˆå•ä½ï¼šnsï¼‰ï¼ˆé»˜è®¤å€¼ï¼š10'000'000ï¼Œå³ 10 msï¼‰</td></tr><tr><td style=text-align:right>[f:]</td><td>å°†è¾“å‡ºè½¬å‚¨åˆ°æŒ‡å®šè·¯å¾„</td></tr><tr><td style=text-align:right>[d:]</td><td>è¿è¡Œè¯„æµ‹æŒ‡å®šç§’</td></tr><tr><td style=text-align:right>[e:]</td><td>è¦è·Ÿè¸ªå“ªä¸ªäº‹ä»¶ï¼ˆcpu, alloc, lock, cache-misses ç­‰ï¼‰ï¼Œé»˜è®¤æ˜¯ cpu</td></tr></tbody></table></div><h4 id=å¯åŠ¨-profiler>å¯åŠ¨ profiler</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler start
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>æç¤º</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„æ˜¯ cpu çš„ç«ç„°å›¾ï¼Œå³ event ä¸º cpuã€‚å¯ä»¥ç”¨&ndash;event å‚æ•°æ¥æŒ‡å®šã€‚</p></blockquote><h4 id=è·å–å·²é‡‡é›†çš„-sample-çš„æ•°é‡>è·å–å·²é‡‡é›†çš„ sample çš„æ•°é‡</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ profiler getSamples
</span></span><span class=line><span class=cl><span class=m>23</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æŸ¥çœ‹-profiler-çŠ¶æ€>æŸ¥çœ‹ profiler çŠ¶æ€</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ profiler status
</span></span><span class=line><span class=cl><span class=o>[</span>cpu<span class=o>]</span> profiling is running <span class=k>for</span> <span class=m>4</span> seconds
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥æŸ¥çœ‹å½“å‰ profiler åœ¨é‡‡æ ·å“ªç§ <code>event</code> å’Œé‡‡æ ·æ—¶é—´ã€‚</p><h4 id=åœæ­¢-profiler>åœæ­¢ profiler</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># é»˜è®¤æƒ…å†µä¸‹ï¼Œç»“æœæ–‡ä»¶æ˜¯htmlæ ¼å¼ï¼Œä¹Ÿå¯ä»¥ç”¨--formatå‚æ•°æŒ‡å®šï¼š</span>
</span></span><span class=line><span class=cl>$ profiler stop --format html
</span></span><span class=line><span class=cl>profiler output file: /tmp/test/arthas-output/20211207-111550.html
</span></span><span class=line><span class=cl>OK
</span></span><span class=line><span class=cl><span class=c1># æˆ–è€…åœ¨--fileå‚æ•°é‡Œç”¨æ–‡ä»¶åæŒ‡åæ ¼å¼ã€‚æ¯”å¦‚--file /tmp/result.html ã€‚</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=profiler-æ”¯æŒçš„-events>profiler æ”¯æŒçš„ events</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åœ¨ä¸åŒçš„å¹³å°ï¼Œä¸åŒçš„ OS ä¸‹é¢ï¼Œæ”¯æŒçš„ events å„æœ‰ä¸åŒã€‚å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ï¼š</span>
</span></span><span class=line><span class=cl>profiler list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯ä»¥ç”¨--eventå‚æ•°æŒ‡å®šè¦é‡‡æ ·çš„äº‹ä»¶ï¼Œæ¯”å¦‚å¯¹allocäº‹ä»¶è¿›å…¥é‡‡æ ·ï¼š</span>
</span></span><span class=line><span class=cl>profiler start --event alloc
</span></span></code></pre></td></tr></table></div></div><h4 id=æ¢å¤é‡‡æ ·>æ¢å¤é‡‡æ ·</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler resume
</span></span></code></pre></td></tr></table></div></div><p><code>start</code> å’Œ <code>resume</code> çš„åŒºåˆ«æ˜¯ï¼š<code>start</code> æ˜¯æ–°å¼€å§‹é‡‡æ ·ï¼Œ<code>resume</code> ä¼šä¿ç•™ä¸Šæ¬¡ <code>stop</code> æ—¶çš„æ•°æ®ã€‚</p><p>é€šè¿‡æ‰§è¡Œ <code>profiler getSamples</code> å¯ä»¥æŸ¥çœ‹ <code>samples</code> çš„æ•°é‡æ¥éªŒè¯ã€‚</p><h4 id=ä½¿ç”¨-execute-æ¥æ‰§è¡Œå¤æ‚çš„å‘½ä»¤>ä½¿ç”¨ execute æ¥æ‰§è¡Œå¤æ‚çš„å‘½ä»¤</h4><p>æ¯”å¦‚å¼€å§‹é‡‡æ ·ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler execute <span class=s1>&#39;start,framebuf=5000000&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>åœæ­¢é‡‡æ ·ï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶é‡Œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler execute <span class=s1>&#39;stop,file=/tmp/result.html&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„-action>æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„ action</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ profiler actions
</span></span><span class=line><span class=cl>Supported Actions: <span class=o>[</span>resume, dumpCollapsed, getSamples, start, list, execute, version, stop, load, dumpFlat, actions, dumpTraces, status<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æŸ¥çœ‹ç‰ˆæœ¬>æŸ¥çœ‹ç‰ˆæœ¬</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ profiler version
</span></span><span class=line><span class=cl>Async-profiler 1.6 built on Sep  <span class=m>9</span> <span class=m>2019</span>
</span></span><span class=line><span class=cl>Copyright <span class=m>2019</span> Andrei Pangin
</span></span></code></pre></td></tr></table></div></div><h4 id=é…ç½®-framebuf-å‚æ•°>é…ç½® framebuf å‚æ•°</h4><blockquote><p>å¦‚æœé‡åˆ°ç”Ÿæˆçš„ç«ç„°å›¾æœ‰ [frame_buffer_overflow]ï¼Œåˆ™éœ€è¦å¢å¤§ framebufï¼ˆé»˜è®¤å€¼æ˜¯ 1'000'000ï¼‰ï¼Œå¯ä»¥æ˜¾å¼é…ç½®ï¼Œæ¯”å¦‚ï¼š</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler start --framebuf <span class=m>5000000</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=é…ç½®-includeexclude-æ¥è¿‡æ»¤æ•°æ®>é…ç½® include/exclude æ¥è¿‡æ»¤æ•°æ®</h4><p>å¦‚æœåº”ç”¨æ¯”è¾ƒå¤æ‚ï¼Œç”Ÿæˆçš„å†…å®¹å¾ˆå¤šï¼Œæƒ³åªå…³æ³¨éƒ¨åˆ†æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ include/exclude æ¥è¿‡æ»¤ã€‚æ¯”å¦‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler start --include <span class=s1>&#39;java/*&#39;</span> --include <span class=s1>&#39;demo/*&#39;</span> --exclude <span class=s1>&#39;*Unsafe.park*&#39;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>include/exclude éƒ½æ”¯æŒè®¾ç½®å¤šä¸ªå€¼ ï¼Œä½†æ˜¯éœ€è¦é…ç½®åœ¨å‘½ä»¤è¡Œçš„æœ€åã€‚</p></blockquote><h4 id=æŒ‡å®šæ‰§è¡Œæ—¶é—´>æŒ‡å®šæ‰§è¡Œæ—¶é—´</h4><p>æ¯”å¦‚ï¼Œå¸Œæœ› profiler æ‰§è¡Œ 300 ç§’è‡ªåŠ¨ç»“æŸï¼Œå¯ä»¥ç”¨ <code>-d/--duration</code> å‚æ•°æŒ‡å®šï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler start --duration <span class=m>300</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ç”Ÿæˆ-jfr-æ ¼å¼ç»“æœ>ç”Ÿæˆ jfr æ ¼å¼ç»“æœ</h4><p>æ³¨æ„ï¼Œjfr åªæ”¯æŒåœ¨ <code>start</code> æ—¶é…ç½®ã€‚å¦‚æœæ˜¯åœ¨ <code>stop</code> æ—¶æŒ‡å®šï¼Œåˆ™ä¸ä¼šç”Ÿæ•ˆã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>profiler start --file /tmp/test.jfr
</span></span></code></pre></td></tr></table></div></div><p><code>file</code> å‚æ•°æ”¯æŒä¸€äº›å˜é‡ï¼š</p><ul><li>æ—¶é—´æˆ³ï¼š &ndash;file /tmp/test-%t.jfr</li><li>è¿›ç¨‹ IDï¼š &ndash;file /tmp/test-%p.jfr</li></ul><p>ç”Ÿæˆçš„ç»“æœå¯ä»¥ç”¨æ”¯æŒ jfr æ ¼å¼çš„å·¥å…·æ¥æŸ¥çœ‹ã€‚æ¯”å¦‚ï¼š</p><ul><li>JDK Mission Control</li><li>JProfiler</li></ul><h3 id=jfr>jfr</h3><blockquote><p><strong>æç¤º</strong></p><p>Java Flight Recorder (JFR) æ˜¯ä¸€ç§ç”¨äºæ”¶é›†æœ‰å…³æ­£åœ¨è¿è¡Œçš„ Java åº”ç”¨ç¨‹åºçš„è¯Šæ–­å’Œåˆ†ææ•°æ®çš„å·¥å…·ã€‚å®ƒé›†æˆåˆ° Java è™šæ‹Ÿæœº (JVM) ä¸­ï¼Œå‡ ä¹ä¸ä¼šé€ æˆæ€§èƒ½å¼€é”€ï¼Œå› æ­¤å³ä½¿åœ¨è´Ÿè½½è¾ƒé‡çš„ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p></blockquote><p><code>jfr</code> å‘½ä»¤æ”¯æŒåœ¨ç¨‹åºåŠ¨æ€è¿è¡Œè¿‡ç¨‹ä¸­å¼€å¯å’Œå…³é—­ JFR è®°å½•ã€‚ è®°å½•æ”¶é›†æœ‰å…³ event çš„æ•°æ®ã€‚äº‹ä»¶åœ¨ç‰¹å®šæ—¶é—´ç‚¹å‘ç”Ÿåœ¨ JVM æˆ– Java åº”ç”¨ç¨‹åºä¸­ã€‚æ¯ä¸ªäº‹ä»¶éƒ½æœ‰ä¸€ä¸ªåç§°ã€ä¸€ä¸ªæ—¶é—´æˆ³å’Œä¸€ä¸ªå¯é€‰çš„æœ‰æ•ˆè´Ÿè½½ã€‚è´Ÿè½½æ˜¯ä¸äº‹ä»¶ç›¸å…³çš„æ•°æ®ï¼Œä¾‹å¦‚ CPU ä½¿ç”¨ç‡ã€äº‹ä»¶å‰åçš„ Java å †å¤§å°ã€é”æŒæœ‰è€…çš„çº¿ç¨‹ ID ç­‰ã€‚</p><p><code>jfr</code> å‘½ä»¤åŸºæœ¬è¿è¡Œç»“æ„æ˜¯ <code>jfr cmd [actionArg]</code></p><blockquote><p>æ³¨æ„ï¼š JDK8 çš„ 8u262 ç‰ˆæœ¬ä¹‹åæ‰æ”¯æŒ jfr</p></blockquote><div class=table-wrapper><table><thead><tr><th style=text-align:right>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:right><em>cmd</em></td><td>è¦æ‰§è¡Œçš„æ“ä½œ æ”¯æŒçš„å‘½ä»¤ã€startï¼Œstatusï¼Œdumpï¼Œstopã€‘</td></tr><tr><td style=text-align:right><em>actionArg</em></td><td>å±æ€§åæ¨¡å¼</td></tr><tr><td style=text-align:right>[n:]</td><td>è®°å½•åç§°</td></tr><tr><td style=text-align:right>[r:]</td><td>è®°å½• id å€¼</td></tr><tr><td style=text-align:right>[dumponexit:]</td><td>ç¨‹åºé€€å‡ºæ—¶ï¼Œæ˜¯å¦è¦ dump å‡º .jfr æ–‡ä»¶ï¼Œé»˜è®¤ä¸º false</td></tr><tr><td style=text-align:right>[d:]</td><td>å»¶è¿Ÿå¤šä¹…åå¯åŠ¨ JFR è®°å½•ï¼Œæ”¯æŒå¸¦å•ä½é…ç½®ï¼Œeg: 60s, 2m, 5h, 3d. ä¸å¸¦å•ä½å°±æ˜¯ç§’ï¼Œé»˜è®¤æ— å»¶è¿Ÿ</td></tr><tr><td style=text-align:right>[duration:]</td><td>JFR è®°å½•æŒç»­æ—¶é—´ï¼Œæ”¯æŒå•ä½é…ç½®ï¼Œä¸å¸¦å•ä½å°±æ˜¯ç§’ï¼Œé»˜è®¤ä¸€ç›´è®°å½•</td></tr><tr><td style=text-align:right>[s:]</td><td>é‡‡é›† Event çš„è¯¦ç»†é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ default.jfc ä½äº $JAVA_HOME/lib/jfr/default.jfc</td></tr><tr><td style=text-align:right>[f:]</td><td>å°†è¾“å‡ºè½¬å‚¨åˆ°æŒ‡å®šè·¯å¾„</td></tr><tr><td style=text-align:right>[maxage:]</td><td>ç¼“å†²åŒºæ•°æ®æœ€å¤§æ–‡ä»¶è®°å½•ä¿å­˜æ—¶é—´ï¼Œæ”¯æŒå•ä½é…ç½®ï¼Œä¸å¸¦å•ä½å°±æ˜¯ç§’ï¼Œé»˜è®¤æ˜¯ä¸é™åˆ¶</td></tr><tr><td style=text-align:right>[maxsize:]</td><td>ç¼“å†²åŒºçš„æœ€å¤§æ–‡ä»¶å¤§å°ï¼Œæ”¯æŒå•ä½é…ç½®ï¼Œ ä¸å¸¦å•ä½æ˜¯å­—èŠ‚ï¼Œm æˆ–è€… M ä»£è¡¨ MBï¼Œg æˆ–è€… G ä»£è¡¨ GBã€‚</td></tr><tr><td style=text-align:right>[state:]</td><td>jfr è®°å½•çŠ¶æ€</td></tr></tbody></table></div><h4 id=å¯åŠ¨-jfr-è®°å½•>å¯åŠ¨ JFR è®°å½•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr start
</span></span><span class=line><span class=cl>Started recording 1. No limit specified, using <span class=nv>maxsize</span><span class=o>=</span>250MB as default.
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>æç¤º</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼€å¯çš„æ˜¯é»˜è®¤å‚æ•°çš„ jfr è®°å½•</p></blockquote><p>å¯åŠ¨ jfr è®°å½•ï¼ŒæŒ‡å®šè®°å½•åï¼Œè®°å½•æŒç»­æ—¶é—´ï¼Œè®°å½•æ–‡ä»¶ä¿å­˜è·¯å¾„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr start -n myRecording --duration 60s -f /tmp/myRecording.jfr
</span></span><span class=line><span class=cl>Started recording 2. The result will be written to:
</span></span><span class=line><span class=cl>/tmp/myRecording.jfr
</span></span></code></pre></td></tr></table></div></div><h4 id=æŸ¥çœ‹-jfr-è®°å½•çŠ¶æ€>æŸ¥çœ‹ JFR è®°å½•çŠ¶æ€</h4><p>é»˜è®¤æ˜¯æŸ¥çœ‹æ‰€æœ‰ JFR è®°å½•ä¿¡æ¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr status
</span></span><span class=line><span class=cl>Recording: <span class=nv>recording</span><span class=o>=</span><span class=m>1</span> <span class=nv>name</span><span class=o>=</span>Recording-1 <span class=o>(</span>running<span class=o>)</span>
</span></span><span class=line><span class=cl>Recording: <span class=nv>recording</span><span class=o>=</span><span class=m>2</span> <span class=nv>name</span><span class=o>=</span>myRecording <span class=nv>duration</span><span class=o>=</span>PT1M <span class=o>(</span>closed<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹æŒ‡å®šè®°å½• id çš„è®°å½•ä¿¡æ¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr status -r <span class=m>1</span>
</span></span><span class=line><span class=cl>Recording: <span class=nv>recording</span><span class=o>=</span><span class=m>1</span> <span class=nv>name</span><span class=o>=</span>Recording-1 <span class=o>(</span>running<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„è®°å½•ä¿¡æ¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr status --state closed
</span></span><span class=line><span class=cl>Recording: <span class=nv>recording</span><span class=o>=</span><span class=m>2</span> <span class=nv>name</span><span class=o>=</span>myRecording <span class=nv>duration</span><span class=o>=</span>PT1M <span class=o>(</span>closed<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=dump-jfr-è®°å½•>dump jfr è®°å½•</h4><p><code>jfr dump</code> ä¼šè¾“å‡ºä»å¼€å§‹åˆ°è¿è¡Œè¯¥å‘½ä»¤è¿™æ®µæ—¶é—´å†…çš„è®°å½•åˆ° JFR æ–‡ä»¶ï¼Œä¸”ä¸ä¼šåœæ­¢ <code>jfr</code> çš„è®°å½•
æŒ‡å®šè®°å½•è¾“å‡ºè·¯å¾„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr dump -r <span class=m>1</span> -f /tmp/myRecording1.jfr
</span></span><span class=line><span class=cl>Dump recording 1, The result will be written to:
</span></span><span class=line><span class=cl>/tmp/myRecording1.jfr
</span></span></code></pre></td></tr></table></div></div><p>ä¸æŒ‡å®šæ–‡ä»¶è¾“å‡ºè·¯å¾„ï¼Œé»˜è®¤æ˜¯ä¿å­˜åˆ° arthas-output ç›®å½•ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr dump -r <span class=m>1</span>
</span></span><span class=line><span class=cl>Dump recording 1, The result will be written to:
</span></span><span class=line><span class=cl>/tmp/test/arthas-output/20220819-200915.jfr
</span></span></code></pre></td></tr></table></div></div><h4 id=åœæ­¢-jfr-è®°å½•>åœæ­¢ jfr è®°å½•</h4><p>ä¸æŒ‡å®šè®°å½•è¾“å‡ºè·¯å¾„ï¼Œé»˜è®¤æ˜¯ä¿å­˜åˆ° arthas-output ç›®å½•ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ jfr stop -r <span class=m>1</span>
</span></span><span class=line><span class=cl>Stop recording 1, The result will be written to:
</span></span><span class=line><span class=cl>/tmp/test/arthas-output/20220819-202049.jfr
</span></span></code></pre></td></tr></table></div></div><blockquote><p>æ³¨æ„ä¸€æ¡è®°å½•åªèƒ½åœæ­¢ä¸€æ¬¡ã€‚</p></blockquote><p>ä¹Ÿå¯ä»¥æŒ‡å®šè®°å½•è¾“å‡ºè·¯å¾„ã€‚</p><h4 id=é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹-arthas-output-ä¸‹é¢-jfr-è®°å½•çš„ç»“æœ>é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹ arthas-output ä¸‹é¢ JFR è®°å½•çš„ç»“æœ</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œarthas ä½¿ç”¨ 8563 ç«¯å£ï¼Œåˆ™å¯ä»¥æ‰“å¼€ï¼š http://localhost:8563/arthas-output/ æŸ¥çœ‹åˆ° arthas-output ç›®å½•ä¸‹é¢çš„ JFR è®°å½•ç»“æœã€‚</p><p>ç”Ÿæˆçš„ç»“æœå¯ä»¥ç”¨æ”¯æŒ jfr æ ¼å¼çš„å·¥å…·æ¥æŸ¥çœ‹ã€‚æ¯”å¦‚ï¼š</p><ul><li>JDK Mission Control</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/arthas/>Arthas</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/post/macos-setup/><div class=article-details><h2 class=article-title>Macos Setup</h2></div></a></article><article><a href=/post/software-list/><div class=article-details><h2 class=article-title>è½¯ä»¶åˆ—è¡¨</h2></div></a></article><article><a href=/post/deployment-configs/><div class=article-details><h2 class=article-title>æœåŠ¡å™¨æœåŠ¡ç®¡ç†</h2></div></a></article><article><a href=/post/docker-depend-and-health/><div class=article-details><h2 class=article-title>Docker Compose æœåŠ¡ä¾èµ–å’Œå¥åº·æ£€æŸ¥</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Lucas's Article</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>